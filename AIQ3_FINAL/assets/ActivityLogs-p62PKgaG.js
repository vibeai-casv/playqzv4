import{j as e,c as C}from"./index-fliBAwov.js";import{r as s}from"./vendor-D8AvkUoV.js";import{u as L}from"./useAdmin-CH0dsm_l.js";import{i as E,v as U,D as T,a4 as q,ai as z,k as M,g as P,a5 as O}from"./ui-mytIhYa7.js";import{M as I}from"./Modal-Ddo2ARiK.js";function V(){const{fetchActivityLogs:y,isLoading:v}=L(),[c,N]=s.useState([]),[x,f]=s.useState(0),[i,u]=s.useState(1),d=20,[o,w]=s.useState(""),[m,k]=s.useState(""),[l,_]=s.useState(""),[n,S]=s.useState(""),[a,j]=s.useState(null),b=s.useCallback(async()=>{try{const t=(i-1)*d,{logs:p,total:g}=await y({search:o,type:m||void 0,startDate:l?new Date(l):void 0,endDate:n?new Date(n):void 0,limit:d,offset:t});N(p),f(g)}catch(t){console.error(t),E.error("Failed to load activity logs")}},[y,i,o,m,l,n]);s.useEffect(()=>{const t=setTimeout(()=>{b()},300);return()=>clearTimeout(t)},[b]);const D=()=>{const p=[["Timestamp","User","Email","Activity Type","Description","IP Address","Metadata"].join(","),...c.map(r=>[new Date(r.created_at).toLocaleString(),r.profiles?.name||"Unknown",r.profiles?.email||"N/A",r.activity_type,`"${r.description.replace(/"/g,'""')}"`,r.ip_address||"N/A",`"${JSON.stringify(r.metadata||{}).replace(/"/g,'""')}"`].join(","))].join(`
`),g=new Blob([p],{type:"text/csv;charset=utf-8;"}),h=document.createElement("a");h.href=URL.createObjectURL(g),h.download=`activity_logs_${new Date().toISOString()}.csv`,h.click()},A=["login","logout","signup","profile_updated","quiz_started","quiz_completed","quiz_abandoned","password_changed","email_changed","account_disabled","account_enabled","question_created","question_updated","media_uploaded","achievement_earned","settings_changed"];return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(U,{className:"w-8 h-8"})," Activity Logs"]}),e.jsxs("button",{onClick:D,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(T,{className:"w-4 h-4"})," Export CSV"]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search logs...",value:o,onChange:t=>w(t.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsxs("select",{value:m,onChange:t=>k(t.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 appearance-none",children:[e.jsx("option",{value:"",children:"All Activities"}),A.map(t=>e.jsx("option",{value:t,children:t.replace(/_/g," ").toUpperCase()},t))]})]}),e.jsx("div",{children:e.jsx("input",{type:"date",value:l,onChange:t=>_(t.target.value),className:"w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:"Start Date"})}),e.jsx("div",{children:e.jsx("input",{type:"date",value:n,onChange:t=>S(t.target.value),className:"w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:"End Date"})})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Timestamp"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Activity"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"IP Address"}),e.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:v?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center",children:e.jsx(M,{className:"w-8 h-8 animate-spin mx-auto text-indigo-600"})})}):c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:"No activity logs found"})}):c.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:new Date(t.created_at).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8 bg-indigo-100 rounded-full flex items-center justify-center",children:e.jsx(P,{className:"h-4 w-4 text-indigo-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.profiles?.name||"Unknown User"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.profiles?.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:C("px-2 inline-flex text-xs leading-5 font-semibold rounded-full",t.activity_type.includes("error")||t.activity_type.includes("failed")?"bg-red-100 text-red-800":t.activity_type.includes("login")?"bg-green-100 text-green-800":t.activity_type.includes("quiz")?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:t.activity_type.replace(/_/g," ")})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-400 max-w-xs truncate",title:t.description,children:t.description}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:t.ip_address||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("button",{onClick:()=>j(t),className:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300",children:e.jsx(O,{className:"w-4 h-4"})})})]},t.id))})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 px-4 py-3 flex items-center justify-between border-t border-gray-200 dark:border-gray-700 sm:px-6",children:e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Showing ",e.jsx("span",{className:"font-medium",children:(i-1)*d+1})," to ",e.jsx("span",{className:"font-medium",children:Math.min(i*d,x)})," of ",e.jsx("span",{className:"font-medium",children:x})," results"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsx("button",{onClick:()=>u(t=>Math.max(1,t-1)),disabled:i===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-gray-700 dark:border-gray-600",children:"Previous"}),e.jsx("button",{onClick:()=>u(t=>t+1),disabled:i*d>=x,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-gray-700 dark:border-gray-600",children:"Next"})]})})]})})]}),e.jsx(I,{open:!!a,onClose:()=>j(null),title:"Activity Details",className:"max-w-2xl",children:a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase",children:"User"}),e.jsx("p",{className:"text-sm font-medium",children:a.profiles?.name||"Unknown"}),e.jsx("p",{className:"text-xs text-gray-500",children:a.profiles?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase",children:"Timestamp"}),e.jsx("p",{className:"text-sm",children:new Date(a.created_at).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase",children:"Activity Type"}),e.jsx("p",{className:"text-sm capitalize",children:a.activity_type.replace(/_/g," ")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase",children:"IP Address"}),e.jsx("p",{className:"text-sm",children:a.ip_address||"N/A"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase",children:"Description"}),e.jsx("p",{className:"text-sm bg-gray-50 dark:bg-gray-900 p-3 rounded-lg mt-1",children:a.description})]}),a.metadata&&Object.keys(a.metadata).length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase",children:"Metadata"}),e.jsx("pre",{className:"text-xs bg-gray-50 dark:bg-gray-900 p-3 rounded-lg mt-1 overflow-x-auto",children:JSON.stringify(a.metadata,null,2)})]}),a.error_message&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-red-500 uppercase",children:"Error"}),e.jsx("p",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg mt-1",children:a.error_message})]})]})})]})}export{V as ActivityLogs};
