import{j as e,a as j}from"./index-hyavAUaS.js";import{r as d}from"./vendor-D8AvkUoV.js";import{f as k,R as p,o as y,y as u,ak as f,al as N,m as w,am as v,i as b,w as _}from"./ui-BGIIMZpa.js";function O(){const[i,l]=d.useState(!1),[t,n]=d.useState(null),[r,c]=d.useState(null),o=async()=>{l(!0);try{const s=await j.get("/media/list.php",{params:{limit:10}}),g={timestamp:new Date().toISOString(),checks:{authentication:{status:"ok",message:"Successfully authenticated"},media_api:{status:"ok",message:`Media API working - ${s.data.total} files found`},database_connection:{status:"ok",message:"Database connected successfully"}},summary:{total_checks:3,errors:0,overall_status:"HEALTHY"},sample_media:s.data.media.slice(0,3)};n(g),c({authenticated:!0,steps:{config:"OK",database:"OK",authentication:"OK - Authenticated"},summary:"All systems operational"}),b.success("Diagnostics completed successfully")}catch(s){console.error("Diagnostics error:",s);const a={timestamp:new Date().toISOString(),checks:{authentication:{status:"error",message:s.response?.status===401?"Authentication failed - Please log out and log back in":"API Error: "+(s.message||"Unknown error")}},summary:{total_checks:1,errors:1,overall_status:"ISSUES FOUND"}};n(a),c({authenticated:!1,steps:{authentication:s.response?.status===401?"FAILED - Session expired":"FAILED - "+s.message},summary:s.response?.status===401?"Your session has expired. Please log out and log back in.":"Unable to connect to API"}),b.error("Diagnostics failed: "+(s.response?.status===401?"Session expired":s.message))}finally{l(!1)}};d.useEffect(()=>{o()},[]);const x=s=>{switch(s?.toLowerCase()){case"ok":return e.jsx(y,{className:"w-5 h-5 text-green-500"});case"error":return e.jsx(u,{className:"w-5 h-5 text-red-500"});default:return e.jsx(_,{className:"w-5 h-5 text-yellow-500"})}},m=s=>{switch(s?.toLowerCase()){case"ok":return"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800";case"error":return"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800";default:return"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800"}};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(k,{className:"w-8 h-8 text-indigo-600"}),"System Diagnostics"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Check system health and troubleshoot issues"})]}),e.jsxs("button",{onClick:o,disabled:i,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50",children:[e.jsx(p,{className:`w-4 h-4 ${i?"animate-spin":""}`}),i?"Running...":"Run Diagnostics"]})]}),t&&e.jsx("div",{className:`p-6 rounded-lg border-2 ${t.summary.overall_status==="HEALTHY"?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[t.summary.overall_status==="HEALTHY"?e.jsx(y,{className:"w-8 h-8 text-green-600"}):e.jsx(u,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["System Status: ",t.summary.overall_status]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t.summary.total_checks," checks completed â€¢ ",t.summary.errors," errors found"]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:["Last checked: ",new Date(t.timestamp).toLocaleString()]})]})]})}),t&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2 mb-4",children:[e.jsx(f,{className:"w-5 h-5 text-indigo-600"}),"Database Health"]}),e.jsx("div",{className:"space-y-3",children:Object.entries(t.checks).map(([s,a])=>e.jsx("div",{className:`p-4 rounded-lg border ${m(a.status)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[x(a.status),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white capitalize",children:s.replace(/_/g," ")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:typeof a=="string"?a:a.message||JSON.stringify(a)}),a.details&&e.jsx("pre",{className:"mt-2 text-xs bg-gray-100 dark:bg-gray-900 p-2 rounded overflow-x-auto",children:JSON.stringify(a.details,null,2)})]})]})},s))})]}),t?.all_tables&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2 mb-4",children:[e.jsx(N,{className:"w-5 h-5 text-indigo-600"}),"Database Tables (",t.all_tables.count,")"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:t.all_tables.tables.map(s=>e.jsx("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-700 rounded text-sm font-mono text-gray-700 dark:text-gray-300",children:s},s))})]}),r&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2 mb-4",children:[e.jsx(w,{className:"w-5 h-5 text-indigo-600"}),"Authentication & API Test"]}),e.jsx("div",{className:"space-y-3",children:Object.entries(r.steps||{}).map(([s,a])=>{const h=typeof a=="string"&&(a.includes("OK")||a==="Present")?"ok":"error";return e.jsx("div",{className:`p-4 rounded-lg border ${m(h)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[x(h),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white capitalize",children:s.replace(/_/g," ")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:a})]})]})},s)})}),r.authenticated&&r.session_info&&e.jsxs("div",{className:"mt-4 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Session Information"}),e.jsxs("div",{className:"text-sm space-y-1 text-gray-600 dark:text-gray-400",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",r.session_info.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Role:"})," ",r.session_info.role]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Expires:"})," ",new Date(r.session_info.expires_at).toLocaleString()]})]})]}),!r.authenticated&&e.jsxs("div",{className:"mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Authentication Issue"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.summary||"Your session may have expired. Try logging out and logging back in."})]})]}),t?.sample_media&&t.sample_media.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2 mb-4",children:[e.jsx(v,{className:"w-5 h-5 text-indigo-600"}),"Sample Media Files (",t.sample_media.length," of ",t.checks.media_count?.total_rows||0,")"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Filename"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Size"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Created"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:t.sample_media.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-300 font-mono",children:s.original_filename}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"px-2 py-1 bg-indigo-100 dark:bg-indigo-900 text-indigo-800 dark:text-indigo-200 rounded",children:s.type})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400",children:[Math.round(s.size_bytes/1024)," KB"]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400",children:new Date(s.created_at).toLocaleDateString()})]},s.id))})]})})]}),i&&!t&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(p,{className:"w-8 h-8 animate-spin text-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Running diagnostics..."})]})})]})}export{O as Diagnostics};
