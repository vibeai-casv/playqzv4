import{j as e,c as O,g as X,a as ae,d as Ne}from"./index-hyavAUaS.js";import{r}from"./vendor-D8AvkUoV.js";import{u as J}from"./useAdmin-Bv8oFjuH.js";import{M as T}from"./Modal-P7BZXlOl.js";import{a4 as se,k as B,a8 as ie,a9 as $,i as l,I as ve,X as ke,aa as le,Y as we,ab as H,ac as _e,w as te,o as Se,y as oe,R as Ce,ad as re,ae as Ie,x as Ae,D as Fe,a7 as D,af as Qe,ag as qe,K as De,u as Oe}from"./ui-BGIIMZpa.js";import{o as de,s as F,c as Me,_ as L,n as ne,u as ce,a as ge,d as Pe}from"./schemas-BznUp_a-.js";import{Z as Ee}from"./compat-DOTGHHbm.js";import{B as Te}from"./BundleImporter-DWXR0-vn.js";const Le=de({question_text:F().min(3,"Question text must be at least 3 characters"),question_type:L(["text_mcq","image_identify_logo","image_identify_person","true_false","short_answer"]),category:F().min(1,"Category is required"),difficulty:L(["easy","medium","hard"]),points:ne().min(1,"Points must be at least 1"),status:L(["active","inactive","draft"]),options:Me(F()).default([]),correct_answer:F().min(1,"Correct answer is required"),explanation:F().optional(),image_url:F().optional().refine(a=>!a||a===""||a.startsWith("/")||a.startsWith("http://")||a.startsWith("https://"),"Image URL must be a valid URL or path starting with /")}).superRefine((a,N)=>{a.status==="active"&&(a.question_type==="image_identify_logo"||a.question_type==="image_identify_person")&&(a.image_url||N.addIssue({code:Ee.custom,message:"Image is required for active image identification questions",path:["image_url"]}))}),Be=de({topic:F().min(3,"Topic is required"),count:ne().min(1).max(50),difficulty:L(["easy","medium","hard"]),type:L(["text_mcq","image_identify_logo","image_identify_person","true_false","short_answer"])});function Ue({onSelect:a,onCancel:N,defaultType:p="all"}){const{fetchMedia:k,uploadMedia:x,deleteMedia:I,isLoading:f}=J(),[v,n]=r.useState([]),[b,j]=r.useState(!1),[_,A]=r.useState(""),[i,u]=r.useState(p),o=async()=>{try{const{media:d}=await k({type:i==="all"?void 0:i});n(d)}catch(d){console.error(d),l.error("Failed to load media")}};r.useEffect(()=>{o()},[i]);const M=async d=>{const w=d.target.files?.[0];if(w){j(!0);try{let h;i!=="all"?h=i:p!=="all"?h=p:h="logo",console.log("MediaPicker Upload Debug:",{currentFilter:i,defaultTypeFromProps:p,determinedUploadType:h,fileName:w.name});const m=await x(w,h);l.success("File uploaded successfully"),a(m.url,m.original_filename)}catch(h){console.error(h);const m=h;l.error(`Failed to upload file: ${m.message||"Unknown error"}`)}finally{j(!1)}}},s=async(d,w)=>{if(d.stopPropagation(),!!confirm("Are you sure you want to delete this image?"))try{await I(w),l.success("Image deleted successfully"),o()}catch(h){console.error(h),l.error("Failed to delete image")}},Q=v.filter(d=>d.filename.toLowerCase().includes(_.toLowerCase()));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search media...",value:_,onChange:d=>A(d.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"})]}),e.jsxs("select",{value:i,onChange:d=>u(d.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"logo",children:"Logos"}),e.jsx("option",{value:"personality",children:"Personalities"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",id:"modal-file-upload",className:"hidden",accept:"image/*",onChange:M,disabled:b}),e.jsxs("label",{htmlFor:"modal-file-upload",className:O("flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 cursor-pointer",b&&"opacity-50 cursor-not-allowed"),children:[b?e.jsx(B,{className:"w-4 h-4 animate-spin"}):e.jsx(ie,{className:"w-4 h-4"}),"Upload"]})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 max-h-[400px] overflow-y-auto p-1",children:f?e.jsx("div",{className:"col-span-full flex justify-center py-8",children:e.jsx(B,{className:"w-8 h-8 animate-spin text-indigo-600"})}):Q.length===0?e.jsx("div",{className:"col-span-full text-center py-8 text-gray-500",children:"No media found"}):Q.map(d=>e.jsxs("div",{className:"group relative aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden border hover:border-indigo-500 cursor-pointer",onClick:()=>a(d.url,d.original_filename),children:[e.jsx("img",{src:X(d.url),alt:d.filename,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-white font-medium bg-indigo-600 px-3 py-1 rounded-full text-sm",children:"Select"}),e.jsx("button",{onClick:w=>s(w,d.id),className:"p-2 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors",title:"Delete image",children:e.jsx($,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 p-2 text-xs text-white truncate",children:d.original_filename||d.filename})]},d.id))}),e.jsx("div",{className:"flex justify-end pt-4 border-t dark:border-gray-700",children:e.jsx("button",{onClick:N,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300",children:"Cancel"})})]})}function Ge({question:a,onSave:N,onCancel:p}){const{createQuestion:k,updateQuestion:x,fetchMetadata:I,isLoading:f}=J(),[v,n]=r.useState(!1),[b,j]=r.useState(""),[_,A]=r.useState([]),[i,u]=r.useState(["easy","medium","hard"]),[o,M]=r.useState(["text_mcq","image_identify_logo","image_identify_person","true_false","short_answer"]);r.useEffect(()=>{(async()=>{const g=await I();g&&(g.categories&&g.categories.length>0&&A(g.categories),g.difficulties&&g.difficulties.length>0&&u(g.difficulties),g.types&&g.types.length>0&&M(g.types))})()},[]);const s=ce({resolver:ge(Le),defaultValues:{question_text:"",question_type:"text_mcq",category:"General",difficulty:"medium",points:10,status:"draft",options:["","","",""],correct_answer:"",explanation:"",image_url:""}}),{fields:Q,append:d,remove:w}=Pe({control:s.control,name:"options"});r.useEffect(()=>{a&&s.reset({question_text:a.question_text,question_type:a.question_type,category:a.category,difficulty:a.difficulty,points:a.points,status:a.status,options:a.options||[],correct_answer:a.correct_answer,explanation:a.explanation||"",image_url:a.image_url||""})},[a,s]);const h=async c=>{try{a?(await x(a.id,c),l.success("Question updated successfully")):(await k(c),l.success("Question created successfully")),N()}catch(g){console.error(g),l.error("Failed to save question")}},m=s.watch("question_type");return e.jsxs("form",{onSubmit:s.handleSubmit(h),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Question Type"}),e.jsx("select",{...s.register("question_type"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:o.map(c=>e.jsx("option",{value:c,children:{text_mcq:"Multiple Choice",image_identify_logo:"Logo Identification",image_identify_person:"Person Identification",true_false:"True/False",short_answer:"Short Answer"}[c]||c.replace(/_/g," ")},c))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Category"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{...s.register("category"),list:"categories-list",className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Select or type new category"}),e.jsx("datalist",{id:"categories-list",children:_.map((c,g)=>e.jsx("option",{value:c},g))})]}),s.formState.errors.category&&e.jsx("p",{className:"text-xs text-red-500",children:s.formState.errors.category.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Difficulty"}),e.jsx("select",{...s.register("difficulty"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:i.map(c=>e.jsx("option",{value:c,className:"capitalize",children:c},c))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Points"}),e.jsx("input",{type:"number",...s.register("points",{valueAsNumber:!0}),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Status"}),e.jsxs("select",{...s.register("status"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Question Text"}),e.jsx("textarea",{...s.register("question_text"),rows:3,className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Enter the question here..."}),s.formState.errors.question_text&&e.jsx("p",{className:"text-xs text-red-500",children:s.formState.errors.question_text.message})]}),(m==="image_identify_logo"||m==="image_identify_person")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Image"}),e.jsx("div",{className:"flex gap-4 items-start",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{...s.register("image_url"),className:"flex-1 p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"https://... or select from library"}),e.jsx("button",{type:"button",onClick:()=>n(!0),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300",children:e.jsx(ve,{className:"w-4 h-4"})})]}),s.watch("image_url")&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("div",{className:"relative w-fit group",children:[e.jsx("img",{src:X(s.watch("image_url"))||"",alt:"Preview",className:"h-32 object-contain rounded border bg-gray-50 dark:bg-gray-800"}),e.jsx("button",{type:"button",onClick:()=>s.setValue("image_url",""),className:"absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ke,{className:"w-3 h-3"})})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 break-all",children:b||s.watch("image_url")?.split("/").pop()||"Unknown"})]})]})})]}),e.jsx(T,{open:v,onClose:()=>n(!1),title:"Select Media",className:"max-w-3xl",children:e.jsx(Ue,{defaultType:m==="image_identify_logo"?"logo":m==="image_identify_person"?"personality":"all",onSelect:(c,g)=>{s.setValue("image_url",c),j(g||""),n(!1)},onCancel:()=>n(!1)})}),(m==="text_mcq"||m==="image_identify_logo"||m==="image_identify_person")&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Options"}),e.jsxs("button",{type:"button",onClick:()=>d(""),className:"text-sm text-indigo-600 hover:text-indigo-700 flex items-center gap-1",children:[e.jsx(le,{className:"w-4 h-4"})," Add Option"]})]}),e.jsx("div",{className:"space-y-2",children:Q.map((c,g)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{...s.register(`options.${g}`),className:"flex-1 p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:`Option ${g+1}`}),e.jsx("button",{type:"button",onClick:()=>w(g),className:"p-2 text-red-500 hover:bg-red-50 rounded",children:e.jsx($,{className:"w-4 h-4"})})]},c.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Correct Answer"}),m==="true_false"?e.jsxs("select",{...s.register("correct_answer"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"Select Answer"}),e.jsx("option",{value:"True",children:"True"}),e.jsx("option",{value:"False",children:"False"})]}):m==="text_mcq"||m==="image_identify_logo"||m==="image_identify_person"?e.jsxs("select",{...s.register("correct_answer"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"Select Correct Option"}),s.watch("options")?.map((c,g)=>c&&e.jsx("option",{value:c,children:c},g))]}):e.jsx("input",{...s.register("correct_answer"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Enter correct answer"}),s.formState.errors.correct_answer&&e.jsx("p",{className:"text-xs text-red-500",children:s.formState.errors.correct_answer.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Explanation (Optional)"}),e.jsx("textarea",{...s.register("explanation"),rows:2,className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Explain why this is the correct answer..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:p,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:f,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:[f?e.jsx(B,{className:"w-4 h-4 animate-spin"}):e.jsx(we,{className:"w-4 h-4"}),"Save Question"]})]})]})}function Re({onGenerate:a,onCancel:N}){const{generateQuestions:p,isLoading:k}=J(),x=ce({resolver:ge(Be),defaultValues:{topic:"",count:5,difficulty:"medium",type:"text_mcq"}}),I=async f=>{try{await p(f),l.success("Questions generated successfully! Check the Drafts tab."),a()}catch(v){console.error(v),l.error(v.message||"Failed to generate questions. Please try again.")}};return e.jsxs("form",{onSubmit:x.handleSubmit(I),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg text-sm text-purple-800 dark:text-purple-200",children:[e.jsxs("p",{className:"flex items-center gap-2 font-medium",children:[e.jsx(H,{className:"w-4 h-4"})," AI Generation"]}),e.jsxs("p",{className:"mt-1 opacity-90",children:["Generated questions will be saved as ",e.jsx("strong",{children:"Drafts"}),". You can review and activate them later."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Topic / Subject"}),e.jsx("input",{...x.register("topic"),className:"w-full p-2 border rounded-lg text-gray-900 dark:text-gray-100 dark:bg-gray-700 dark:border-gray-600",placeholder:"e.g. Solar System, World War II, Python Programming"}),x.formState.errors.topic&&e.jsx("p",{className:"text-xs text-red-500",children:x.formState.errors.topic.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Number of Questions"}),e.jsx("input",{type:"number",...x.register("count",{valueAsNumber:!0}),className:"w-full p-2 border rounded-lg text-gray-900 dark:text-gray-100 dark:bg-gray-700 dark:border-gray-600",min:1,max:50}),x.formState.errors.count&&e.jsx("p",{className:"text-xs text-red-500",children:x.formState.errors.count.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Difficulty"}),e.jsxs("select",{...x.register("difficulty"),className:"w-full p-2 border rounded-lg text-gray-900 dark:text-gray-100 dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"hard",children:"Hard"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Question Type"}),e.jsxs("select",{...x.register("type"),className:"w-full p-2 border rounded-lg text-gray-900 dark:text-gray-100 dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"text_mcq",children:"Multiple Choice"}),e.jsx("option",{value:"image_identify_logo",children:"Logo Identification"}),e.jsx("option",{value:"image_identify_person",children:"Person Identification"}),e.jsx("option",{value:"true_false",children:"True/False"}),e.jsx("option",{value:"short_answer",children:"Short Answer"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:N,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:k,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[k?e.jsx(B,{className:"w-4 h-4 animate-spin"}):e.jsx(H,{className:"w-4 h-4"}),"Generate"]})]})]})}function ze({onImportComplete:a,onCancel:N}){const[p,k]=r.useState(null),[x,I]=r.useState(!0),[f,v]=r.useState(!1),[n,b]=r.useState(null),j=i=>{const u=i.target.files?.[0];if(u){if(u.type!=="application/json"){l.error("Please select a JSON file");return}k(u),b(null)}},_=async()=>{if(!p){l.error("Please select a file");return}v(!0),b(null);try{const i=await p.text(),u=JSON.parse(i);if(!Array.isArray(u)){l.error("JSON file must contain an array of questions"),v(!1);return}const o=await ae.post("/questions/import.php",{questions:u,skipDuplicates:x});b(o.data),o.data.imported>0?(l.success(`Successfully imported ${o.data.imported} questions!`),o.data.skipped>0&&l.info(`Skipped ${o.data.skipped} duplicate questions`)):l.warning("No questions were imported"),o.data.errors.length>0&&console.error("Import errors:",o.data.errors)}catch(i){console.error("Import error:",i);let u="Failed to import questions";if(Ne.isAxiosError(i))if(i.response){const o=i.response.data;o.error&&(u=o.error),(o.imported>0||o.skipped>0)&&(b({imported:o.imported||0,skipped:o.skipped||0,errors:o.errors||[],total_processed:o.total_processed||0}),o.imported>0&&l.success(`Partially imported ${o.imported} questions`)),console.error("Server error:",o)}else i.request?(u="No response from server. Check your connection.",console.error("No response:",i.request)):u=i.message;else i instanceof Error&&(u=i.message);l.error(u)}finally{v(!1)}},A=()=>{n&&n.imported>0?a():N()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center",children:[e.jsx(_e,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("span",{className:"text-indigo-600 hover:text-indigo-700 font-medium",children:"Choose a JSON file"}),e.jsx("input",{type:"file",accept:".json",onChange:j,className:"hidden"})]}),p&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["Selected: ",p.name]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"skipDuplicates",checked:x,onChange:i=>I(i.target.checked),className:"rounded border-gray-300"}),e.jsx("label",{htmlFor:"skipDuplicates",className:"text-sm text-gray-700 dark:text-gray-300",children:"Skip duplicate questions (based on question text)"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2 flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Expected JSON Format"]}),e.jsx("pre",{className:"text-xs bg-white dark:bg-gray-800 p-3 rounded overflow-x-auto",children:`[
  {
    "type": "text_mcq",
    "category": "Fundamentals",
    "difficulty": "easy",
    "question": "What is AI?",
    "options": ["Option 1", "Option 2", "Option 3", "Option 4"],
    "correct_answer": "Option 1",
    "image_url": "optional",
    "explanation": "optional"
  }
]`})]})]}),n&&e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:[e.jsx(Se,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Imported: ",n.imported," questions"]})]}),n.skipped>0&&e.jsxs("div",{className:"flex items-center gap-2 text-yellow-600 dark:text-yellow-400",children:[e.jsx(te,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Skipped: ",n.skipped," duplicates"]})]}),n.errors.length>0&&e.jsxs("div",{className:"flex items-start gap-2 text-red-600 dark:text-red-400",children:[e.jsx(oe,{className:"w-5 h-5 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-medium block mb-1",children:["Errors: ",n.errors.length]}),e.jsx("div",{className:"text-sm space-y-1 max-h-40 overflow-y-auto",children:n.errors.map((i,u)=>e.jsxs("div",{className:"text-xs",children:["â€¢ ",i]},u))})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 pt-2 border-t border-gray-200 dark:border-gray-600",children:["Total processed: ",n.total_processed]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:A,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:n&&n.imported>0?"Close":"Cancel"}),e.jsxs("button",{onClick:_,disabled:!p||f,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ie,{className:"w-4 h-4"}),f?"Importing...":"Import Questions"]})]})]})}function Ke(){const{fetchQuestions:a,deleteQuestion:N,updateQuestion:p,isLoading:k}=J(),[x,I]=r.useState([]),[f,v]=r.useState(0),[n,b]=r.useState(1),[j]=r.useState(50),[_,A]=r.useState(""),[i,u]=r.useState(""),[o,M]=r.useState(""),[s,Q]=r.useState(""),[d,w]=r.useState(""),[h,m]=r.useState(void 0),[c,g]=r.useState("created_at"),[W,Y]=r.useState("desc"),[S,U]=r.useState(new Set),[xe,P]=r.useState(!1),[ue,G]=r.useState(!1),[me,R]=r.useState(!1),[pe,z]=r.useState(!1),[K,ee]=r.useState(void 0),C=r.useCallback(async()=>{try{const t=(n-1)*j,{questions:y,total:Z}=await a({search:_,category:i||void 0,difficulty:o||void 0,type:s||void 0,status:d||void 0,ai_generated:h,limit:j,offset:t,sortBy:c,sortOrder:W});I(y),v(Z)}catch(t){console.error(t),l.error("Failed to load questions")}},[n,j,_,i,o,s,d,h,c,W,a]);r.useEffect(()=>{const t=setTimeout(()=>{C()},300);return()=>clearTimeout(t)},[C]);const q=t=>{c===t?Y(W==="asc"?"desc":"asc"):(g(t),Y("asc"))},he=async t=>{if(confirm("Are you sure you want to delete this question?"))try{await N(t),l.success("Question deleted"),C()}catch(y){console.error(y),l.error("Failed to delete question")}},ye=async t=>{try{await p(t.id,{is_demo:!t.is_demo}),l.success(`Question ${t.is_demo?"removed from":"added to"} Demo`),C()}catch(y){console.error(y),l.error("Failed to update question")}},fe=async()=>{if(S.size!==0)try{const t=l.loading("Creating export bundle..."),y=await ae.post("/bundle/export.php",{question_ids:Array.from(S)},{responseType:"blob"}),Z=window.URL.createObjectURL(new Blob([y.data])),E=document.createElement("a");E.href=Z,E.setAttribute("download",`question_bundle_${new Date().toISOString().slice(0,10)}.zip`),document.body.appendChild(E),E.click(),E.remove(),l.dismiss(t),l.success("Bundle downloaded successfully")}catch(t){console.error("Export error:",t),l.error("Failed to export bundle")}},V=async t=>{if(S.size!==0&&!(t==="delete"&&!confirm(`Delete ${S.size} questions?`)))try{await Promise.all(Array.from(S).map(y=>t==="delete"?N(y):p(y,{status:t==="activate"?"active":"inactive"}))),l.success("Bulk action completed"),U(new Set),C()}catch(y){console.error(y),l.error("Failed to perform bulk action")}},be=t=>{const y=new Set(S);y.has(t)?y.delete(t):y.add(t),U(y)},je=()=>{S.size===x.length?U(new Set):U(new Set(x.map(t=>t.id)))};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Question Bank"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>C(),className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",title:"Refresh List",children:e.jsx(Ce,{className:`w-4 h-4 ${k?"animate-spin":""}`})}),e.jsxs("button",{onClick:()=>R(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(re,{className:"w-4 h-4"})," Import JSON"]}),e.jsxs("button",{onClick:()=>z(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(Ie,{className:"w-4 h-4"})," Import Bundle"]}),e.jsxs("button",{onClick:()=>G(!0),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[e.jsx(H,{className:"w-4 h-4"})," AI Generate"]}),e.jsxs("button",{onClick:()=>{ee(void 0),P(!0)},className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:[e.jsx(le,{className:"w-4 h-4"})," Add Question"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search questions...",value:_,onChange:t=>A(t.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg text-gray-900 bg-white border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"})]}),e.jsx("input",{type:"text",placeholder:"Filter by Category",value:i,onChange:t=>u(t.target.value),className:"w-full px-4 py-2 border rounded-lg text-gray-900 bg-white border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"}),e.jsxs("select",{value:s,onChange:t=>Q(t.target.value),className:"w-full px-4 py-2 border rounded-lg text-gray-900 bg-white border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"text_mcq",children:"Multiple Choice"}),e.jsx("option",{value:"image_identify_logo",children:"Logo Identification"}),e.jsx("option",{value:"image_identify_person",children:"Person Identification"}),e.jsx("option",{value:"true_false",children:"True/False"}),e.jsx("option",{value:"short_answer",children:"Short Answer"})]}),e.jsxs("select",{value:o,onChange:t=>M(t.target.value),className:"w-full px-4 py-2 border rounded-lg text-gray-900 bg-white border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"All Difficulties"}),e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"hard",children:"Hard"})]}),e.jsxs("select",{value:d,onChange:t=>w(t.target.value),className:"w-full px-4 py-2 border rounded-lg text-gray-900 bg-white border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"draft",children:"Draft"})]}),e.jsxs("select",{value:h===void 0?"":h.toString(),onChange:t=>m(t.target.value===""?void 0:t.target.value==="true"),className:"w-full px-4 py-2 border rounded-lg text-gray-900 bg-white border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"All Sources"}),e.jsx("option",{value:"true",children:"AI Generated"}),e.jsx("option",{value:"false",children:"Manual"})]})]})}),S.size>0&&e.jsxs("div",{className:"flex gap-2 pt-2 border-t dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>V("activate"),className:"flex items-center gap-2 px-3 py-1.5 bg-green-100 text-green-700 rounded hover:bg-green-200 text-sm",children:[e.jsx(Ae,{className:"w-4 h-4"})," Activate Selected"]}),e.jsxs("button",{onClick:()=>V("deactivate"),className:"flex items-center gap-2 px-3 py-1.5 bg-yellow-100 text-yellow-700 rounded hover:bg-yellow-200 text-sm",children:[e.jsx(oe,{className:"w-4 h-4"})," Deactivate Selected"]}),e.jsxs("button",{onClick:()=>V("delete"),className:"flex items-center gap-2 px-3 py-1.5 bg-red-100 text-red-700 rounded hover:bg-red-200 text-sm",children:[e.jsx($,{className:"w-4 h-4"})," Delete Selected"]}),e.jsxs("button",{onClick:fe,className:"flex items-center gap-2 px-3 py-1.5 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 text-sm",children:[e.jsx(Fe,{className:"w-4 h-4"})," Export Bundle"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 w-4",children:e.jsx("input",{type:"checkbox",checked:S.size===x.length&&x.length>0,onChange:je,className:"rounded border-gray-300"})}),e.jsx("th",{className:"p-4 w-10"})," ",e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>q("question_text"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Question ",e.jsx(D,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 w-10 text-center",children:"Demo"}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>q("question_type"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Type ",e.jsx(D,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>q("category"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Category ",e.jsx(D,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>q("difficulty"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Difficulty ",e.jsx(D,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>q("points"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Pts ",e.jsx(D,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>q("status"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Status ",e.jsx(D,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:k?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"p-8 text-center",children:e.jsx(B,{className:"w-8 h-8 animate-spin mx-auto text-indigo-600"})})}):x.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"p-8 text-center text-gray-500 dark:text-gray-400",children:"No questions found"})}):x.map(t=>e.jsxs("tr",{className:O("hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",t.status==="inactive"&&"opacity-60 bg-gray-50/50 dark:bg-gray-800/50 grayscale-[0.5]"),children:[e.jsx("td",{className:"p-4",children:e.jsx("input",{type:"checkbox",checked:S.has(t.id),onChange:()=>be(t.id),className:"rounded border-gray-300"})}),e.jsx("td",{className:"p-4",children:t.image_url?e.jsx("img",{src:X(t.image_url),alt:"Q",className:"w-16 h-16 object-cover rounded border border-gray-200 dark:border-gray-700 bg-white"}):t.media_id&&e.jsx("div",{className:"w-10 h-10 rounded bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-500 dark:text-gray-400",children:e.jsx(re,{className:"w-5 h-5"})})}),e.jsxs("td",{className:"p-4 max-w-md group",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"truncate font-medium text-gray-900 dark:text-gray-100",title:t.question_text,children:t.question_text}),e.jsx("button",{onClick:()=>{ee(t),P(!0)},className:"p-1 text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 opacity-0 group-hover:opacity-100 transition-opacity",title:"Edit Question",children:e.jsx(Qe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5 truncate",title:t.correct_answer,children:["Ans: ",t.correct_answer]})]}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("button",{onClick:()=>ye(t),className:O("p-1 rounded-full transition-colors",t.is_demo?"text-yellow-400 hover:text-yellow-500 bg-yellow-400/10":"text-gray-300 hover:text-yellow-400 dark:text-gray-600 dark:hover:text-yellow-400"),title:t.is_demo?"Remove from Demo":"Add to Demo",children:e.jsx(qe,{className:O("w-4 h-4",t.is_demo&&"fill-current")})})}),e.jsx("td",{className:"p-4 text-sm text-gray-700 dark:text-gray-300",children:{text_mcq:"Multiple Choice",image_identify_logo:"Logo Identification",image_identify_person:"Person Identification",true_false:"True/False",short_answer:"Short Answer"}[t.question_type]||t.question_type.replace(/_/g," ")}),e.jsx("td",{className:"p-4 text-sm text-gray-700 dark:text-gray-300",children:t.category}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:O("px-2 py-1 rounded-full text-xs font-medium capitalize",t.difficulty==="easy"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":t.difficulty==="medium"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"),children:t.difficulty})}),e.jsx("td",{className:"p-4 text-sm font-medium text-gray-700 dark:text-gray-300",children:t.points}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:O("px-2 py-1 rounded-full text-xs font-medium capitalize",t.status==="active"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":t.status==="inactive"?"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"),children:t.status})}),e.jsx("td",{className:"p-4 text-right",children:e.jsx("button",{onClick:()=>he(t.id),className:"p-1 text-gray-500 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors",title:"Delete",children:e.jsx($,{className:"w-4 h-4"})})})]},t.id))})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Showing ",(n-1)*j+1," to ",Math.min(n*j,f)," of ",f," questions"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(t=>Math.max(1,t-1)),disabled:n===1,className:"p-2 border rounded hover:bg-gray-50 disabled:opacity-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",children:e.jsx(De,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>b(t=>t+1),disabled:n*j>=f,className:"p-2 border rounded hover:bg-gray-50 disabled:opacity-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",children:e.jsx(Oe,{className:"w-4 h-4"})})]})]})]}),e.jsx(T,{open:xe,onClose:()=>P(!1),title:K?"Edit Question":"Create Question",className:"max-w-4xl",children:e.jsx(Ge,{question:K,onSave:async()=>{P(!1),C()},onCancel:()=>P(!1)})}),e.jsx(T,{open:ue,onClose:()=>G(!1),title:"AI Question Generator",className:"max-w-2xl",children:e.jsx(Re,{onGenerate:async()=>{G(!1),C()},onCancel:()=>G(!1)})}),e.jsx(T,{open:me,onClose:()=>R(!1),title:"Import Questions from JSON",className:"max-w-3xl",children:e.jsx(ze,{onImportComplete:()=>{R(!1),C()},onCancel:()=>R(!1)})}),e.jsx(T,{open:pe,onClose:()=>z(!1),title:"Import Question Bundle (ZIP)",className:"max-w-3xl",children:e.jsx(Te,{onImportComplete:()=>{z(!1),C()},onCancel:()=>z(!1)})})]})}export{Ke as Questions};
