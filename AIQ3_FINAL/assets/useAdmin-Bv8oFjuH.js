import{r as p}from"./vendor-D8AvkUoV.js";import{a as n}from"./index-hyavAUaS.js";function $(){const[m,s]=p.useState(!1),[y,a]=p.useState(null),h=async r=>{s(!0),a(null);try{const t={...r},e=await n.get("/admin/users.php",{params:t});return{users:e.data.users,total:e.data.total}}catch(t){const e=t instanceof Error?t.message:"An error occurred";throw a(e),t}finally{s(!1)}},g=async r=>{s(!0),a(null);try{const t={...r};r?.startDate&&(t.startDate=r.startDate.toISOString()),r?.endDate&&(t.endDate=r.endDate.toISOString());const e=await n.get("/analytics/logs.php",{params:t});return{logs:e.data.logs,total:e.data.total}}catch(t){const e=t instanceof Error?t.message:"An error occurred";throw a(e),t}finally{s(!1)}},w=async r=>{s(!0),a(null);try{const t=await n.get("/admin/user_activity.php",{params:{userId:r}});return{logins:t.data.logins,attempts:t.data.attempts,activity:t.data.activity}}catch(t){const e=t instanceof Error?t.message:"An error occurred";throw a(e),t}finally{s(!1)}},A=async(r,t,e)=>{s(!0),a(null);try{await n.post("/admin/toggle_user.php",{userId:r,disabled:t,reason:e})}catch(o){const l=o instanceof Error?o.message:"An error occurred";throw a(l),o}finally{s(!1)}},E=async(r,t)=>{s(!0),a(null);try{await n.post("/admin/update_role.php",{user_id:r,role:t})}catch(e){const o=e instanceof Error?e.message:"An error occurred";throw a(o),e}finally{s(!1)}},S=p.useCallback(async r=>{s(!0),a(null);try{const t=await n.get("/questions/list.php",{params:{...r,_t:Date.now()}});return{questions:t.data.data,total:t.data.total}}catch(t){const e=t instanceof Error?t.message:"An error occurred";throw a(e),t}finally{s(!1)}},[]);return{isLoading:m,error:y,fetchUsers:h,fetchUserActivity:w,fetchActivityLogs:g,toggleUserStatus:A,updateUserRole:E,fetchQuestions:S,createQuestion:async r=>{s(!0),a(null);try{return(await n.post("/questions/create.php",r)).data}catch(t){const e=t instanceof Error?t.message:"An error occurred";throw a(e),t}finally{s(!1)}},updateQuestion:async(r,t)=>{s(!0),a(null);try{return(await n.post("/questions/update.php",{id:r,...t})).data.data}catch(e){const o=e instanceof Error?e.message:"An error occurred";throw a(o),e}finally{s(!1)}},deleteQuestion:async r=>{s(!0),a(null);try{await n.post("/questions/delete.php",{id:r})}catch(t){const e=t instanceof Error?t.message:"An error occurred";throw a(e),t}finally{s(!1)}},generateQuestions:async r=>{s(!0),a(null);try{return(await n.post("/admin/generate_questions.php",r)).data}catch(t){const e=t.response?.data?.error||(t instanceof Error?t.message:"An error occurred");throw a(e),new Error(e)}finally{s(!1)}},fetchMedia:async r=>{s(!0),a(null);try{const t=await n.get("/media/list.php",{params:r});return{media:t.data.media,total:t.data.total}}catch(t){const e=t instanceof Error?t.message:"An error occurred";throw a(e),t}finally{s(!1)}},uploadMedia:async(r,t,e)=>{s(!0),a(null);const o=3,l=1e3;for(let i=1;i<=o;i++)try{const c=new FormData;return c.append("file",r),c.append("type",t),e&&c.append("description",e),(await n.post("/media/upload.php",c,{headers:{"Content-Type":"multipart/form-data"}})).data.media}catch(c){const d=c instanceof Error?c.message:"An error occurred";a(d);const u=c;if(u.response&&u.response.status>=400&&u.response.status<500)throw c;if(i<o){const f=l*Math.pow(2,i-1);console.warn(`Upload attempt ${i} failed. Retrying in ${f}ms...`),await new Promise(D=>setTimeout(D,f));continue}throw c}throw new Error("Upload failed after all retry attempts")},deleteMedia:async r=>{s(!0),a(null);try{await n.post("/media/delete.php",{id:r})}catch(t){const e=t instanceof Error?t.message:"An error occurred";throw a(e),t}finally{s(!1)}},fetchAnalytics:async(r,t)=>{s(!0),a(null);try{const e={};return r&&(e.startDate=r.toISOString()),t&&(e.endDate=t.toISOString()),(await n.get("/admin/analytics.php",{params:e})).data}catch(e){const o=e instanceof Error?e.message:"An error occurred";throw a(o),e}finally{s(!1)}},fetchDailyStats:async()=>[],fetchCategoryStats:async()=>[],fetchRegistrationStats:async()=>[],fetchMetadata:async()=>{s(!0),a(null);try{return(await n.get("/metadata/list.php")).data}catch(r){const t=r instanceof Error?r.message:"An error occurred";return a(t),{categories:[],types:[],difficulties:[],tags:[]}}finally{s(!1)}}}}export{$ as u};
