import{j as e,c as F,g as H,a as re,d as Ne}from"./index-C-OiRgPF.js";import{r as a}from"./vendor-D8AvkUoV.js";import{u as z}from"./useAdmin-DLJkd9fB.js";import{M as E}from"./Modal-DbdLNlYX.js";import{a3 as se,j as P,a7 as ae,a8 as U,h as o,I as ve,X as we,a9 as ie,V as ke,aa as Z,ab as _e,v as ee,n as Se,x as le,R as Ce,ac as te,ad as Ie,w as Ae,D as Qe,a6 as q,ae as qe,af as Fe,J as De,s as Oe}from"./ui-BDjwW725.js";import{o as oe,s as I,c as Te,_ as M,n as de,u as ne,a as ce,d as Ee}from"./schemas-BznUp_a-.js";import{Z as Me}from"./compat-DOTGHHbm.js";import{B as Pe}from"./BundleImporter-zbfT_3o8.js";const Le=oe({question_text:I().min(3,"Question text must be at least 3 characters"),question_type:M(["text_mcq","image_identify_logo","image_identify_person","true_false","short_answer"]),category:I().min(1,"Category is required"),difficulty:M(["easy","medium","hard"]),points:de().min(1,"Points must be at least 1"),status:M(["active","inactive","draft"]),options:Te(I()).default([]),correct_answer:I().min(1,"Correct answer is required"),explanation:I().optional(),image_url:I().optional().refine(s=>!s||s===""||s.startsWith("/")||s.startsWith("http://")||s.startsWith("https://"),"Image URL must be a valid URL or path starting with /")}).superRefine((s,b)=>{s.status==="active"&&(s.question_type==="image_identify_logo"||s.question_type==="image_identify_person")&&(s.image_url||b.addIssue({code:Me.custom,message:"Image is required for active image identification questions",path:["image_url"]}))}),Be=oe({topic:I().min(3,"Topic is required"),count:de().min(1).max(50),difficulty:M(["easy","medium","hard"]),type:M(["text_mcq","image_identify_logo","image_identify_person","true_false","short_answer"])});function Ge({onSelect:s,onCancel:b,defaultType:p="all"}){const{fetchMedia:N,uploadMedia:g,deleteMedia:_,isLoading:h}=z(),[j,d]=a.useState([]),[y,f]=a.useState(!1),[v,S]=a.useState(""),[l,x]=a.useState(p),r=async()=>{try{const{media:n}=await N({type:l==="all"?void 0:l});d(n)}catch(n){console.error(n),o.error("Failed to load media")}};a.useEffect(()=>{r()},[l]);const D=async n=>{const u=n.target.files?.[0];if(u){f(!0);try{const c=await g(u,l==="all"?"logo":l);o.success("File uploaded successfully"),s(c.url)}catch(i){console.error(i),o.error("Failed to upload file")}finally{f(!1)}}},C=async(n,u)=>{if(n.stopPropagation(),!!confirm("Are you sure you want to delete this image?"))try{await _(u),o.success("Image deleted successfully"),r()}catch(i){console.error(i),o.error("Failed to delete image")}},A=j.filter(n=>n.filename.toLowerCase().includes(v.toLowerCase()));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search media...",value:v,onChange:n=>S(n.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"})]}),e.jsxs("select",{value:l,onChange:n=>x(n.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"logo",children:"Logos"}),e.jsx("option",{value:"personality",children:"Personalities"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",id:"modal-file-upload",className:"hidden",accept:"image/*",onChange:D,disabled:y}),e.jsxs("label",{htmlFor:"modal-file-upload",className:F("flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 cursor-pointer",y&&"opacity-50 cursor-not-allowed"),children:[y?e.jsx(P,{className:"w-4 h-4 animate-spin"}):e.jsx(ae,{className:"w-4 h-4"}),"Upload"]})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 max-h-[400px] overflow-y-auto p-1",children:h?e.jsx("div",{className:"col-span-full flex justify-center py-8",children:e.jsx(P,{className:"w-8 h-8 animate-spin text-indigo-600"})}):A.length===0?e.jsx("div",{className:"col-span-full text-center py-8 text-gray-500",children:"No media found"}):A.map(n=>e.jsxs("div",{className:"group relative aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden border hover:border-indigo-500 cursor-pointer",onClick:()=>s(n.url),children:[e.jsx("img",{src:H(n.url),alt:n.filename,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-white font-medium bg-indigo-600 px-3 py-1 rounded-full text-sm",children:"Select"}),e.jsx("button",{onClick:u=>C(u,n.id),className:"p-2 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors",title:"Delete image",children:e.jsx(U,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 p-2 text-xs text-white truncate",children:n.filename})]},n.id))}),e.jsx("div",{className:"flex justify-end pt-4 border-t dark:border-gray-700",children:e.jsx("button",{onClick:b,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300",children:"Cancel"})})]})}function Re({question:s,onSave:b,onCancel:p}){const{createQuestion:N,updateQuestion:g,fetchMetadata:_,isLoading:h}=z(),[j,d]=a.useState(!1),[y,f]=a.useState([]),[v,S]=a.useState(["easy","medium","hard"]),[l,x]=a.useState(["text_mcq","image_identify_logo","image_identify_person","true_false","short_answer"]);a.useEffect(()=>{(async()=>{const c=await _();c&&(c.categories&&c.categories.length>0&&f(c.categories),c.difficulties&&c.difficulties.length>0&&S(c.difficulties),c.types&&c.types.length>0&&x(c.types))})()},[]);const r=ne({resolver:ce(Le),defaultValues:{question_text:"",question_type:"text_mcq",category:"General",difficulty:"medium",points:10,status:"draft",options:["","","",""],correct_answer:"",explanation:"",image_url:""}}),{fields:D,append:C,remove:A}=Ee({control:r.control,name:"options"});a.useEffect(()=>{s&&r.reset({question_text:s.question_text,question_type:s.question_type,category:s.category,difficulty:s.difficulty,points:s.points,status:s.status,options:s.options||[],correct_answer:s.correct_answer,explanation:s.explanation||"",image_url:s.image_url||""})},[s,r]);const n=async i=>{try{s?(await g(s.id,i),o.success("Question updated successfully")):(await N(i),o.success("Question created successfully")),b()}catch(c){console.error(c),o.error("Failed to save question")}},u=r.watch("question_type");return e.jsxs("form",{onSubmit:r.handleSubmit(n),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Question Type"}),e.jsx("select",{...r.register("question_type"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:l.map(i=>e.jsx("option",{value:i,children:{text_mcq:"Multiple Choice",image_identify_logo:"Logo Identification",image_identify_person:"Person Identification",true_false:"True/False",short_answer:"Short Answer"}[i]||i.replace(/_/g," ")},i))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Category"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{...r.register("category"),list:"categories-list",className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Select or type new category"}),e.jsx("datalist",{id:"categories-list",children:y.map((i,c)=>e.jsx("option",{value:i},c))})]}),r.formState.errors.category&&e.jsx("p",{className:"text-xs text-red-500",children:r.formState.errors.category.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Difficulty"}),e.jsx("select",{...r.register("difficulty"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:v.map(i=>e.jsx("option",{value:i,className:"capitalize",children:i},i))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Points"}),e.jsx("input",{type:"number",...r.register("points",{valueAsNumber:!0}),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Status"}),e.jsxs("select",{...r.register("status"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Question Text"}),e.jsx("textarea",{...r.register("question_text"),rows:3,className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Enter the question here..."}),r.formState.errors.question_text&&e.jsx("p",{className:"text-xs text-red-500",children:r.formState.errors.question_text.message})]}),(u==="image_identify_logo"||u==="image_identify_person")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Image"}),e.jsx("div",{className:"flex gap-4 items-start",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{...r.register("image_url"),className:"flex-1 p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"https://... or select from library"}),e.jsx("button",{type:"button",onClick:()=>d(!0),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300",children:e.jsx(ve,{className:"w-4 h-4"})})]}),r.watch("image_url")&&e.jsxs("div",{className:"mt-2 relative w-fit group",children:[e.jsx("img",{src:H(r.watch("image_url"))||"",alt:"Preview",className:"h-32 object-contain rounded border bg-gray-50 dark:bg-gray-800"}),e.jsx("button",{type:"button",onClick:()=>r.setValue("image_url",""),className:"absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(we,{className:"w-3 h-3"})})]})]})})]}),e.jsx(E,{open:j,onClose:()=>d(!1),title:"Select Media",className:"max-w-3xl",children:e.jsx(Ge,{defaultType:u==="image_identify_logo"?"logo":u==="image_identify_person"?"personality":"all",onSelect:i=>{r.setValue("image_url",i),d(!1)},onCancel:()=>d(!1)})}),(u==="text_mcq"||u==="image_identify_logo"||u==="image_identify_person")&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Options"}),e.jsxs("button",{type:"button",onClick:()=>C(""),className:"text-sm text-indigo-600 hover:text-indigo-700 flex items-center gap-1",children:[e.jsx(ie,{className:"w-4 h-4"})," Add Option"]})]}),e.jsx("div",{className:"space-y-2",children:D.map((i,c)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{...r.register(`options.${c}`),className:"flex-1 p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:`Option ${c+1}`}),e.jsx("button",{type:"button",onClick:()=>A(c),className:"p-2 text-red-500 hover:bg-red-50 rounded",children:e.jsx(U,{className:"w-4 h-4"})})]},i.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Correct Answer"}),u==="true_false"?e.jsxs("select",{...r.register("correct_answer"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"Select Answer"}),e.jsx("option",{value:"True",children:"True"}),e.jsx("option",{value:"False",children:"False"})]}):u==="text_mcq"||u==="image_identify_logo"||u==="image_identify_person"?e.jsxs("select",{...r.register("correct_answer"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"Select Correct Option"}),r.watch("options")?.map((i,c)=>i&&e.jsx("option",{value:i,children:i},c))]}):e.jsx("input",{...r.register("correct_answer"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Enter correct answer"}),r.formState.errors.correct_answer&&e.jsx("p",{className:"text-xs text-red-500",children:r.formState.errors.correct_answer.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Explanation (Optional)"}),e.jsx("textarea",{...r.register("explanation"),rows:2,className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Explain why this is the correct answer..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:p,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:h,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:[h?e.jsx(P,{className:"w-4 h-4 animate-spin"}):e.jsx(ke,{className:"w-4 h-4"}),"Save Question"]})]})]})}function Ue({onGenerate:s,onCancel:b}){const{generateQuestions:p,isLoading:N}=z(),g=ne({resolver:ce(Be),defaultValues:{topic:"",count:5,difficulty:"medium",type:"text_mcq"}}),_=async h=>{try{await p(h),o.success("Questions generated successfully! Check the Drafts tab."),s()}catch(j){console.error(j),o.error(j.message||"Failed to generate questions. Please try again.")}};return e.jsxs("form",{onSubmit:g.handleSubmit(_),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg text-sm text-purple-800 dark:text-purple-200",children:[e.jsxs("p",{className:"flex items-center gap-2 font-medium",children:[e.jsx(Z,{className:"w-4 h-4"})," AI Generation"]}),e.jsxs("p",{className:"mt-1 opacity-90",children:["Generated questions will be saved as ",e.jsx("strong",{children:"Drafts"}),". You can review and activate them later."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Topic / Subject"}),e.jsx("input",{...g.register("topic"),className:"w-full p-2 border rounded-lg text-gray-900 dark:text-gray-100 dark:bg-gray-700 dark:border-gray-600",placeholder:"e.g. Solar System, World War II, Python Programming"}),g.formState.errors.topic&&e.jsx("p",{className:"text-xs text-red-500",children:g.formState.errors.topic.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Number of Questions"}),e.jsx("input",{type:"number",...g.register("count",{valueAsNumber:!0}),className:"w-full p-2 border rounded-lg text-gray-900 dark:text-gray-100 dark:bg-gray-700 dark:border-gray-600",min:1,max:50}),g.formState.errors.count&&e.jsx("p",{className:"text-xs text-red-500",children:g.formState.errors.count.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Difficulty"}),e.jsxs("select",{...g.register("difficulty"),className:"w-full p-2 border rounded-lg text-gray-900 dark:text-gray-100 dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"hard",children:"Hard"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Question Type"}),e.jsxs("select",{...g.register("type"),className:"w-full p-2 border rounded-lg text-gray-900 dark:text-gray-100 dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"text_mcq",children:"Multiple Choice"}),e.jsx("option",{value:"image_identify_logo",children:"Logo Identification"}),e.jsx("option",{value:"image_identify_person",children:"Person Identification"}),e.jsx("option",{value:"true_false",children:"True/False"}),e.jsx("option",{value:"short_answer",children:"Short Answer"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:b,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:N,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[N?e.jsx(P,{className:"w-4 h-4 animate-spin"}):e.jsx(Z,{className:"w-4 h-4"}),"Generate"]})]})]})}function ze({onImportComplete:s,onCancel:b}){const[p,N]=a.useState(null),[g,_]=a.useState(!0),[h,j]=a.useState(!1),[d,y]=a.useState(null),f=l=>{const x=l.target.files?.[0];if(x){if(x.type!=="application/json"){o.error("Please select a JSON file");return}N(x),y(null)}},v=async()=>{if(!p){o.error("Please select a file");return}j(!0),y(null);try{const l=await p.text(),x=JSON.parse(l);if(!Array.isArray(x)){o.error("JSON file must contain an array of questions"),j(!1);return}const r=await re.post("/questions/import.php",{questions:x,skipDuplicates:g});y(r.data),r.data.imported>0?(o.success(`Successfully imported ${r.data.imported} questions!`),r.data.skipped>0&&o.info(`Skipped ${r.data.skipped} duplicate questions`)):o.warning("No questions were imported"),r.data.errors.length>0&&console.error("Import errors:",r.data.errors)}catch(l){console.error("Import error:",l);let x="Failed to import questions";if(Ne.isAxiosError(l))if(l.response){const r=l.response.data;r.error&&(x=r.error),(r.imported>0||r.skipped>0)&&(y({imported:r.imported||0,skipped:r.skipped||0,errors:r.errors||[],total_processed:r.total_processed||0}),r.imported>0&&o.success(`Partially imported ${r.imported} questions`)),console.error("Server error:",r)}else l.request?(x="No response from server. Check your connection.",console.error("No response:",l.request)):x=l.message;else l instanceof Error&&(x=l.message);o.error(x)}finally{j(!1)}},S=()=>{d&&d.imported>0?s():b()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center",children:[e.jsx(_e,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("span",{className:"text-indigo-600 hover:text-indigo-700 font-medium",children:"Choose a JSON file"}),e.jsx("input",{type:"file",accept:".json",onChange:f,className:"hidden"})]}),p&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["Selected: ",p.name]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"skipDuplicates",checked:g,onChange:l=>_(l.target.checked),className:"rounded border-gray-300"}),e.jsx("label",{htmlFor:"skipDuplicates",className:"text-sm text-gray-700 dark:text-gray-300",children:"Skip duplicate questions (based on question text)"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2 flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"Expected JSON Format"]}),e.jsx("pre",{className:"text-xs bg-white dark:bg-gray-800 p-3 rounded overflow-x-auto",children:`[
  {
    "type": "text_mcq",
    "category": "Fundamentals",
    "difficulty": "easy",
    "question": "What is AI?",
    "options": ["Option 1", "Option 2", "Option 3", "Option 4"],
    "correct_answer": "Option 1",
    "image_url": "optional",
    "explanation": "optional"
  }
]`})]})]}),d&&e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:[e.jsx(Se,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Imported: ",d.imported," questions"]})]}),d.skipped>0&&e.jsxs("div",{className:"flex items-center gap-2 text-yellow-600 dark:text-yellow-400",children:[e.jsx(ee,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Skipped: ",d.skipped," duplicates"]})]}),d.errors.length>0&&e.jsxs("div",{className:"flex items-start gap-2 text-red-600 dark:text-red-400",children:[e.jsx(le,{className:"w-5 h-5 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-medium block mb-1",children:["Errors: ",d.errors.length]}),e.jsx("div",{className:"text-sm space-y-1 max-h-40 overflow-y-auto",children:d.errors.map((l,x)=>e.jsxs("div",{className:"text-xs",children:["â€¢ ",l]},x))})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 pt-2 border-t border-gray-200 dark:border-gray-600",children:["Total processed: ",d.total_processed]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:S,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:d&&d.imported>0?"Close":"Cancel"}),e.jsxs("button",{onClick:v,disabled:!p||h,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ae,{className:"w-4 h-4"}),h?"Importing...":"Import Questions"]})]})]})}function Ke(){const{fetchQuestions:s,deleteQuestion:b,updateQuestion:p,isLoading:N}=z(),[g,_]=a.useState([]),[h,j]=a.useState(0),[d,y]=a.useState(1),[f]=a.useState(50),[v,S]=a.useState(""),[l,x]=a.useState(""),[r,D]=a.useState(""),[C,A]=a.useState(""),[n,u]=a.useState(""),[i,c]=a.useState(void 0),[J,ge]=a.useState("created_at"),[$,X]=a.useState("desc"),[w,L]=a.useState(new Set),[xe,O]=a.useState(!1),[ue,B]=a.useState(!1),[me,G]=a.useState(!1),[pe,R]=a.useState(!1),[Y,K]=a.useState(void 0),k=a.useCallback(async()=>{try{const t=(d-1)*f,{questions:m,total:V}=await s({search:v,category:l||void 0,difficulty:r||void 0,type:C||void 0,status:n||void 0,ai_generated:i,limit:f,offset:t,sortBy:J,sortOrder:$});_(m),j(V)}catch(t){console.error(t),o.error("Failed to load questions")}},[d,f,v,l,r,C,n,i,J,$,s]);a.useEffect(()=>{const t=setTimeout(()=>{k()},300);return()=>clearTimeout(t)},[k]);const Q=t=>{J===t?X($==="asc"?"desc":"asc"):(ge(t),X("asc"))},he=async t=>{if(confirm("Are you sure you want to delete this question?"))try{await b(t),o.success("Question deleted"),k()}catch(m){console.error(m),o.error("Failed to delete question")}},ye=async t=>{try{await p(t.id,{is_demo:!t.is_demo}),o.success(`Question ${t.is_demo?"removed from":"added to"} Demo`),k()}catch(m){console.error(m),o.error("Failed to update question")}},fe=async()=>{if(w.size!==0)try{const t=o.loading("Creating export bundle..."),m=await re.post("/bundle/export.php",{question_ids:Array.from(w)},{responseType:"blob"}),V=window.URL.createObjectURL(new Blob([m.data])),T=document.createElement("a");T.href=V,T.setAttribute("download",`question_bundle_${new Date().toISOString().slice(0,10)}.zip`),document.body.appendChild(T),T.click(),T.remove(),o.dismiss(t),o.success("Bundle downloaded successfully")}catch(t){console.error("Export error:",t),o.error("Failed to export bundle")}},W=async t=>{if(w.size!==0&&!(t==="delete"&&!confirm(`Delete ${w.size} questions?`)))try{await Promise.all(Array.from(w).map(m=>t==="delete"?b(m):p(m,{status:t==="activate"?"active":"inactive"}))),o.success("Bulk action completed"),L(new Set),k()}catch(m){console.error(m),o.error("Failed to perform bulk action")}},be=t=>{const m=new Set(w);m.has(t)?m.delete(t):m.add(t),L(m)},je=()=>{w.size===g.length?L(new Set):L(new Set(g.map(t=>t.id)))};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Question Bank"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>k(),className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",title:"Refresh List",children:e.jsx(Ce,{className:`w-4 h-4 ${N?"animate-spin":""}`})}),e.jsxs("button",{onClick:()=>G(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(te,{className:"w-4 h-4"})," Import JSON"]}),e.jsxs("button",{onClick:()=>R(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(Ie,{className:"w-4 h-4"})," Import Bundle"]}),e.jsxs("button",{onClick:()=>B(!0),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[e.jsx(Z,{className:"w-4 h-4"})," AI Generate"]}),e.jsxs("button",{onClick:()=>{K(void 0),O(!0)},className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:[e.jsx(ie,{className:"w-4 h-4"})," Add Question"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search questions...",value:v,onChange:t=>S(t.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg text-gray-900 bg-white border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"})]}),e.jsx("input",{type:"text",placeholder:"Filter by Category",value:l,onChange:t=>x(t.target.value),className:"w-full px-4 py-2 border rounded-lg text-gray-900 bg-white border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"}),e.jsxs("select",{value:C,onChange:t=>A(t.target.value),className:"w-full px-4 py-2 border rounded-lg text-gray-900 bg-white border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"text_mcq",children:"Multiple Choice"}),e.jsx("option",{value:"image_identify_logo",children:"Logo Identification"}),e.jsx("option",{value:"image_identify_person",children:"Person Identification"}),e.jsx("option",{value:"true_false",children:"True/False"}),e.jsx("option",{value:"short_answer",children:"Short Answer"})]}),e.jsxs("select",{value:r,onChange:t=>D(t.target.value),className:"w-full px-4 py-2 border rounded-lg text-gray-900 bg-white border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"All Difficulties"}),e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"hard",children:"Hard"})]}),e.jsxs("select",{value:n,onChange:t=>u(t.target.value),className:"w-full px-4 py-2 border rounded-lg text-gray-900 bg-white border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"draft",children:"Draft"})]}),e.jsxs("select",{value:i===void 0?"":i.toString(),onChange:t=>c(t.target.value===""?void 0:t.target.value==="true"),className:"w-full px-4 py-2 border rounded-lg text-gray-900 bg-white border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"All Sources"}),e.jsx("option",{value:"true",children:"AI Generated"}),e.jsx("option",{value:"false",children:"Manual"})]})]})}),w.size>0&&e.jsxs("div",{className:"flex gap-2 pt-2 border-t dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>W("activate"),className:"flex items-center gap-2 px-3 py-1.5 bg-green-100 text-green-700 rounded hover:bg-green-200 text-sm",children:[e.jsx(Ae,{className:"w-4 h-4"})," Activate Selected"]}),e.jsxs("button",{onClick:()=>W("deactivate"),className:"flex items-center gap-2 px-3 py-1.5 bg-yellow-100 text-yellow-700 rounded hover:bg-yellow-200 text-sm",children:[e.jsx(le,{className:"w-4 h-4"})," Deactivate Selected"]}),e.jsxs("button",{onClick:()=>W("delete"),className:"flex items-center gap-2 px-3 py-1.5 bg-red-100 text-red-700 rounded hover:bg-red-200 text-sm",children:[e.jsx(U,{className:"w-4 h-4"})," Delete Selected"]}),e.jsxs("button",{onClick:fe,className:"flex items-center gap-2 px-3 py-1.5 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 text-sm",children:[e.jsx(Qe,{className:"w-4 h-4"})," Export Bundle"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 w-4",children:e.jsx("input",{type:"checkbox",checked:w.size===g.length&&g.length>0,onChange:je,className:"rounded border-gray-300"})}),e.jsx("th",{className:"p-4 w-10"})," ",e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>Q("question_text"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Question ",e.jsx(q,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 w-10 text-center",children:"Demo"}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>Q("question_type"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Type ",e.jsx(q,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>Q("category"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Category ",e.jsx(q,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>Q("difficulty"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Difficulty ",e.jsx(q,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>Q("points"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Pts ",e.jsx(q,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>Q("status"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Status ",e.jsx(q,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:N?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"p-8 text-center",children:e.jsx(P,{className:"w-8 h-8 animate-spin mx-auto text-indigo-600"})})}):g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"p-8 text-center text-gray-500 dark:text-gray-400",children:"No questions found"})}):g.map(t=>e.jsxs("tr",{className:F("hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",t.status==="inactive"&&"opacity-60 bg-gray-50/50 dark:bg-gray-800/50 grayscale-[0.5]"),children:[e.jsx("td",{className:"p-4",children:e.jsx("input",{type:"checkbox",checked:w.has(t.id),onChange:()=>be(t.id),className:"rounded border-gray-300"})}),e.jsx("td",{className:"p-4",children:t.image_url?e.jsx("img",{src:H(t.image_url),alt:"Q",className:"w-16 h-16 object-cover rounded border border-gray-200 dark:border-gray-700 bg-white"}):t.media_id&&e.jsx("div",{className:"w-10 h-10 rounded bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-500 dark:text-gray-400",children:e.jsx(te,{className:"w-5 h-5"})})}),e.jsxs("td",{className:"p-4 max-w-md group",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"truncate font-medium text-gray-900 dark:text-gray-100",title:t.question_text,children:t.question_text}),e.jsx("button",{onClick:()=>{K(t),O(!0)},className:"p-1 text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 opacity-0 group-hover:opacity-100 transition-opacity",title:"Edit Question",children:e.jsx(qe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5 truncate",title:t.correct_answer,children:["Ans: ",t.correct_answer]})]}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("button",{onClick:()=>ye(t),className:F("p-1 rounded-full transition-colors",t.is_demo?"text-yellow-400 hover:text-yellow-500 bg-yellow-400/10":"text-gray-300 hover:text-yellow-400 dark:text-gray-600 dark:hover:text-yellow-400"),title:t.is_demo?"Remove from Demo":"Add to Demo",children:e.jsx(Fe,{className:F("w-4 h-4",t.is_demo&&"fill-current")})})}),e.jsx("td",{className:"p-4 text-sm text-gray-700 dark:text-gray-300",children:{text_mcq:"Multiple Choice",image_identify_logo:"Logo Identification",image_identify_person:"Person Identification",true_false:"True/False",short_answer:"Short Answer"}[t.question_type]||t.question_type.replace(/_/g," ")}),e.jsx("td",{className:"p-4 text-sm text-gray-700 dark:text-gray-300",children:t.category}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:F("px-2 py-1 rounded-full text-xs font-medium capitalize",t.difficulty==="easy"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":t.difficulty==="medium"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"),children:t.difficulty})}),e.jsx("td",{className:"p-4 text-sm font-medium text-gray-700 dark:text-gray-300",children:t.points}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:F("px-2 py-1 rounded-full text-xs font-medium capitalize",t.status==="active"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":t.status==="inactive"?"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"),children:t.status})}),e.jsx("td",{className:"p-4 text-right",children:e.jsx("button",{onClick:()=>he(t.id),className:"p-1 text-gray-500 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors",title:"Delete",children:e.jsx(U,{className:"w-4 h-4"})})})]},t.id))})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Showing ",(d-1)*f+1," to ",Math.min(d*f,h)," of ",h," questions"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y(t=>Math.max(1,t-1)),disabled:d===1,className:"p-2 border rounded hover:bg-gray-50 disabled:opacity-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",children:e.jsx(De,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>y(t=>t+1),disabled:d*f>=h,className:"p-2 border rounded hover:bg-gray-50 disabled:opacity-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",children:e.jsx(Oe,{className:"w-4 h-4"})})]})]})]}),e.jsx(E,{open:xe,onClose:()=>O(!1),title:Y?"Edit Question":"Create Question",className:"max-w-4xl",children:e.jsx(Re,{question:Y,onSave:async()=>{O(!1),k()},onCancel:()=>O(!1)})}),e.jsx(E,{open:ue,onClose:()=>B(!1),title:"AI Question Generator",className:"max-w-2xl",children:e.jsx(Ue,{onGenerate:async()=>{B(!1),k()},onCancel:()=>B(!1)})}),e.jsx(E,{open:me,onClose:()=>G(!1),title:"Import Questions from JSON",className:"max-w-3xl",children:e.jsx(ze,{onImportComplete:()=>{G(!1),k()},onCancel:()=>G(!1)})}),e.jsx(E,{open:pe,onClose:()=>R(!1),title:"Import Question Bundle (ZIP)",className:"max-w-3xl",children:e.jsx(Pe,{onImportComplete:()=>{R(!1),k()},onCancel:()=>R(!1)})})]})}export{Ke as Questions};
