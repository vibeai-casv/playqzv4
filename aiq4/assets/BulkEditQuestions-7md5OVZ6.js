import{s as Y,j as e,g as U,f as I,c as v,b as _}from"./index-DROaUFFW.js";import{r as o}from"./vendor-D8AvkUoV.js";import{as as H,ai as J,k as S,D as W,y as E,ar as T,am as X,I as K,a9 as V,X as Z,_ as q,i as x}from"./ui-BHrEg2Uj.js";import{M as ee}from"./Modal-Mx4fw_AR.js";import{B as se}from"./BundleImporter-DBre6OsW.js";const re=({question:r,startEdit:j})=>{const g=o.useMemo(()=>!r.options||r.options.length===0?[]:Y([...r.options]),[r.options]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:r.question_text}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsx("span",{className:"px-2 py-1 bg-primary/10 text-primary rounded",children:r.category}),e.jsx("span",{className:"capitalize",children:r.difficulty}),e.jsxs("span",{children:[r.points," points"]}),e.jsx("span",{className:r.is_active?"text-green-500":"text-yellow-500",children:r.is_active?"Active":"Inactive"})]})]}),e.jsxs("button",{onClick:()=>j(r),className:"px-3 py-1.5 border border-border rounded-lg hover:bg-muted/50 transition-colors flex items-center gap-2 text-sm",children:[e.jsx(H,{className:"w-4 h-4"}),"Edit"]})]}),r.image_url&&e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"h-48 bg-muted/20 rounded-lg border border-border flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:U(r.image_url),alt:"Question",className:"h-full w-full object-contain"})})}),g.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm font-medium text-foreground mb-2",children:"Options (Randomized):"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:g.map((u,c)=>e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm ${u===r.correct_answer?"bg-green-500/10 text-green-500 border border-green-500/30":"bg-muted/50 text-muted-foreground"}`,children:u},c))})]}),r.explanation&&e.jsx("p",{className:"text-sm text-muted-foreground italic",children:r.explanation}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-border",children:[e.jsx("p",{className:"text-sm font-medium text-foreground mb-3",children:"All Database Fields:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"ID:"}),e.jsx("span",{className:"ml-2 text-foreground",children:r.id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Type:"}),e.jsx("span",{className:"ml-2 text-foreground",children:r.question_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Category:"}),e.jsx("span",{className:"ml-2 text-foreground",children:r.category})]}),r.subcategory&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Subcategory:"}),e.jsx("span",{className:"ml-2 text-foreground",children:r.subcategory})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Difficulty:"}),e.jsx("span",{className:"ml-2 text-foreground capitalize",children:r.difficulty})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Points:"}),e.jsx("span",{className:"ml-2 text-foreground",children:r.points})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Active:"}),e.jsx("span",{className:`ml-2 ${r.is_active?"text-green-500":"text-yellow-500"}`,children:r.is_active?"Yes":"No"})]}),r.status&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Status:"}),e.jsx("span",{className:"ml-2 text-foreground",children:r.status})]})]}),e.jsxs("div",{className:"space-y-2",children:[r.image_url&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Image URL:"}),e.jsx("span",{className:"ml-2 text-foreground break-all",children:r.image_url})]}),r.media_id&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Media ID:"}),e.jsx("span",{className:"ml-2 text-foreground",children:r.media_id})]}),r.hint&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Hint:"}),e.jsx("span",{className:"ml-2 text-foreground",children:r.hint})]}),r.tags&&r.tags.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Tags:"}),e.jsx("span",{className:"ml-2 text-foreground",children:r.tags.join(", ")})]}),r.ai_generated!==void 0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"AI Generated:"}),e.jsx("span",{className:"ml-2 text-foreground",children:r.ai_generated?"Yes":"No"})]}),r.is_demo!==void 0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Demo:"}),e.jsx("span",{className:"ml-2 text-foreground",children:r.is_demo?"Yes":"No"})]}),r.created_at&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Created:"}),e.jsx("span",{className:"ml-2 text-foreground",children:new Date(r.created_at).toLocaleString()})]}),r.updated_at&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Updated:"}),e.jsx("span",{className:"ml-2 text-foreground",children:new Date(r.updated_at).toLocaleString()})]})]})]})]})]})};function de(){const[r,j]=o.useState([]),[g,u]=o.useState([]),[c,f]=o.useState(""),[D,w]=o.useState(!1),[Q,y]=o.useState(null),[a,d]=o.useState({}),[n,h]=o.useState([]),[F,b]=o.useState(!1),[k,C]=o.useState(!1);o.useEffect(()=>{L()},[]),o.useEffect(()=>{c&&N()},[c]);const L=async()=>{try{const s=await I("/questions/types.php");if(s.types&&s.types.length>0)u(s.types),f(s.types[0]);else{const t=["text_mcq","image_identify_logo","image_identify_person","true_false","short_answer"];u(t),f(t[0]),console.warn("No question types from database, using fallback types")}}catch(s){console.error("Failed to load question types",s);const t=["text_mcq","image_identify_logo","image_identify_person","true_false","short_answer"];u(t),f(t[0])}},N=async()=>{w(!0);try{const s=await I(`/questions/list.php?type=${c}&limit=1000`);j(s.data||[])}catch(s){console.error("Failed to load questions",s)}finally{w(!1)}},M=async s=>{const t=s.target.files?.[0];if(!t)return;const l=new FormData;l.append("file",t),l.append("type","question_image");const i=localStorage.getItem("auth_token")||sessionStorage.getItem("auth_token");i&&l.append("token",i);try{const p=(await _.post("/media/public_upload.php",l,{headers:{"Content-Type":"multipart/form-data"}})).data;p.success?(d(G=>({...G,image_url:p.media.url})),x.success("Image uploaded successfully")):alert("Upload failed: "+(p.error||"Unknown error"))}catch(m){console.error("Upload error:",m);const p=m.response?.data?.error||m.message||"Unknown error";alert(`Upload failed: ${p}`)}},P=s=>{y(s.id),d({question_text:s.question_text,options:s.options,correct_answer:s.correct_answer,explanation:s.explanation,category:s.category,difficulty:s.difficulty,points:s.points,image_url:s.image_url})},A=()=>{y(null),d({})},B=async s=>{try{await _.put(`/questions/public_update.php?id=${s}`,a),x.success("Question updated successfully!"),y(null),d({}),N()}catch(t){x.error(t.message||"Failed to update question")}},O=s=>{h(t=>t.includes(s)?t.filter(l=>l!==s):[...t,s])},$=()=>{n.length===r.length?h([]):h(r.map(s=>s.id))},R=async()=>{if(n.length===0){x.error("Please select questions to export");return}C(!0);try{const t=(await _.post("/bundle/export.php",{question_ids:n},{responseType:"blob"})).data,l=window.URL.createObjectURL(t),i=document.createElement("a");i.href=l,i.download=`bundle_${c}_${new Date().getTime()}.zip`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(l),document.body.removeChild(i),x.success(`Successfully exported ${n.length} questions as a bundle`)}catch(s){x.error("Failed to export bundle"),console.error(s)}finally{C(!1)}},z=s=>({text_mcq:"Multiple Choice",image_identify_logo:"Logo Identification",image_identify_person:"Personality Identification",personality:"Personality Identification",true_false:"True/False",short_answer:"Short Answer"})[s]||s;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Bulk Edit Questions"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Edit multiple questions filtered by type"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors shadow-sm",children:[e.jsx(J,{className:"w-4 h-4"}),"Import Bundle"]}),e.jsxs("button",{onClick:R,disabled:n.length===0||k,className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm",children:[k?e.jsx(S,{className:"w-4 h-4 animate-spin"}):e.jsx(W,{className:"w-4 h-4"}),"Export Bundle (",n.length,")"]})]})]}),e.jsx("div",{className:"bg-card border border-border rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:$,className:"p-1 hover:bg-muted rounded transition-colors",title:n.length===r.length?"Deselect All":"Select All",children:n.length===r.length&&r.length>0?e.jsx(E,{className:"w-5 h-5 text-primary"}):e.jsx(T,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsx(X,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("div",{className:"flex-1",children:e.jsx("select",{value:c,onChange:s=>{f(s.target.value),h([])},className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary",children:g.map(s=>e.jsx("option",{value:s,children:z(s)},s))})}),e.jsxs("div",{className:"flex items-center gap-4 text-sm font-medium",children:[e.jsxs("span",{className:"text-muted-foreground",children:[r.length," Total"]}),n.length>0&&e.jsxs("span",{className:"text-primary bg-primary/10 px-2 py-1 rounded",children:[n.length," Selected"]})]})]})}),D?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(S,{className:"w-8 h-8 animate-spin text-primary"})}):r.length===0?e.jsx("div",{className:"text-center py-12 bg-card border border-border rounded-xl",children:e.jsx("p",{className:"text-muted-foreground",children:"No questions found for this type"})}):e.jsx("div",{className:"space-y-4",children:r.map(s=>e.jsxs("div",{className:v("relative group bg-card border rounded-xl transition-all duration-200",n.includes(s.id)?"border-primary ring-1 ring-primary/20 shadow-md":"border-border hover:border-primary/40"),children:[e.jsx("button",{onClick:()=>O(s.id),className:v("absolute top-4 left-4 z-10 p-1.5 rounded-lg transition-all",n.includes(s.id)?"bg-primary text-primary-foreground shadow-sm":"bg-background/80 text-muted-foreground hover:bg-muted border border-border opacity-0 group-hover:opacity-100"),children:n.includes(s.id)?e.jsx(E,{className:"w-4 h-4"}):e.jsx(T,{className:"w-4 h-4"})}),e.jsx("div",{className:v("p-6",(n.includes(s.id),"")),children:Q===s.id?e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Question Text"}),e.jsx("textarea",{value:a.question_text||"",onChange:t=>d({...a,question_text:t.target.value}),rows:3,className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"border border-border rounded-lg p-4 bg-muted/20",children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Question Image"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-32 h-32 bg-background border border-border rounded-lg flex items-center justify-center overflow-hidden",children:a.image_url?e.jsx("img",{src:U(a.image_url),alt:"Question",className:"w-full h-full object-contain"}):e.jsxs("div",{className:"text-muted-foreground flex flex-col items-center",children:[e.jsx(K,{className:"w-8 h-8 mb-1"}),e.jsx("span",{className:"text-xs",children:"No image"})]})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 cursor-pointer w-fit transition-colors text-sm font-medium",children:[e.jsx(V,{className:"w-4 h-4"}),"Upload Image",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:M})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"JPG, PNG, GIF, WebP (Max 5MB)"})]}),a.image_url&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-foreground mb-1",children:"Current URL:"}),e.jsx("input",{type:"text",value:a.image_url,readOnly:!0,className:"w-full text-xs px-2 py-1 bg-background border border-border rounded text-muted-foreground"})]})]})]})]}),(s.question_type==="text_mcq"||s.question_type==="image_identify_logo"||s.question_type==="image_identify_person")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Options"}),a.options?.map((t,l)=>e.jsx("input",{type:"text",value:t,onChange:i=>{const m=[...a.options||[]];m[l]=i.target.value,d({...a,options:m})},className:"w-full px-4 py-2 mb-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary",placeholder:`Option ${l+1}`},l))]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Correct Answer"}),e.jsx("input",{type:"text",value:a.correct_answer||"",onChange:t=>d({...a,correct_answer:t.target.value}),className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Points"}),e.jsx("input",{type:"number",value:a.points||10,onChange:t=>d({...a,points:parseInt(t.target.value)}),className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Category"}),e.jsx("input",{type:"text",value:a.category||"",onChange:t=>d({...a,category:t.target.value}),className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Difficulty"}),e.jsxs("select",{value:a.difficulty||"medium",onChange:t=>d({...a,difficulty:t.target.value}),className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"hard",children:"Hard"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Explanation"}),e.jsx("textarea",{value:a.explanation||"",onChange:t=>d({...a,explanation:t.target.value}),rows:2,className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs("button",{onClick:A,className:"px-4 py-2 border border-border rounded-lg hover:bg-muted/50 transition-colors flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Cancel"]}),e.jsxs("button",{onClick:()=>B(s.id),className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),"Save Changes"]})]})]}):e.jsx(re,{question:s,startEdit:P})})]},s.id))}),e.jsx(ee,{open:F,onClose:()=>b(!1),title:"Import Question Bundle",className:"max-w-xl",children:e.jsx(se,{onImportComplete:()=>{b(!1),N()},onCancel:()=>b(!1)})})]})}export{de as BulkEditQuestions};
