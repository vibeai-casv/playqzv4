import{s as $,j as e,g as k,f as y}from"./index-CH9rPkG_.js";import{r as d}from"./vendor-D8AvkUoV.js";import{as as D,am as F,k as A,I as L,a9 as O,X as M,_ as R}from"./ui-CEq2p6SN.js";const z=({question:s,startEdit:h})=>{const g=d.useMemo(()=>!s.options||s.options.length===0?[]:$([...s.options]),[s.options]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:s.question_text}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsx("span",{className:"px-2 py-1 bg-primary/10 text-primary rounded",children:s.category}),e.jsx("span",{className:"capitalize",children:s.difficulty}),e.jsxs("span",{children:[s.points," points"]}),e.jsx("span",{className:s.is_active?"text-green-500":"text-yellow-500",children:s.is_active?"Active":"Inactive"})]})]}),e.jsxs("button",{onClick:()=>h(s),className:"px-3 py-1.5 border border-border rounded-lg hover:bg-muted/50 transition-colors flex items-center gap-2 text-sm",children:[e.jsx(D,{className:"w-4 h-4"}),"Edit"]})]}),s.image_url&&e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"h-48 bg-muted/20 rounded-lg border border-border flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:k(s.image_url),alt:"Question",className:"h-full w-full object-contain"})})}),g.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm font-medium text-foreground mb-2",children:"Options (Randomized):"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:g.map((i,c)=>e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm ${i===s.correct_answer?"bg-green-500/10 text-green-500 border border-green-500/30":"bg-muted/50 text-muted-foreground"}`,children:i},c))})]}),s.explanation&&e.jsx("p",{className:"text-sm text-muted-foreground italic",children:s.explanation}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-border",children:[e.jsx("p",{className:"text-sm font-medium text-foreground mb-3",children:"All Database Fields:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"ID:"}),e.jsx("span",{className:"ml-2 text-foreground",children:s.id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Type:"}),e.jsx("span",{className:"ml-2 text-foreground",children:s.question_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Category:"}),e.jsx("span",{className:"ml-2 text-foreground",children:s.category})]}),s.subcategory&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Subcategory:"}),e.jsx("span",{className:"ml-2 text-foreground",children:s.subcategory})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Difficulty:"}),e.jsx("span",{className:"ml-2 text-foreground capitalize",children:s.difficulty})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Points:"}),e.jsx("span",{className:"ml-2 text-foreground",children:s.points})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Active:"}),e.jsx("span",{className:`ml-2 ${s.is_active?"text-green-500":"text-yellow-500"}`,children:s.is_active?"Yes":"No"})]}),s.status&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Status:"}),e.jsx("span",{className:"ml-2 text-foreground",children:s.status})]})]}),e.jsxs("div",{className:"space-y-2",children:[s.image_url&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Image URL:"}),e.jsx("span",{className:"ml-2 text-foreground break-all",children:s.image_url})]}),s.media_id&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Media ID:"}),e.jsx("span",{className:"ml-2 text-foreground",children:s.media_id})]}),s.hint&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Hint:"}),e.jsx("span",{className:"ml-2 text-foreground",children:s.hint})]}),s.tags&&s.tags.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Tags:"}),e.jsx("span",{className:"ml-2 text-foreground",children:s.tags.join(", ")})]}),s.ai_generated!==void 0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"AI Generated:"}),e.jsx("span",{className:"ml-2 text-foreground",children:s.ai_generated?"Yes":"No"})]}),s.is_demo!==void 0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Demo:"}),e.jsx("span",{className:"ml-2 text-foreground",children:s.is_demo?"Yes":"No"})]}),s.created_at&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Created:"}),e.jsx("span",{className:"ml-2 text-foreground",children:new Date(s.created_at).toLocaleString()})]}),s.updated_at&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Updated:"}),e.jsx("span",{className:"ml-2 text-foreground",children:new Date(s.updated_at).toLocaleString()})]})]})]})]})]})};function Y(){const[s,h]=d.useState([]),[g,i]=d.useState([]),[c,p]=d.useState(""),[I,N]=d.useState(!1),[C,b]=d.useState(null),[a,n]=d.useState({});d.useEffect(()=>{T()},[]),d.useEffect(()=>{c&&v()},[c]);const T=async()=>{try{const t=await y("/questions/types.php");if(t.types&&t.types.length>0)i(t.types),p(t.types[0]);else{const r=["text_mcq","image_identify_logo","image_identify_person","true_false","short_answer"];i(r),p(r[0]),console.warn("No question types from database, using fallback types")}}catch(t){console.error("Failed to load question types",t);const r=["text_mcq","image_identify_logo","image_identify_person","true_false","short_answer"];i(r),p(r[0])}},v=async()=>{N(!0);try{const t=await y(`/questions/list.php?type=${c}&limit=1000`);h(t.data||[])}catch(t){console.error("Failed to load questions",t)}finally{N(!1)}},S=async t=>{const r=t.target.files?.[0];if(!r)return;const l=new FormData;l.append("file",r),l.append("type","question_image");const m=localStorage.getItem("auth_token")||sessionStorage.getItem("auth_token");m&&l.append("token",m);try{const o={};m&&(o.Authorization=`Bearer ${m}`);let u;if(typeof window<"u")if(window.location.pathname.startsWith("/aiq3/"))u="/aiq3/api";else if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")u="http://projects/playqzv4/api";else{const w=window.location.pathname.split("/").slice(0,2).join("/");u=w?`${w}/api`:"/api"}else u="/api";const _=`${u}/media/public_upload.php`;console.log("Target API URL:",_);const x=await fetch(_,{method:"POST",headers:o,body:l});if(!x.ok){const f=await x.text();throw new Error(`HTTP ${x.status} at ${x.url}: ${x.statusText}
${f.substring(0,200)}`)}const j=await x.json();j.success?n(f=>({...f,image_url:j.media.url})):alert("Upload failed: "+(j.error||"Unknown error"))}catch(o){console.error("Upload error:",o),alert(`Upload failed: ${o.message||o}`)}},E=t=>{b(t.id),n({question_text:t.question_text,options:t.options,correct_answer:t.correct_answer,explanation:t.explanation,category:t.category,difficulty:t.difficulty,points:t.points,image_url:t.image_url})},P=()=>{b(null),n({})},U=async t=>{try{await y(`/questions/public_update.php?id=${t}`,{method:"PUT",body:JSON.stringify(a)}),alert("Question updated successfully!"),b(null),n({}),v()}catch(r){alert(r.message||"Failed to update question")}},Q=t=>({text_mcq:"Multiple Choice",image_identify_logo:"Logo Identification",image_identify_person:"Personality Identification",personality:"Personality Identification",true_false:"True/False",short_answer:"Short Answer"})[t]||t;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Bulk Edit Questions"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Edit multiple questions filtered by type"})]})}),e.jsx("div",{className:"bg-card border border-border rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(F,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Question Type"}),e.jsx("select",{value:c,onChange:t=>p(t.target.value),className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary",children:g.map(t=>e.jsx("option",{value:t,children:Q(t)},t))})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.length," question",s.length!==1?"s":""," found"]})]})}),I?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(A,{className:"w-8 h-8 animate-spin text-primary"})}):s.length===0?e.jsx("div",{className:"text-center py-12 bg-card border border-border rounded-xl",children:e.jsx("p",{className:"text-muted-foreground",children:"No questions found for this type"})}):e.jsx("div",{className:"space-y-4",children:s.map(t=>e.jsx("div",{className:"bg-card border border-border rounded-xl p-6 hover:border-primary/50 transition-colors",children:C===t.id?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Question Text"}),e.jsx("textarea",{value:a.question_text||"",onChange:r=>n({...a,question_text:r.target.value}),rows:3,className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"border border-border rounded-lg p-4 bg-muted/20",children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Question Image"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-32 h-32 bg-background border border-border rounded-lg flex items-center justify-center overflow-hidden",children:a.image_url?e.jsx("img",{src:k(a.image_url),alt:"Question",className:"w-full h-full object-contain"}):e.jsxs("div",{className:"text-muted-foreground flex flex-col items-center",children:[e.jsx(L,{className:"w-8 h-8 mb-1"}),e.jsx("span",{className:"text-xs",children:"No image"})]})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 cursor-pointer w-fit transition-colors text-sm font-medium",children:[e.jsx(O,{className:"w-4 h-4"}),"Upload Image",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:S})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"JPG, PNG, GIF, WebP (Max 5MB)"})]}),a.image_url&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-foreground mb-1",children:"Current URL:"}),e.jsx("input",{type:"text",value:a.image_url,readOnly:!0,className:"w-full text-xs px-2 py-1 bg-background border border-border rounded text-muted-foreground"})]})]})]})]}),(t.question_type==="text_mcq"||t.question_type==="image_identify_logo"||t.question_type==="image_identify_person")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Options"}),a.options?.map((r,l)=>e.jsx("input",{type:"text",value:r,onChange:m=>{const o=[...a.options||[]];o[l]=m.target.value,n({...a,options:o})},className:"w-full px-4 py-2 mb-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary",placeholder:`Option ${l+1}`},l))]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Correct Answer"}),e.jsx("input",{type:"text",value:a.correct_answer||"",onChange:r=>n({...a,correct_answer:r.target.value}),className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Points"}),e.jsx("input",{type:"number",value:a.points||10,onChange:r=>n({...a,points:parseInt(r.target.value)}),className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Category"}),e.jsx("input",{type:"text",value:a.category||"",onChange:r=>n({...a,category:r.target.value}),className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Difficulty"}),e.jsxs("select",{value:a.difficulty||"medium",onChange:r=>n({...a,difficulty:r.target.value}),className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"hard",children:"Hard"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Explanation"}),e.jsx("textarea",{value:a.explanation||"",onChange:r=>n({...a,explanation:r.target.value}),rows:2,className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs("button",{onClick:P,className:"px-4 py-2 border border-border rounded-lg hover:bg-muted/50 transition-colors flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),"Cancel"]}),e.jsxs("button",{onClick:()=>U(t.id),className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),"Save Changes"]})]})]}):e.jsx(z,{question:t,startEdit:E})},t.id))})]})}export{Y as BulkEditQuestions};
