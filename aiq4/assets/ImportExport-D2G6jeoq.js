import{j as e,c as p,b as C}from"./index-BnnRjfCw.js";import{r as c}from"./vendor-D8AvkUoV.js";import{u as R}from"./useAdmin-CRVjhz5L.js";import{i as a,D as I,a9 as f,ai as q,am as T,y as _,ar as F,k as E,ag as U,X as M}from"./ui-CEq2p6SN.js";import{B as Z}from"./BundleImporter-B55FzHHZ.js";function V(){const{fetchQuestions:O,isLoading:A}=R(),[o,m]=c.useState("export-json"),[x,J]=c.useState([]),[i,u]=c.useState(new Set),[n,j]=c.useState({type:"all",difficulty:"all"}),[k,h]=c.useState(null),[g,y]=c.useState([]),[N,w]=c.useState(!1);c.useEffect(()=>{(o==="export-json"||o==="export-bundle")&&v()},[o,n]);const v=async()=>{try{const t={};n.type!=="all"&&(t.type=n.type),n.difficulty!=="all"&&(t.difficulty=n.difficulty);const{questions:r}=await O(t);J(r)}catch(t){console.error(t),a.error("Failed to load questions")}},B=t=>{const r=new Set(i);r.has(t)?r.delete(t):r.add(t),u(r)},L=()=>{i.size===x.length?u(new Set):u(new Set(x.map(t=>t.id)))},z=()=>{if(i.size===0){a.error("Please select at least one question to export");return}const t=x.filter(d=>i.has(d.id)).map(({created_at:d,updated_at:S,...b})=>b),r=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),l=URL.createObjectURL(r),s=document.createElement("a");s.href=l,s.download=`questions_export_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(l),a.success(`Exported ${i.size} questions to JSON`)},Q=async()=>{if(i.size===0){a.error("Please select at least one question to export");return}try{const t=a.loading("Creating export bundle..."),r=await C.post("/bundle/export.php",{question_ids:Array.from(i)},{responseType:"blob"}),l=window.URL.createObjectURL(new Blob([r.data])),s=document.createElement("a");s.href=l,s.setAttribute("download",`question_bundle_${new Date().toISOString().slice(0,10)}.zip`),document.body.appendChild(s),s.click(),s.remove(),a.dismiss(t),a.success("Bundle downloaded successfully")}catch(t){console.error("Export error:",t),a.error("Failed to export bundle")}},D=async t=>{const r=t.target.files?.[0];if(r){if(!r.name.endsWith(".json")){a.error("Please select a JSON file");return}h(r);try{const l=await r.text(),s=JSON.parse(l);if(!Array.isArray(s)){a.error("Invalid JSON format. Expected an array of questions");return}y(s),a.success(`Loaded ${s.length} questions from file`)}catch(l){console.error(l),a.error("Failed to parse JSON file")}}},P=async()=>{if(g.length===0){a.error("No questions to import");return}w(!0);try{const r=(await C.post("/questions/import.php",{questions:g})).data,{imported:l,skipped:s,errors:d,summary:S}=r;if(l>0?a.success(`Import complete! ${S}`,{duration:5e3}):a.error("No questions were imported"),d&&d.length>0){console.log("Import errors:",d);const b=d.slice(0,5).join(`
`),$=d.length>5?`
...and ${d.length-5} more`:"";a.warning(`${s} question(s) skipped:
${b}${$}`,{duration:8e3})}h(null),y([]),o==="export-json"&&v()}catch(t){console.error(t),a.error(t instanceof Error?t.message:"Failed to import questions")}finally{w(!1)}};return e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Import / Export Data"}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"Manage question data via JSON (text only) or Bundles (includes images)"})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-1 rounded-xl inline-flex flex-wrap gap-1",children:[e.jsxs("button",{onClick:()=>m("export-json"),className:p("px-4 py-2 rounded-lg font-medium transition-all flex items-center gap-2 text-sm",o==="export-json"?"bg-white dark:bg-gray-700 shadow text-indigo-600 dark:text-indigo-400":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[e.jsx(I,{className:"w-4 h-4"}),"Export JSON"]}),e.jsxs("button",{onClick:()=>m("import-json"),className:p("px-4 py-2 rounded-lg font-medium transition-all flex items-center gap-2 text-sm",o==="import-json"?"bg-white dark:bg-gray-700 shadow text-indigo-600 dark:text-indigo-400":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[e.jsx(f,{className:"w-4 h-4"}),"Import JSON"]}),e.jsx("div",{className:"w-px bg-gray-300 dark:bg-gray-600 mx-2 h-8 self-center hidden sm:block"}),e.jsxs("button",{onClick:()=>m("export-bundle"),className:p("px-4 py-2 rounded-lg font-medium transition-all flex items-center gap-2 text-sm",o==="export-bundle"?"bg-white dark:bg-gray-700 shadow text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[e.jsx(q,{className:"w-4 h-4"}),"Export Bundle (ZIP)"]}),e.jsxs("button",{onClick:()=>m("import-bundle"),className:p("px-4 py-2 rounded-lg font-medium transition-all flex items-center gap-2 text-sm",o==="import-bundle"?"bg-white dark:bg-gray-700 shadow text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[e.jsx(q,{className:"w-4 h-4"}),"Import Bundle (ZIP)"]})]}),(o==="export-json"||o==="export-bundle")&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(T,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Filters"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Question Type"}),e.jsxs("select",{value:n.type,onChange:t=>j({...n,type:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"text_mcq",children:"Multiple Choice"}),e.jsx("option",{value:"image_identify_logo",children:"Logo Identification"}),e.jsx("option",{value:"image_identify_person",children:"Person Identification"}),e.jsx("option",{value:"true_false",children:"True/False"}),e.jsx("option",{value:"short_answer",children:"Short Answer"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Difficulty Level"}),e.jsxs("select",{value:n.difficulty,onChange:t=>j({...n,difficulty:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Difficulties"}),e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"hard",children:"Hard"})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Select Questions (",i.size," of ",x.length,")"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Choose questions to export"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:L,className:"px-4 py-2 text-sm font-medium text-indigo-600 hover:text-indigo-700 dark:text-indigo-400 flex items-center gap-2",children:i.size===x.length?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4"}),"Deselect All"]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4"}),"Select All"]})}),e.jsxs("button",{onClick:o==="export-json"?z:Q,disabled:i.size===0,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 font-medium",children:[e.jsx(I,{className:"w-4 h-4"}),"Export ",o==="export-json"?"JSON":"Bundle"]})]})]}),e.jsx("div",{className:"p-6",children:A?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(E,{className:"w-8 h-8 animate-spin text-indigo-600"})}):x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(U,{className:"w-16 h-16 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No questions found with current filters"})]}):e.jsx("div",{className:"space-y-2 max-h-[500px] overflow-y-auto",children:x.map(t=>e.jsx("div",{onClick:()=>B(t.id),className:p("p-4 rounded-lg border cursor-pointer transition-all",i.has(t.id)?"bg-indigo-50 dark:bg-indigo-900/20 border-indigo-500":"bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1",children:i.has(t.id)?e.jsx(_,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"}):e.jsx(F,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:t.question_text}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300",children:t.question_type.replace(/_/g," ")}),e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 capitalize",children:t.difficulty}),e.jsxs("span",{className:"text-xs px-2 py-1 rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300",children:[t.points," pts"]})]})]})]})},t.id))})})]})]}),o==="import-json"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Select JSON File"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center",children:[e.jsx(f,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsx("input",{type:"file",accept:".json",onChange:D,className:"hidden",id:"import-file"}),e.jsx("label",{htmlFor:"import-file",className:"inline-block px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 cursor-pointer font-medium",children:"Choose JSON File"}),k&&e.jsxs("p",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400",children:["Selected: ",e.jsx("span",{className:"font-medium",children:k.name})]})]})]}),g.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Preview (",g.length," questions)"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Review questions before importing"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>{y([]),h(null)},className:"px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),"Cancel"]}),e.jsx("button",{onClick:P,disabled:N,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2 font-medium",children:N?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-4 h-4"}),"Import All"]})})]})]}),e.jsx("div",{className:"p-6 space-y-3 max-h-[500px] overflow-y-auto",children:g.map((t,r)=>e.jsxs("div",{className:"p-4 rounded-lg bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:t.question_text}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300",children:t.question_type?.replace(/_/g," ")}),e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 capitalize",children:t.difficulty})]})]},r))})]})]}),o==="import-bundle"&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700",children:e.jsx(Z,{onImportComplete:()=>{},onCancel:()=>{}})})]})}export{V as ImportExport};
