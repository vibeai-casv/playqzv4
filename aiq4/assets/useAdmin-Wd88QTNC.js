import{r as u}from"./vendor-D8AvkUoV.js";import{b as n}from"./index-B4PLxqBd.js";function $(){const[y,a]=u.useState(!1),[m,s]=u.useState(null),h=async r=>{a(!0),s(null);try{const e={...r},t=await n.get("/admin/users.php",{params:e});return{users:t.data.users,total:t.data.total}}catch(e){const t=e instanceof Error?e.message:"An error occurred";throw s(t),e}finally{a(!1)}},g=async r=>{a(!0),s(null);try{const e={...r};r?.startDate&&(e.startDate=r.startDate.toISOString()),r?.endDate&&(e.endDate=r.endDate.toISOString());const t=await n.get("/analytics/logs.php",{params:e});return{logs:t.data.logs,total:t.data.total}}catch(e){const t=e instanceof Error?e.message:"An error occurred";throw s(t),e}finally{a(!1)}},w=async r=>{a(!0),s(null);try{const e=await n.get("/admin/user_activity.php",{params:{userId:r}});return{logins:e.data.logins,attempts:e.data.attempts,activity:e.data.activity}}catch(e){const t=e instanceof Error?e.message:"An error occurred";throw s(t),e}finally{a(!1)}},A=async(r,e,t)=>{a(!0),s(null);try{await n.post("/admin/toggle_user.php",{userId:r,disabled:e,reason:t})}catch(o){const p=o instanceof Error?o.message:"An error occurred";throw s(p),o}finally{a(!1)}},E=async(r,e)=>{a(!0),s(null);try{await n.post("/admin/update_role.php",{user_id:r,role:e})}catch(t){const o=t instanceof Error?t.message:"An error occurred";throw s(o),t}finally{a(!1)}},S=u.useCallback(async r=>{a(!0),s(null);try{const e=await n.get("/questions/list.php",{params:{...r,_t:Date.now()}});return{questions:e.data.data,total:e.data.total}}catch(e){const t=e instanceof Error?e.message:"An error occurred";throw s(t),e}finally{a(!1)}},[]);return{isLoading:y,error:m,fetchUsers:h,fetchUserActivity:w,fetchActivityLogs:g,toggleUserStatus:A,updateUserRole:E,fetchQuestions:S,createQuestion:async r=>{a(!0),s(null);try{return(await n.post("/questions/create.php",r)).data}catch(e){const t=e instanceof Error?e.message:"An error occurred";throw s(t),e}finally{a(!1)}},updateQuestion:async(r,e)=>{a(!0),s(null);try{return(await n.post("/questions/update.php",{id:r,...e})).data.data}catch(t){const o=t instanceof Error?t.message:"An error occurred";throw s(o),t}finally{a(!1)}},deleteQuestion:async r=>{a(!0),s(null);try{await n.post("/questions/delete.php",{id:r})}catch(e){const t=e instanceof Error?e.message:"An error occurred";throw s(t),e}finally{a(!1)}},generateQuestions:async r=>{a(!0),s(null);try{return(await n.post("/admin/generate_questions.php",r)).data}catch(e){const t=e.response?.data?.error||(e instanceof Error?e.message:"An error occurred");throw s(t),new Error(t)}finally{a(!1)}},fetchMedia:async r=>{a(!0),s(null);try{const e=await n.get("/media/list.php",{params:r});return{media:e.data.media,total:e.data.total}}catch(e){const t=e instanceof Error?e.message:"An error occurred";throw s(t),e}finally{a(!1)}},uploadMedia:async(r,e,t)=>{a(!0),s(null);try{for(let i=1;i<=3;i++)try{const c=new FormData;return c.append("file",r),c.append("type",e),t&&c.append("description",t),(await n.post("/media/upload.php",c,{headers:{"Content-Type":"multipart/form-data"}})).data.media}catch(c){const d=c instanceof Error?c.message:"An error occurred";s(d);const l=c;if(l.response&&l.response.status>=400&&l.response.status<500)throw c;if(i<3){const f=1e3*Math.pow(2,i-1);console.warn(`Upload attempt ${i} failed. Retrying in ${f}ms...`),await new Promise(D=>setTimeout(D,f));continue}throw c}throw new Error("Upload failed after all retry attempts")}finally{a(!1)}},deleteMedia:async r=>{a(!0),s(null);try{await n.post("/media/delete.php",{id:r})}catch(e){const t=e instanceof Error?e.message:"An error occurred";throw s(t),e}finally{a(!1)}},fetchAnalytics:async(r,e)=>{a(!0),s(null);try{const t={};return r&&(t.startDate=r.toISOString()),e&&(t.endDate=e.toISOString()),(await n.get("/admin/analytics.php",{params:t})).data}catch(t){const o=t instanceof Error?t.message:"An error occurred";throw s(o),t}finally{a(!1)}},fetchDailyStats:async()=>[],fetchCategoryStats:async()=>[],fetchRegistrationStats:async()=>[],fetchMetadata:async()=>{a(!0),s(null);try{return(await n.get("/metadata/list.php")).data}catch(r){const e=r instanceof Error?r.message:"An error occurred";return s(e),{categories:[],types:[],difficulties:[],tags:[]}}finally{a(!1)}}}}export{$ as u};
