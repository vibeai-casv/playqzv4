import{j as e,g as D,b as N}from"./index-C1xGmZrK.js";import{r as n}from"./vendor-D8AvkUoV.js";import{f as I,R as x,o as w,z as v,ao as A,ap as L,m as E,aq as T,I as C,i as m,w as O}from"./ui-BHrEg2Uj.js";function F(){const[d,h]=n.useState(!1),[a,p]=n.useState(null),[r,y]=n.useState(null),[i,_]=n.useState(null),[c,g]=n.useState("all"),[S,u]=n.useState(!1),b=async()=>{h(!0);try{const s=await N.get("/media/list.php",{params:{limit:10}}),l={timestamp:new Date().toISOString(),checks:{authentication:{status:"ok",message:"Successfully authenticated"},media_api:{status:"ok",message:`Media API working - ${s.data.total} files found`},database_connection:{status:"ok",message:"Database connected successfully"}},summary:{total_checks:3,errors:0,overall_status:"HEALTHY"},sample_media:s.data.media.slice(0,3)};p(l),y({authenticated:!0,steps:{config:"OK",database:"OK",authentication:"OK - Authenticated"},summary:"All systems operational"}),m.success("Diagnostics completed successfully")}catch(s){console.error("Diagnostics error:",s);const t={timestamp:new Date().toISOString(),checks:{authentication:{status:"error",message:s.response?.status===401?"Authentication failed - Please log out and log back in":"API Error: "+(s.message||"Unknown error")}},summary:{total_checks:1,errors:1,overall_status:"ISSUES FOUND"}};p(t),y({authenticated:!1,steps:{authentication:s.response?.status===401?"FAILED - Session expired":"FAILED - "+s.message},summary:s.response?.status===401?"Your session has expired. Please log out and log back in.":"Unable to connect to API"}),m.error("Diagnostics failed: "+(s.response?.status===401?"Session expired":s.message))}finally{h(!1)}},o=async(s="all")=>{u(!0);try{const t=await N.get("/questions/list_image_questions.php",{params:{type:s,limit:20}});_(t.data)}catch(t){console.error("Error loading image questions:",t),m.error("Failed to load image questions")}finally{u(!1)}};n.useEffect(()=>{b(),o()},[]);const j=s=>{switch(s?.toLowerCase()){case"ok":return e.jsx(w,{className:"w-5 h-5 text-green-500"});case"error":return e.jsx(v,{className:"w-5 h-5 text-red-500"});default:return e.jsx(O,{className:"w-5 h-5 text-yellow-500"})}},f=s=>{switch(s?.toLowerCase()){case"ok":return"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800";case"error":return"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800";default:return"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800"}};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(I,{className:"w-8 h-8 text-indigo-600"}),"System Diagnostics"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Check system health and troubleshoot issues"})]}),e.jsxs("button",{onClick:b,disabled:d,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50",children:[e.jsx(x,{className:`w-4 h-4 ${d?"animate-spin":""}`}),d?"Running...":"Run Diagnostics"]})]}),a&&e.jsx("div",{className:`p-6 rounded-lg border-2 ${a.summary.overall_status==="HEALTHY"?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[a.summary.overall_status==="HEALTHY"?e.jsx(w,{className:"w-8 h-8 text-green-600"}):e.jsx(v,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["System Status: ",a.summary.overall_status]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[a.summary.total_checks," checks completed • ",a.summary.errors," errors found"]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:["Last checked: ",new Date(a.timestamp).toLocaleString()]})]})]})}),a&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2 mb-4",children:[e.jsx(A,{className:"w-5 h-5 text-indigo-600"}),"Database Health"]}),e.jsx("div",{className:"space-y-3",children:Object.entries(a.checks).map(([s,t])=>e.jsx("div",{className:`p-4 rounded-lg border ${f(t.status)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[j(t.status),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white capitalize",children:s.replace(/_/g," ")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:typeof t=="string"?t:t.message||JSON.stringify(t)}),t.details&&e.jsx("pre",{className:"mt-2 text-xs bg-gray-100 dark:bg-gray-900 p-2 rounded overflow-x-auto",children:JSON.stringify(t.details,null,2)})]})]})},s))})]}),a?.all_tables&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2 mb-4",children:[e.jsx(L,{className:"w-5 h-5 text-indigo-600"}),"Database Tables (",a.all_tables.count,")"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:a.all_tables.tables.map(s=>e.jsx("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-700 rounded text-sm font-mono text-gray-700 dark:text-gray-300",children:s},s))})]}),r&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2 mb-4",children:[e.jsx(E,{className:"w-5 h-5 text-indigo-600"}),"Authentication & API Test"]}),e.jsx("div",{className:"space-y-3",children:Object.entries(r.steps||{}).map(([s,t])=>{const k=typeof t=="string"&&(t.includes("OK")||t==="Present")?"ok":"error";return e.jsx("div",{className:`p-4 rounded-lg border ${f(k)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[j(k),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white capitalize",children:s.replace(/_/g," ")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:t})]})]})},s)})}),r.authenticated&&r.session_info&&e.jsxs("div",{className:"mt-4 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Session Information"}),e.jsxs("div",{className:"text-sm space-y-1 text-gray-600 dark:text-gray-400",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",r.session_info.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Role:"})," ",r.session_info.role]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Expires:"})," ",new Date(r.session_info.expires_at).toLocaleString()]})]})]}),!r.authenticated&&e.jsxs("div",{className:"mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Authentication Issue"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.summary||"Your session may have expired. Try logging out and logging back in."})]})]}),a?.sample_media&&a.sample_media.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2 mb-4",children:[e.jsx(T,{className:"w-5 h-5 text-indigo-600"}),"Sample Media Files (",a.sample_media.length," of ",a.checks.media_count?.total_rows||0,")"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Filename"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Size"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Created"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:a.sample_media.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-300 font-mono",children:s.original_filename}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"px-2 py-1 bg-indigo-100 dark:bg-indigo-900 text-indigo-800 dark:text-indigo-200 rounded",children:s.type})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400",children:[Math.round(s.size_bytes/1024)," KB"]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400",children:new Date(s.created_at).toLocaleDateString()})]},s.id))})]})})]}),i&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-indigo-600"}),"Personality & Logo Questions"]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[i.stats.total_count," total questions • ",i.stats.with_image_count," with images"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{g("all"),o("all")},className:`px-3 py-1 rounded text-sm font-medium transition-colors ${c==="all"?"bg-indigo-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:["All (",i.stats.total_count,")"]}),e.jsxs("button",{onClick:()=>{g("personality"),o("personality")},className:`px-3 py-1 rounded text-sm font-medium transition-colors ${c==="personality"?"bg-indigo-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:["Personality (",i.stats.personality_count,")"]}),e.jsxs("button",{onClick:()=>{g("logo"),o("logo")},className:`px-3 py-1 rounded text-sm font-medium transition-colors ${c==="logo"?"bg-indigo-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:["Logo (",i.stats.logo_count,")"]})]})]}),S?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(x,{className:"w-8 h-8 animate-spin text-indigo-600"})}):i.questions.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No questions found"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.questions.map(s=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden hover:shadow-lg transition-shadow",children:[s.image_url?e.jsx("div",{className:"relative h-48 bg-gray-100 dark:bg-gray-700 flex items-center justify-center",children:e.jsx("img",{src:D(s.image_url),alt:s.question_text,className:"max-h-full max-w-full object-contain",onError:t=>{t.currentTarget.src="",t.currentTarget.style.display="none";const l=t.currentTarget.parentElement;l&&(l.innerHTML='<div class="text-red-500 text-sm">Image not found</div>')}})}):e.jsx("div",{className:"h-48 bg-gray-100 dark:bg-gray-700 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-sm",children:"No image"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${s.question_type==="image_identify_person"?"bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200":"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200"}`,children:s.question_type==="image_identify_person"?"Personality":"Logo"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${s.status==="active"?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300"}`,children:s.status})]}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2 line-clamp-2",children:s.question_text}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Difficulty: ",s.difficulty]}),e.jsxs("span",{children:["ID: ",s.id]})]}),s.options&&s.options.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Options:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.options.slice(0,3).map((t,l)=>e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded text-xs",children:t},l)),s.options.length>3&&e.jsxs("span",{className:"text-xs text-gray-400",children:["+",s.options.length-3," more"]})]}),e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:["Answer: ",s.correct_answer]})]})]})]},s.id))})]}),d&&!a&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(x,{className:"w-8 h-8 animate-spin text-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Running diagnostics..."})]})})]})}export{F as Diagnostics};
