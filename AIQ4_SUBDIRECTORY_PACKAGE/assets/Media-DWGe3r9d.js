import{j as e,c as h,g as j}from"./index-sRbfFhYB.js";import{r as t}from"./vendor-D8AvkUoV.js";import{u as ae}from"./useAdmin-Dn92b8X9.js";import{I as D,R as te,a9 as re,a5 as T,k as L,al as le,aa as ie,n as ne,i as l}from"./ui-CEq2p6SN.js";import{M as oe}from"./Modal-BNYL9CV1.js";function ue(){const{fetchMedia:R,uploadMedia:_,deleteMedia:U,fetchQuestions:O,updateQuestion:B,isLoading:E}=ae(),[G,$]=t.useState([]),[y,f]=t.useState(!1),[v,g]=t.useState({}),[x,N]=t.useState(!1),[w,z]=t.useState(""),[i,V]=t.useState("all"),[k,J]=t.useState("date"),[W,m]=t.useState(!1),[n,q]=t.useState(null),[S,C]=t.useState(""),[M,A]=t.useState([]),[u,I]=t.useState(null),[H,P]=t.useState(!1),d=async(s=!1)=>{s&&N(!0);try{const{media:a}=await R({type:i==="all"?void 0:i});$(a)}catch(a){console.error(a),l.error("Failed to load media")}finally{s&&N(!1)}};t.useEffect(()=>{d()},[]),t.useEffect(()=>{d()},[i]);const Z=()=>{d(!0),l.success("Media refreshed")},Q=async s=>{if(!s||s.length===0)return;f(!0);const c=Array.from(s).filter(r=>{const p=["image/jpeg","image/png","image/webp"].includes(r.type),b=r.size<=5*1024*1024;return p||l.error(`${r.name}: Invalid file type. Use JPG, PNG, or WebP.`),b||l.error(`${r.name}: File too large. Max 5MB.`),p&&b});if(c.length===0){f(!1);return}try{await Promise.all(c.map(async r=>{g(o=>({...o,[r.name]:0}));const p=setInterval(()=>{g(o=>({...o,[r.name]:Math.min((o[r.name]||0)+10,90)}))},200);await _(r,i==="all"?"logo":i),clearInterval(p),g(o=>({...o,[r.name]:100}))})),l.success(`${c.length} file(s) uploaded successfully`),d()}catch(r){console.error(r),l.error("Failed to upload some files")}finally{f(!1),g({})}},K=s=>{s.preventDefault(),Q(s.dataTransfer.files)},X=async(s,a)=>{if(s.stopPropagation(),!!confirm("Are you sure you want to delete this image?"))try{await U(a),l.success("Image deleted successfully"),d()}catch(c){console.error(c),l.error("Failed to delete image")}},Y=s=>{q(s),m(!0),C(""),A([]),I(null)},ee=async s=>{if(C(s),!(s.length<2)){P(!0);try{const{questions:a}=await O({search:s,limit:10});A(a)}catch(a){console.error(a)}finally{P(!1)}}},se=async()=>{if(!(!n||!u))try{await B(u.id,{image_url:n.url}),l.success("Image assigned to question successfully"),m(!1)}catch(s){console.error(s),l.error("Failed to assign image")}},F=G.filter(s=>s.filename.toLowerCase().includes(w.toLowerCase())).sort((s,a)=>k==="date"?new Date(a.created_at).getTime()-new Date(s.created_at).getTime():s.filename.localeCompare(a.filename));return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(D,{className:"w-8 h-8"})," Media Library"]}),e.jsxs("button",{onClick:Z,disabled:x,className:h("flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",x&&"opacity-50 cursor-not-allowed"),children:[e.jsx(te,{className:h("w-4 h-4",x&&"animate-spin")}),x?"Refreshing...":"Refresh"]})]}),e.jsxs("div",{className:h("border-2 border-dashed rounded-xl p-8 text-center transition-colors",y?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20":"border-gray-300 dark:border-gray-700 hover:border-indigo-400"),onDragOver:s=>s.preventDefault(),onDrop:K,children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"p-4 bg-indigo-100 dark:bg-indigo-900/50 rounded-full",children:e.jsx(re,{className:"w-8 h-8 text-indigo-600 dark:text-indigo-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Drag & drop files here, or click to select"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"JPG, PNG, WebP up to 5MB"})]}),e.jsx("input",{type:"file",id:"media-upload",className:"hidden",multiple:!0,accept:"image/jpeg,image/png,image/webp",onChange:s=>Q(s.target.files),disabled:y}),e.jsx("label",{htmlFor:"media-upload",className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 cursor-pointer transition-colors",children:"Select Files"})]}),Object.entries(v).length>0&&e.jsx("div",{className:"mt-6 space-y-2 max-w-md mx-auto",children:Object.entries(v).map(([s,a])=>e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"truncate max-w-[200px]",children:s}),e.jsxs("span",{children:[a,"%"]})]}),e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-600 transition-all duration-300",style:{width:`${a}%`}})})]},s))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex-1 min-w-[200px] relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search media...",value:w,onChange:s=>z(s.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:i,onChange:s=>V(s.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"logo",children:"Logos"}),e.jsx("option",{value:"personality",children:"Personalities"})]}),e.jsxs("select",{value:k,onChange:s=>J(s.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"date",children:"Newest First"}),e.jsx("option",{value:"name",children:"Name A-Z"})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:E&&!y?e.jsx("div",{className:"col-span-full flex justify-center py-12",children:e.jsx(L,{className:"w-8 h-8 animate-spin text-indigo-600"})}):F.length===0?e.jsx("div",{className:"col-span-full text-center py-12 text-gray-500",children:"No media found"}):F.map(s=>e.jsxs("div",{className:"group relative aspect-square bg-gray-100 dark:bg-gray-900 rounded-lg overflow-hidden border hover:border-indigo-500 transition-colors",children:[e.jsx("img",{src:j(s.url),alt:s.filename,loading:"lazy",className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-2 p-2",children:[e.jsxs("button",{onClick:()=>Y(s),className:"w-full py-1.5 bg-indigo-600 text-white rounded text-sm hover:bg-indigo-700 flex items-center justify-center gap-1",children:[e.jsx(le,{className:"w-3 h-3"})," Assign"]}),e.jsxs("button",{onClick:()=>window.open(j(s.url),"_blank"),className:"w-full py-1.5 bg-gray-600 text-white rounded text-sm hover:bg-gray-700 flex items-center justify-center gap-1",children:[e.jsx(D,{className:"w-3 h-3"})," View"]}),e.jsxs("button",{onClick:a=>X(a,s.id),className:"w-full py-1.5 bg-red-600 text-white rounded text-sm hover:bg-red-700 flex items-center justify-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3"})," Delete"]})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-2",children:[e.jsx("p",{className:"text-xs text-white truncate",children:s.filename.split("/").pop()}),e.jsx("p",{className:"text-[10px] text-gray-300 uppercase",children:s.type})]})]},s.id))})]}),e.jsx(oe,{open:W,onClose:()=>m(!1),title:"Assign Image to Question",className:"max-w-2xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-200 rounded-lg overflow-hidden shrink-0",children:n&&e.jsx("img",{src:j(n.url),alt:"Selected",className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Selected Image"}),e.jsx("p",{className:"text-sm text-gray-500 break-all",children:n?.filename}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 uppercase",children:n?.type})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Search Question"}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by question text...",value:S,onChange:s=>ee(s.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"})]})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto border rounded-lg dark:border-gray-700 divide-y dark:divide-gray-700",children:H?e.jsx("div",{className:"p-8 text-center",children:e.jsx(L,{className:"w-6 h-6 animate-spin mx-auto text-indigo-600"})}):M.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:S?"No questions found":"Start typing to search questions"}):M.map(s=>e.jsxs("div",{onClick:()=>I(s),className:h("p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",u?.id===s.id&&"bg-indigo-50 dark:bg-indigo-900/20 border-l-4 border-indigo-600"),children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white line-clamp-2",children:s.question_text}),e.jsx("div",{className:"mt-2 p-2 bg-green-50 dark:bg-green-900/20 rounded border-l-2 border-green-500",children:e.jsxs("p",{className:"text-sm font-semibold text-green-700 dark:text-green-400",children:["✓ Correct Answer: ",s.correct_answer]})}),e.jsxs("div",{className:"flex gap-2 mt-2 text-xs text-gray-500",children:[e.jsx("span",{className:"uppercase",children:s.question_type}),e.jsx("span",{children:"•"}),e.jsx("span",{children:s.category}),s.image_url&&e.jsx("span",{className:"text-amber-600 flex items-center gap-1",children:"• Has Image"})]})]},s.id))}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300",children:"Cancel"}),e.jsxs("button",{onClick:se,disabled:!u,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),"Confirm Assignment"]})]})]})})]})}export{ue as Media};
