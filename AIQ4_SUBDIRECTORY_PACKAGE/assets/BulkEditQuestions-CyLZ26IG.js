import{s as W,j as e,g as L,f as k,c as I,b as X}from"./index-sRbfFhYB.js";import{r as d}from"./vendor-D8AvkUoV.js";import{as as K,ai as V,k as P,D as Z,y as $,ar as D,am as q,I as ee,a9 as se,X as te,_ as re,i as g}from"./ui-CEq2p6SN.js";import{M as ae}from"./Modal-BNYL9CV1.js";import{B as oe}from"./BundleImporter-eb3dE_eV.js";const ne=({question:t,startEdit:N})=>{const f=d.useMemo(()=>!t.options||t.options.length===0?[]:W([...t.options]),[t.options]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:t.question_text}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsx("span",{className:"px-2 py-1 bg-primary/10 text-primary rounded",children:t.category}),e.jsx("span",{className:"capitalize",children:t.difficulty}),e.jsxs("span",{children:[t.points," points"]}),e.jsx("span",{className:t.is_active?"text-green-500":"text-yellow-500",children:t.is_active?"Active":"Inactive"})]})]}),e.jsxs("button",{onClick:()=>N(t),className:"px-3 py-1.5 border border-border rounded-lg hover:bg-muted/50 transition-colors flex items-center gap-2 text-sm",children:[e.jsx(K,{className:"w-4 h-4"}),"Edit"]})]}),t.image_url&&e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"h-48 bg-muted/20 rounded-lg border border-border flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:L(t.image_url),alt:"Question",className:"h-full w-full object-contain"})})}),f.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm font-medium text-foreground mb-2",children:"Options (Randomized):"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:f.map((u,m)=>e.jsx("div",{className:`px-3 py-2 rounded-lg text-sm ${u===t.correct_answer?"bg-green-500/10 text-green-500 border border-green-500/30":"bg-muted/50 text-muted-foreground"}`,children:u},m))})]}),t.explanation&&e.jsx("p",{className:"text-sm text-muted-foreground italic",children:t.explanation}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-border",children:[e.jsx("p",{className:"text-sm font-medium text-foreground mb-3",children:"All Database Fields:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"ID:"}),e.jsx("span",{className:"ml-2 text-foreground",children:t.id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Type:"}),e.jsx("span",{className:"ml-2 text-foreground",children:t.question_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Category:"}),e.jsx("span",{className:"ml-2 text-foreground",children:t.category})]}),t.subcategory&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Subcategory:"}),e.jsx("span",{className:"ml-2 text-foreground",children:t.subcategory})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Difficulty:"}),e.jsx("span",{className:"ml-2 text-foreground capitalize",children:t.difficulty})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Points:"}),e.jsx("span",{className:"ml-2 text-foreground",children:t.points})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Active:"}),e.jsx("span",{className:`ml-2 ${t.is_active?"text-green-500":"text-yellow-500"}`,children:t.is_active?"Yes":"No"})]}),t.status&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Status:"}),e.jsx("span",{className:"ml-2 text-foreground",children:t.status})]})]}),e.jsxs("div",{className:"space-y-2",children:[t.image_url&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Image URL:"}),e.jsx("span",{className:"ml-2 text-foreground break-all",children:t.image_url})]}),t.media_id&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Media ID:"}),e.jsx("span",{className:"ml-2 text-foreground",children:t.media_id})]}),t.hint&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Hint:"}),e.jsx("span",{className:"ml-2 text-foreground",children:t.hint})]}),t.tags&&t.tags.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Tags:"}),e.jsx("span",{className:"ml-2 text-foreground",children:t.tags.join(", ")})]}),t.ai_generated!==void 0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"AI Generated:"}),e.jsx("span",{className:"ml-2 text-foreground",children:t.ai_generated?"Yes":"No"})]}),t.is_demo!==void 0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Demo:"}),e.jsx("span",{className:"ml-2 text-foreground",children:t.is_demo?"Yes":"No"})]}),t.created_at&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Created:"}),e.jsx("span",{className:"ml-2 text-foreground",children:new Date(t.created_at).toLocaleString()})]}),t.updated_at&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Updated:"}),e.jsx("span",{className:"ml-2 text-foreground",children:new Date(t.updated_at).toLocaleString()})]})]})]})]})]})};function ue(){const[t,N]=d.useState([]),[f,u]=d.useState([]),[m,h]=d.useState(""),[A,S]=d.useState(!1),[O,v]=d.useState(null),[a,i]=d.useState({}),[n,b]=d.useState([]),[Q,j]=d.useState(!1),[C,E]=d.useState(!1);d.useEffect(()=>{B()},[]),d.useEffect(()=>{m&&w()},[m]);const B=async()=>{try{const s=await k("/questions/types.php");if(s.types&&s.types.length>0)u(s.types),h(s.types[0]);else{const r=["text_mcq","image_identify_logo","image_identify_person","true_false","short_answer"];u(r),h(r[0]),console.warn("No question types from database, using fallback types")}}catch(s){console.error("Failed to load question types",s);const r=["text_mcq","image_identify_logo","image_identify_person","true_false","short_answer"];u(r),h(r[0])}},w=async()=>{S(!0);try{const s=await k(`/questions/list.php?type=${m}&limit=1000`);N(s.data||[])}catch(s){console.error("Failed to load questions",s)}finally{S(!1)}},F=async s=>{const r=s.target.files?.[0];if(!r)return;const l=new FormData;l.append("file",r),l.append("type","question_image");const c=localStorage.getItem("auth_token")||sessionStorage.getItem("auth_token");c&&l.append("token",c);try{const o={};c&&(o.Authorization=`Bearer ${c}`);let p;if(typeof window<"u")if(window.location.pathname.startsWith("/aiq3/"))p="/aiq3/api";else if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")p="http://projects/playqzv4/api";else{const U=window.location.pathname.split("/").slice(0,2).join("/");p=U?`${U}/api`:"/api"}else p="/api";const T=`${p}/media/public_upload.php`;console.log("Target API URL:",T);const x=await fetch(T,{method:"POST",headers:o,body:l});if(!x.ok){const y=await x.text();throw new Error(`HTTP ${x.status} at ${x.url}: ${x.statusText}
${y.substring(0,200)}`)}const _=await x.json();_.success?i(y=>({...y,image_url:_.media.url})):alert("Upload failed: "+(_.error||"Unknown error"))}catch(o){console.error("Upload error:",o),alert(`Upload failed: ${o.message||o}`)}},R=s=>{v(s.id),i({question_text:s.question_text,options:s.options,correct_answer:s.correct_answer,explanation:s.explanation,category:s.category,difficulty:s.difficulty,points:s.points,image_url:s.image_url})},M=()=>{v(null),i({})},z=async s=>{try{await k(`/questions/public_update.php?id=${s}`,{method:"PUT",body:JSON.stringify(a)}),g.success("Question updated successfully!"),v(null),i({}),w()}catch(r){g.error(r.message||"Failed to update question")}},G=s=>{b(r=>r.includes(s)?r.filter(l=>l!==s):[...r,s])},H=()=>{n.length===t.length?b([]):b(t.map(s=>s.id))},J=async()=>{if(n.length===0){g.error("Please select questions to export");return}E(!0);try{const s=localStorage.getItem("auth_token")||sessionStorage.getItem("auth_token"),r=await fetch(`${X.defaults.baseURL}/bundle/export.php`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({question_ids:n})});if(!r.ok)throw new Error("Export failed");const l=await r.blob(),c=window.URL.createObjectURL(l),o=document.createElement("a");o.href=c,o.download=`bundle_${m}_${new Date().getTime()}.zip`,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(c),document.body.removeChild(o),g.success(`Successfully exported ${n.length} questions as a bundle`)}catch(s){g.error("Failed to export bundle"),console.error(s)}finally{E(!1)}},Y=s=>({text_mcq:"Multiple Choice",image_identify_logo:"Logo Identification",image_identify_person:"Personality Identification",personality:"Personality Identification",true_false:"True/False",short_answer:"Short Answer"})[s]||s;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Bulk Edit Questions"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Edit multiple questions filtered by type"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>j(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors shadow-sm",children:[e.jsx(V,{className:"w-4 h-4"}),"Import Bundle"]}),e.jsxs("button",{onClick:J,disabled:n.length===0||C,className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm",children:[C?e.jsx(P,{className:"w-4 h-4 animate-spin"}):e.jsx(Z,{className:"w-4 h-4"}),"Export Bundle (",n.length,")"]})]})]}),e.jsx("div",{className:"bg-card border border-border rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:H,className:"p-1 hover:bg-muted rounded transition-colors",title:n.length===t.length?"Deselect All":"Select All",children:n.length===t.length&&t.length>0?e.jsx($,{className:"w-5 h-5 text-primary"}):e.jsx(D,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsx(q,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("div",{className:"flex-1",children:e.jsx("select",{value:m,onChange:s=>{h(s.target.value),b([])},className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary",children:f.map(s=>e.jsx("option",{value:s,children:Y(s)},s))})}),e.jsxs("div",{className:"flex items-center gap-4 text-sm font-medium",children:[e.jsxs("span",{className:"text-muted-foreground",children:[t.length," Total"]}),n.length>0&&e.jsxs("span",{className:"text-primary bg-primary/10 px-2 py-1 rounded",children:[n.length," Selected"]})]})]})}),A?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(P,{className:"w-8 h-8 animate-spin text-primary"})}):t.length===0?e.jsx("div",{className:"text-center py-12 bg-card border border-border rounded-xl",children:e.jsx("p",{className:"text-muted-foreground",children:"No questions found for this type"})}):e.jsx("div",{className:"space-y-4",children:t.map(s=>e.jsxs("div",{className:I("relative group bg-card border rounded-xl transition-all duration-200",n.includes(s.id)?"border-primary ring-1 ring-primary/20 shadow-md":"border-border hover:border-primary/40"),children:[e.jsx("button",{onClick:()=>G(s.id),className:I("absolute top-4 left-4 z-10 p-1.5 rounded-lg transition-all",n.includes(s.id)?"bg-primary text-primary-foreground shadow-sm":"bg-background/80 text-muted-foreground hover:bg-muted border border-border opacity-0 group-hover:opacity-100"),children:n.includes(s.id)?e.jsx($,{className:"w-4 h-4"}):e.jsx(D,{className:"w-4 h-4"})}),e.jsx("div",{className:I("p-6",(n.includes(s.id),"")),children:O===s.id?e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Question Text"}),e.jsx("textarea",{value:a.question_text||"",onChange:r=>i({...a,question_text:r.target.value}),rows:3,className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"border border-border rounded-lg p-4 bg-muted/20",children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Question Image"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-32 h-32 bg-background border border-border rounded-lg flex items-center justify-center overflow-hidden",children:a.image_url?e.jsx("img",{src:L(a.image_url),alt:"Question",className:"w-full h-full object-contain"}):e.jsxs("div",{className:"text-muted-foreground flex flex-col items-center",children:[e.jsx(ee,{className:"w-8 h-8 mb-1"}),e.jsx("span",{className:"text-xs",children:"No image"})]})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 cursor-pointer w-fit transition-colors text-sm font-medium",children:[e.jsx(se,{className:"w-4 h-4"}),"Upload Image",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:F})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"JPG, PNG, GIF, WebP (Max 5MB)"})]}),a.image_url&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-foreground mb-1",children:"Current URL:"}),e.jsx("input",{type:"text",value:a.image_url,readOnly:!0,className:"w-full text-xs px-2 py-1 bg-background border border-border rounded text-muted-foreground"})]})]})]})]}),(s.question_type==="text_mcq"||s.question_type==="image_identify_logo"||s.question_type==="image_identify_person")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Options"}),a.options?.map((r,l)=>e.jsx("input",{type:"text",value:r,onChange:c=>{const o=[...a.options||[]];o[l]=c.target.value,i({...a,options:o})},className:"w-full px-4 py-2 mb-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary",placeholder:`Option ${l+1}`},l))]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Correct Answer"}),e.jsx("input",{type:"text",value:a.correct_answer||"",onChange:r=>i({...a,correct_answer:r.target.value}),className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Points"}),e.jsx("input",{type:"number",value:a.points||10,onChange:r=>i({...a,points:parseInt(r.target.value)}),className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Category"}),e.jsx("input",{type:"text",value:a.category||"",onChange:r=>i({...a,category:r.target.value}),className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Difficulty"}),e.jsxs("select",{value:a.difficulty||"medium",onChange:r=>i({...a,difficulty:r.target.value}),className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"hard",children:"Hard"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Explanation"}),e.jsx("textarea",{value:a.explanation||"",onChange:r=>i({...a,explanation:r.target.value}),rows:2,className:"w-full px-4 py-2 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs("button",{onClick:M,className:"px-4 py-2 border border-border rounded-lg hover:bg-muted/50 transition-colors flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Cancel"]}),e.jsxs("button",{onClick:()=>z(s.id),className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Save Changes"]})]})]}):e.jsx(ne,{question:s,startEdit:R})})]},s.id))}),e.jsx(ae,{open:Q,onClose:()=>j(!1),title:"Import Question Bundle",className:"max-w-xl",children:e.jsx(oe,{onImportComplete:()=>{j(!1),w()},onCancel:()=>j(!1)})})]})}export{ue as BulkEditQuestions};
