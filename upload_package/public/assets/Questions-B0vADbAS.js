import{j as e,c as R,a as me,d as pe}from"./index-C4Moadyo.js";import{r as i}from"./vendor-D8AvkUoV.js";import{u as L}from"./useAdmin-Dg3_wSlk.js";import{M}from"./Modal-CP3BPesw.js";import{a3 as Y,i as F,a7 as K,a8 as P,k as d,I as he,X as ye,a9 as Z,Q as fe,aa as G,ab as be,v as W,n as je,x as ee,R as Ne,ac as X,w as ve,a6 as _,ad as ke,G as we,s as Se}from"./ui-C9JoC26D.js";import{o as se,s as C,c as _e,_ as q,n as ae,l as Ce,u as re,a as te,d as Ie}from"./schemas-BznUp_a-.js";const Ae=se({question_text:C().min(3,"Question text must be at least 3 characters"),question_type:q(["text_mcq","image_identify_logo","image_identify_person","true_false","short_answer"]),category:C().min(1,"Category is required"),difficulty:q(["easy","medium","hard"]),points:ae().min(1,"Points must be at least 1"),status:q(["active","inactive","draft"]),options:_e(C()).default([]),correct_answer:C().min(1,"Correct answer is required"),explanation:C().optional(),image_url:C().url().optional().or(Ce(""))}),Qe=se({topic:C().min(3,"Topic is required"),count:ae().min(1).max(50),difficulty:q(["easy","medium","hard"]),type:q(["text_mcq","image_identify_logo","image_identify_person","true_false","short_answer"])});function qe({onSelect:o,onCancel:b}){const{fetchMedia:g,uploadMedia:f,deleteMedia:n,isLoading:j}=L(),[p,x]=i.useState([]),[a,h]=i.useState(!1),[u,v]=i.useState(""),[y,r]=i.useState("all"),l=async()=>{try{const{media:c}=await g({type:y==="all"?void 0:y});x(c)}catch(c){console.error(c),d.error("Failed to load media")}};i.useEffect(()=>{l()},[y]);const t=async c=>{const N=c.target.files?.[0];if(N){h(!0);try{await f(N,y==="all"?"logo":y),d.success("File uploaded successfully"),l()}catch(A){console.error(A),d.error("Failed to upload file")}finally{h(!1)}}},z=async(c,N)=>{if(c.stopPropagation(),!!confirm("Are you sure you want to delete this image?"))try{await n(N),d.success("Image deleted successfully"),l()}catch(A){console.error(A),d.error("Failed to delete image")}},I=p.filter(c=>c.filename.toLowerCase().includes(u.toLowerCase()));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search media...",value:u,onChange:c=>v(c.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"})]}),e.jsxs("select",{value:y,onChange:c=>r(c.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"logo",children:"Logos"}),e.jsx("option",{value:"personality",children:"Personalities"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",id:"modal-file-upload",className:"hidden",accept:"image/*",onChange:t,disabled:a}),e.jsxs("label",{htmlFor:"modal-file-upload",className:R("flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 cursor-pointer",a&&"opacity-50 cursor-not-allowed"),children:[a?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(K,{className:"w-4 h-4"}),"Upload"]})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 max-h-[400px] overflow-y-auto p-1",children:j?e.jsx("div",{className:"col-span-full flex justify-center py-8",children:e.jsx(F,{className:"w-8 h-8 animate-spin text-indigo-600"})}):I.length===0?e.jsx("div",{className:"col-span-full text-center py-8 text-gray-500",children:"No media found"}):I.map(c=>e.jsxs("div",{className:"group relative aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden border hover:border-indigo-500 cursor-pointer",onClick:()=>o(c.url),children:[e.jsx("img",{src:c.url,alt:c.filename,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-white font-medium bg-indigo-600 px-3 py-1 rounded-full text-sm",children:"Select"}),e.jsx("button",{onClick:N=>z(N,c.id),className:"p-2 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors",title:"Delete image",children:e.jsx(P,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 p-2 text-xs text-white truncate",children:c.filename})]},c.id))}),e.jsx("div",{className:"flex justify-end pt-4 border-t dark:border-gray-700",children:e.jsx("button",{onClick:b,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300",children:"Cancel"})})]})}function Fe({question:o,onSave:b,onCancel:g}){const{createQuestion:f,updateQuestion:n,isLoading:j}=L(),[p,x]=i.useState(!1),a=re({resolver:te(Ae),defaultValues:{question_text:"",question_type:"text_mcq",category:"General",difficulty:"medium",points:10,status:"draft",options:["","","",""],correct_answer:"",explanation:"",image_url:""}}),{fields:h,append:u,remove:v}=Ie({control:a.control,name:"options"});i.useEffect(()=>{o&&a.reset({question_text:o.question_text,question_type:o.question_type,category:o.category,difficulty:o.difficulty,points:o.points,status:o.status,options:o.options||[],correct_answer:o.correct_answer,explanation:o.explanation||"",image_url:o.image_url||""})},[o,a]);const y=async l=>{try{o?(await n(o.id,l),d.success("Question updated successfully")):(await f(l),d.success("Question created successfully")),b()}catch(t){console.error(t),d.error("Failed to save question")}},r=a.watch("question_type");return e.jsxs("form",{onSubmit:a.handleSubmit(y),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Question Type"}),e.jsxs("select",{...a.register("question_type"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"text_mcq",children:"Multiple Choice"}),e.jsx("option",{value:"image_identify_logo",children:"Logo Identification"}),e.jsx("option",{value:"image_identify_person",children:"Person Identification"}),e.jsx("option",{value:"true_false",children:"True/False"}),e.jsx("option",{value:"short_answer",children:"Short Answer"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Category"}),e.jsx("input",{...a.register("category"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:"e.g. Science, History"}),a.formState.errors.category&&e.jsx("p",{className:"text-xs text-red-500",children:a.formState.errors.category.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Difficulty"}),e.jsxs("select",{...a.register("difficulty"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"hard",children:"Hard"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Points"}),e.jsx("input",{type:"number",...a.register("points",{valueAsNumber:!0}),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs("select",{...a.register("status"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Question Text"}),e.jsx("textarea",{...a.register("question_text"),rows:3,className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:"Enter the question here..."}),a.formState.errors.question_text&&e.jsx("p",{className:"text-xs text-red-500",children:a.formState.errors.question_text.message})]}),(r==="image_identify_logo"||r==="image_identify_person")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Image"}),e.jsx("div",{className:"flex gap-4 items-start",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{...a.register("image_url"),className:"flex-1 p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:"https://... or select from library"}),e.jsx("button",{type:"button",onClick:()=>x(!0),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300",children:e.jsx(he,{className:"w-4 h-4"})})]}),a.watch("image_url")&&e.jsxs("div",{className:"mt-2 relative w-fit group",children:[e.jsx("img",{src:a.watch("image_url")||"",alt:"Preview",className:"h-32 object-contain rounded border bg-gray-50 dark:bg-gray-800"}),e.jsx("button",{type:"button",onClick:()=>a.setValue("image_url",""),className:"absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ye,{className:"w-3 h-3"})})]})]})})]}),e.jsx(M,{open:p,onClose:()=>x(!1),title:"Select Media",className:"max-w-3xl",children:e.jsx(qe,{onSelect:l=>{a.setValue("image_url",l),x(!1)},onCancel:()=>x(!1)})}),(r==="text_mcq"||r==="image_identify_logo"||r==="image_identify_person")&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm font-medium",children:"Options"}),e.jsxs("button",{type:"button",onClick:()=>u(""),className:"text-sm text-indigo-600 hover:text-indigo-700 flex items-center gap-1",children:[e.jsx(Z,{className:"w-4 h-4"})," Add Option"]})]}),e.jsx("div",{className:"space-y-2",children:h.map((l,t)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{...a.register(`options.${t}`),className:"flex-1 p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:`Option ${t+1}`}),e.jsx("button",{type:"button",onClick:()=>v(t),className:"p-2 text-red-500 hover:bg-red-50 rounded",children:e.jsx(P,{className:"w-4 h-4"})})]},l.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Correct Answer"}),r==="true_false"?e.jsxs("select",{...a.register("correct_answer"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"",children:"Select Answer"}),e.jsx("option",{value:"True",children:"True"}),e.jsx("option",{value:"False",children:"False"})]}):r==="text_mcq"||r==="image_identify_logo"||r==="image_identify_person"?e.jsxs("select",{...a.register("correct_answer"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"",children:"Select Correct Option"}),a.watch("options")?.map((l,t)=>l&&e.jsx("option",{value:l,children:l},t))]}):e.jsx("input",{...a.register("correct_answer"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:"Enter correct answer"}),a.formState.errors.correct_answer&&e.jsx("p",{className:"text-xs text-red-500",children:a.formState.errors.correct_answer.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Explanation (Optional)"}),e.jsx("textarea",{...a.register("explanation"),rows:2,className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:"Explain why this is the correct answer..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:g,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:j,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:[j?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(fe,{className:"w-4 h-4"}),"Save Question"]})]})]})}function Oe({onGenerate:o,onCancel:b}){const{generateQuestions:g,isLoading:f}=L(),n=re({resolver:te(Qe),defaultValues:{topic:"",count:5,difficulty:"medium",type:"text_mcq"}}),j=async p=>{try{await g(p),d.success("Questions generated successfully! Check the Drafts tab."),o()}catch(x){console.error(x),d.error("Failed to generate questions. Please try again.")}};return e.jsxs("form",{onSubmit:n.handleSubmit(j),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg text-sm text-purple-800 dark:text-purple-200",children:[e.jsxs("p",{className:"flex items-center gap-2 font-medium",children:[e.jsx(G,{className:"w-4 h-4"})," AI Generation"]}),e.jsxs("p",{className:"mt-1 opacity-90",children:["Generated questions will be saved as ",e.jsx("strong",{children:"Drafts"}),". You can review and activate them later."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Topic / Subject"}),e.jsx("input",{...n.register("topic"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:"e.g. Solar System, World War II, Python Programming"}),n.formState.errors.topic&&e.jsx("p",{className:"text-xs text-red-500",children:n.formState.errors.topic.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Number of Questions"}),e.jsx("input",{type:"number",...n.register("count",{valueAsNumber:!0}),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",min:1,max:50}),n.formState.errors.count&&e.jsx("p",{className:"text-xs text-red-500",children:n.formState.errors.count.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Difficulty"}),e.jsxs("select",{...n.register("difficulty"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"hard",children:"Hard"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Question Type"}),e.jsxs("select",{...n.register("type"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"text_mcq",children:"Multiple Choice"}),e.jsx("option",{value:"image_identify_logo",children:"Logo Identification"}),e.jsx("option",{value:"image_identify_person",children:"Person Identification"}),e.jsx("option",{value:"true_false",children:"True/False"}),e.jsx("option",{value:"short_answer",children:"Short Answer"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:b,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:f,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[f?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(G,{className:"w-4 h-4"}),"Generate"]})]})]})}function De({onImportComplete:o,onCancel:b}){const[g,f]=i.useState(null),[n,j]=i.useState(!0),[p,x]=i.useState(!1),[a,h]=i.useState(null),u=r=>{const l=r.target.files?.[0];if(l){if(l.type!=="application/json"){d.error("Please select a JSON file");return}f(l),h(null)}},v=async()=>{if(!g){d.error("Please select a file");return}x(!0),h(null);try{const r=await g.text(),l=JSON.parse(r);if(!Array.isArray(l)){d.error("JSON file must contain an array of questions"),x(!1);return}const t=await me.post("/questions/import.php",{questions:l,skipDuplicates:n});h(t.data),t.data.imported>0?(d.success(`Successfully imported ${t.data.imported} questions!`),t.data.skipped>0&&d.info(`Skipped ${t.data.skipped} duplicate questions`)):d.warning("No questions were imported"),t.data.errors.length>0&&console.error("Import errors:",t.data.errors)}catch(r){console.error("Import error:",r);let l="Failed to import questions";if(pe.isAxiosError(r))if(r.response){const t=r.response.data;t.error&&(l=t.error),(t.imported>0||t.skipped>0)&&(h({imported:t.imported||0,skipped:t.skipped||0,errors:t.errors||[],total_processed:t.total_processed||0}),t.imported>0&&d.success(`Partially imported ${t.imported} questions`)),console.error("Server error:",t)}else r.request?(l="No response from server. Check your connection.",console.error("No response:",r.request)):l=r.message;else r instanceof Error&&(l=r.message);d.error(l)}finally{x(!1)}},y=()=>{a&&a.imported>0?o():b()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center",children:[e.jsx(be,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("span",{className:"text-indigo-600 hover:text-indigo-700 font-medium",children:"Choose a JSON file"}),e.jsx("input",{type:"file",accept:".json",onChange:u,className:"hidden"})]}),g&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["Selected: ",g.name]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"skipDuplicates",checked:n,onChange:r=>j(r.target.checked),className:"rounded border-gray-300"}),e.jsx("label",{htmlFor:"skipDuplicates",className:"text-sm text-gray-700 dark:text-gray-300",children:"Skip duplicate questions (based on question text)"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2 flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Expected JSON Format"]}),e.jsx("pre",{className:"text-xs bg-white dark:bg-gray-800 p-3 rounded overflow-x-auto",children:`[
  {
    "type": "text_mcq",
    "category": "Fundamentals",
    "difficulty": "easy",
    "question": "What is AI?",
    "options": ["Option 1", "Option 2", "Option 3", "Option 4"],
    "correct_answer": "Option 1",
    "image_url": "optional",
    "explanation": "optional"
  }
]`})]})]}),a&&e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:[e.jsx(je,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Imported: ",a.imported," questions"]})]}),a.skipped>0&&e.jsxs("div",{className:"flex items-center gap-2 text-yellow-600 dark:text-yellow-400",children:[e.jsx(W,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Skipped: ",a.skipped," duplicates"]})]}),a.errors.length>0&&e.jsxs("div",{className:"flex items-start gap-2 text-red-600 dark:text-red-400",children:[e.jsx(ee,{className:"w-5 h-5 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-medium block mb-1",children:["Errors: ",a.errors.length]}),e.jsx("div",{className:"text-sm space-y-1 max-h-40 overflow-y-auto",children:a.errors.map((r,l)=>e.jsxs("div",{className:"text-xs",children:["â€¢ ",r]},l))})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 pt-2 border-t border-gray-200 dark:border-gray-600",children:["Total processed: ",a.total_processed]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:y,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:a&&a.imported>0?"Close":"Cancel"}),e.jsxs("button",{onClick:v,disabled:!g||p,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(K,{className:"w-4 h-4"}),p?"Importing...":"Import Questions"]})]})]})}function ze(){const{fetchQuestions:o,deleteQuestion:b,updateQuestion:g,isLoading:f}=L(),[n,j]=i.useState([]),[p,x]=i.useState(0),[a,h]=i.useState(1),[u]=i.useState(50),[v,y]=i.useState(""),[r,l]=i.useState(""),[t,z]=i.useState(""),[I,c]=i.useState(""),[N,A]=i.useState(""),[O,le]=i.useState(void 0),[J,ie]=i.useState("created_at"),[B,U]=i.useState("desc"),[k,D]=i.useState(new Set),[oe,Q]=i.useState(!1),[ne,T]=i.useState(!1),[de,E]=i.useState(!1),[H,V]=i.useState(void 0),w=i.useCallback(async()=>{try{const s=(a-1)*u,{questions:m,total:ue}=await o({search:v,category:r||void 0,difficulty:t||void 0,type:I||void 0,status:N||void 0,ai_generated:O,limit:u,offset:s,sortBy:J,sortOrder:B});j(m),x(ue)}catch(s){console.error(s),d.error("Failed to load questions")}},[a,u,v,r,t,I,N,O,J,B,o]);i.useEffect(()=>{const s=setTimeout(()=>{w()},300);return()=>clearTimeout(s)},[w]);const S=s=>{J===s?U(B==="asc"?"desc":"asc"):(ie(s),U("asc"))},ce=async s=>{if(confirm("Are you sure you want to delete this question?"))try{await b(s),d.success("Question deleted"),w()}catch(m){console.error(m),d.error("Failed to delete question")}},$=async s=>{if(k.size!==0&&!(s==="delete"&&!confirm(`Delete ${k.size} questions?`)))try{await Promise.all(Array.from(k).map(m=>s==="delete"?b(m):g(m,{status:s==="activate"?"active":"inactive"}))),d.success("Bulk action completed"),D(new Set),w()}catch(m){console.error(m),d.error("Failed to perform bulk action")}},xe=s=>{const m=new Set(k);m.has(s)?m.delete(s):m.add(s),D(m)},ge=()=>{k.size===n.length?D(new Set):D(new Set(n.map(s=>s.id)))};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Question Bank"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>w(),className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",title:"Refresh List",children:e.jsx(Ne,{className:`w-4 h-4 ${f?"animate-spin":""}`})}),e.jsxs("button",{onClick:()=>E(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(X,{className:"w-4 h-4"})," Import JSON"]}),e.jsxs("button",{onClick:()=>T(!0),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[e.jsx(G,{className:"w-4 h-4"})," AI Generate"]}),e.jsxs("button",{onClick:()=>{V(void 0),Q(!0)},className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:[e.jsx(Z,{className:"w-4 h-4"})," Add Question"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-[200px] relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search questions...",value:v,onChange:s=>y(s.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"})]}),e.jsx("input",{type:"text",placeholder:"Filter by Category",value:r,onChange:s=>l(s.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white"}),e.jsxs("select",{value:I,onChange:s=>c(s.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"text_mcq",children:"Multiple Choice"}),e.jsx("option",{value:"image_identify_logo",children:"Logo ID"}),e.jsx("option",{value:"image_identify_person",children:"Person ID"}),e.jsx("option",{value:"true_false",children:"True/False"})]}),e.jsxs("select",{value:t,onChange:s=>z(s.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"All Difficulties"}),e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"hard",children:"Hard"})]}),e.jsxs("select",{value:N,onChange:s=>A(s.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"draft",children:"Draft"})]}),e.jsxs("select",{value:O===void 0?"":O.toString(),onChange:s=>le(s.target.value===""?void 0:s.target.value==="true"),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"All Sources"}),e.jsx("option",{value:"true",children:"AI Generated"}),e.jsx("option",{value:"false",children:"Manual"})]})]}),k.size>0&&e.jsxs("div",{className:"flex gap-2 pt-2 border-t dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>$("activate"),className:"flex items-center gap-2 px-3 py-1.5 bg-green-100 text-green-700 rounded hover:bg-green-200 text-sm",children:[e.jsx(ve,{className:"w-4 h-4"})," Activate Selected"]}),e.jsxs("button",{onClick:()=>$("deactivate"),className:"flex items-center gap-2 px-3 py-1.5 bg-yellow-100 text-yellow-700 rounded hover:bg-yellow-200 text-sm",children:[e.jsx(ee,{className:"w-4 h-4"})," Deactivate Selected"]}),e.jsxs("button",{onClick:()=>$("delete"),className:"flex items-center gap-2 px-3 py-1.5 bg-red-100 text-red-700 rounded hover:bg-red-200 text-sm",children:[e.jsx(P,{className:"w-4 h-4"})," Delete Selected"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 w-4",children:e.jsx("input",{type:"checkbox",checked:k.size===n.length&&n.length>0,onChange:ge,className:"rounded border-gray-300"})}),e.jsx("th",{className:"p-4 w-10"})," ",e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>S("question_text"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Question ",e.jsx(_,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>S("question_type"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Type ",e.jsx(_,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>S("category"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Category ",e.jsx(_,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>S("difficulty"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Difficulty ",e.jsx(_,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>S("points"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Pts ",e.jsx(_,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>S("status"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Status ",e.jsx(_,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>S("created_at"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Created ",e.jsx(_,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:f?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"p-8 text-center",children:e.jsx(F,{className:"w-8 h-8 animate-spin mx-auto text-indigo-600"})})}):n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"p-8 text-center text-gray-500 dark:text-gray-400",children:"No questions found"})}):n.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"p-4",children:e.jsx("input",{type:"checkbox",checked:k.has(s.id),onChange:()=>xe(s.id),className:"rounded border-gray-300"})}),e.jsx("td",{className:"p-4",children:(s.image_url||s.media_id)&&e.jsx("div",{className:"w-8 h-8 rounded bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-500 dark:text-gray-400",children:e.jsx(X,{className:"w-4 h-4"})})}),e.jsxs("td",{className:"p-4 max-w-md",children:[e.jsx("div",{className:"truncate font-medium text-gray-900 dark:text-gray-100",title:s.question_text,children:s.question_text}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5 truncate",title:s.correct_answer,children:["Ans: ",s.correct_answer]})]}),e.jsx("td",{className:"p-4 capitalize text-sm text-gray-700 dark:text-gray-300",children:s.question_type.replace(/_/g," ")}),e.jsx("td",{className:"p-4 text-sm text-gray-700 dark:text-gray-300",children:s.category}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:R("px-2 py-1 rounded-full text-xs font-medium capitalize",s.difficulty==="easy"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":s.difficulty==="medium"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"),children:s.difficulty})}),e.jsx("td",{className:"p-4 text-sm font-medium text-gray-700 dark:text-gray-300",children:s.points}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:R("px-2 py-1 rounded-full text-xs font-medium capitalize",s.status==="active"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":s.status==="inactive"?"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"),children:s.status})}),e.jsxs("td",{className:"p-4 text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap",children:[new Date(s.created_at).toLocaleDateString(),s.ai_generated&&e.jsxs("span",{className:"ml-2 inline-flex items-center gap-0.5 text-[10px] text-purple-600 bg-purple-50 dark:bg-purple-900/20 px-1.5 py-0.5 rounded-full border border-purple-100 dark:border-purple-800",children:[e.jsx(G,{className:"w-3 h-3"})," AI"]})]}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>{V(s),Q(!0)},className:"p-1 text-gray-500 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors",title:"Edit",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ce(s.id),className:"p-1 text-gray-500 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors",title:"Delete",children:e.jsx(P,{className:"w-4 h-4"})})]})})]},s.id))})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Showing ",(a-1)*u+1," to ",Math.min(a*u,p)," of ",p," questions"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>h(s=>Math.max(1,s-1)),disabled:a===1,className:"p-2 border rounded hover:bg-gray-50 disabled:opacity-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",children:e.jsx(we,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>h(s=>s+1),disabled:a*u>=p,className:"p-2 border rounded hover:bg-gray-50 disabled:opacity-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",children:e.jsx(Se,{className:"w-4 h-4"})})]})]})]}),e.jsx(M,{open:oe,onClose:()=>Q(!1),title:H?"Edit Question":"Create Question",className:"max-w-4xl",children:e.jsx(Fe,{question:H,onSave:async()=>{Q(!1),w()},onCancel:()=>Q(!1)})}),e.jsx(M,{open:ne,onClose:()=>T(!1),title:"AI Question Generator",className:"max-w-2xl",children:e.jsx(Oe,{onGenerate:async()=>{T(!1),w()},onCancel:()=>T(!1)})}),e.jsx(M,{open:de,onClose:()=>E(!1),title:"Import Questions from JSON",className:"max-w-3xl",children:e.jsx(De,{onImportComplete:()=>{E(!1),w()},onCancel:()=>E(!1)})})]})}export{ze as Questions};
