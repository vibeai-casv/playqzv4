import{u as le,j as e,c as j}from"./index-CSwfmqfS.js";import{r as a}from"./vendor-D8AvkUoV.js";import{u as de}from"./useAdmin-7UCUkY5E.js";import{M as ie}from"./Modal-Clk7JNBT.js";import{a3 as I,a4 as ce,m as C,D as ne,a5 as oe,k as M,a6 as xe,a7 as ge,O as U,u as he,s as me,v as pe,i as d,a8 as ye}from"./ui-CEq2p6SN.js";function fe(){const{fetchUsers:O,fetchUserActivity:P,toggleUserStatus:D,updateUserRole:A,isLoading:T}=de(),{isSuperAdmin:z}=le(),[n,B]=a.useState([]),[b,J]=a.useState(0),[o,L]=a.useState(1),[x]=a.useState(20),[N,V]=a.useState(""),[v,q]=a.useState(""),[f,H]=a.useState(""),[w,Q]=a.useState(""),[k,X]=a.useState(""),[p,G]=a.useState("created_at"),[y,R]=a.useState("desc"),[l,_]=a.useState(null),[g,K]=a.useState(null),[W,E]=a.useState(!1),[r,h]=a.useState(new Set),m=async()=>{try{const s=(o-1)*x,{users:t,total:u}=await O({search:N,category:v||void 0,district:f||void 0,role:w||void 0,status:k||void 0,limit:x,offset:s,sortBy:p,sortOrder:y});B(t),J(u)}catch{d.error("Failed to load users")}};a.useEffect(()=>{const s=setTimeout(()=>{m()},300);return()=>clearTimeout(s)},[o,N,v,f,w,k,p,y]);const Y=s=>{p===s?R(y==="asc"?"desc":"asc"):(G(s),R("asc"))},Z=async s=>{_(s),E(!0);try{const t=await P(s.id);K(t)}catch{d.error("Failed to load user activity")}finally{E(!1)}},ee=async s=>{try{await D(s.id,!s.disabled),d.success(`User ${s.disabled?"enabled":"disabled"} successfully`),m()}catch{d.error("Failed to update user status")}},$=async s=>{if(r.size!==0)try{await Promise.all(Array.from(r).map(t=>D(t,s))),d.success(`${r.size} users ${s?"disabled":"enabled"}`),h(new Set),m()}catch{d.error("Failed to update users")}},F=async(s,t)=>{try{await A(s.id,t),d.success(`User role updated to ${t}`),m()}catch{d.error("Failed to update user role")}},se=async s=>{if(r.size!==0)try{await Promise.all(Array.from(r).map(t=>A(t,s))),d.success(`${r.size} users updated to ${s}`),h(new Set),m()}catch{d.error("Failed to update users")}},te=()=>{const t=[["Name","Email","Phone","Category","Institution","District","Role","Status","Joined"].join(","),...n.map(i=>[`"${i.name}"`,i.email||"",i.phone||"",i.category||"",`"${i.institution||""}"`,i.district||"",i.role,i.disabled?"Disabled":"Active",new Date(i.created_at).toLocaleDateString()].join(","))].join(`
`),u=new Blob([t],{type:"text/csv;charset=utf-8;"}),S=document.createElement("a");S.href=URL.createObjectURL(u),S.download=`users_export_${new Date().toISOString().split("T")[0]}.csv`,S.click()},ae=s=>{const t=new Set(r);t.has(s)?t.delete(s):t.add(s),h(t)},re=()=>{r.size===n.length?h(new Set):h(new Set(n.map(s=>s.id)))},c=({field:s,label:t})=>e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>Y(s),children:e.jsxs("div",{className:"flex items-center gap-1",children:[t,p===s?y==="asc"?e.jsx(U,{className:"w-4 h-4 rotate-90"}):e.jsx(U,{className:"w-4 h-4 -rotate-90"}):e.jsx(ye,{className:"w-3 h-3 text-gray-400"})]})});return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"User Management"}),e.jsxs("div",{className:"flex gap-2",children:[r.size>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>$(!0),className:"flex items-center gap-2 px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200",children:[e.jsx(I,{className:"w-4 h-4"})," Disable Selected"]}),e.jsxs("button",{onClick:()=>$(!1),className:"flex items-center gap-2 px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200",children:[e.jsx(ce,{className:"w-4 h-4"})," Enable Selected"]}),e.jsxs("button",{onClick:()=>se("admin"),className:"flex items-center gap-2 px-4 py-2 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200",children:[e.jsx(C,{className:"w-4 h-4"})," Make Admin"]})]}),e.jsxs("button",{onClick:te,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:[e.jsx(ne,{className:"w-4 h-4"})," Export CSV"]})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow space-y-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-[200px] relative",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search users...",value:N,onChange:s=>V(s.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"})]}),e.jsx("input",{type:"text",placeholder:"Filter by District",value:f,onChange:s=>H(s.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"}),e.jsxs("select",{value:v,onChange:s=>q(s.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"",children:"All Categories"}),e.jsx("option",{value:"student",children:"Student"}),e.jsx("option",{value:"professional",children:"Professional"}),e.jsx("option",{value:"educator",children:"Educator"})]}),e.jsxs("select",{value:w,onChange:s=>Q(s.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"",children:"All Roles"}),e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]}),e.jsxs("select",{value:k,onChange:s=>X(s.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"disabled",children:"Disabled"})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 w-4",children:e.jsx("input",{type:"checkbox",checked:r.size===n.length&&n.length>0,onChange:re,className:"rounded border-gray-300"})}),e.jsx(c,{field:"name",label:"Name"}),e.jsx(c,{field:"email",label:"Contact"}),e.jsx(c,{field:"category",label:"Category"}),e.jsx(c,{field:"institution",label:"Institution"}),e.jsx(c,{field:"district",label:"District"}),e.jsx(c,{field:"role",label:"Role"}),e.jsx(c,{field:"disabled",label:"Status"}),e.jsx(c,{field:"created_at",label:"Joined"}),e.jsx("th",{className:"p-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:T?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"p-8 text-center",children:e.jsx(M,{className:"w-8 h-8 animate-spin mx-auto text-indigo-600"})})}):n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"p-8 text-center text-gray-500",children:"No users found"})}):n.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"p-4",children:e.jsx("input",{type:"checkbox",checked:r.has(s.id),onChange:()=>ae(s.id),className:"rounded border-gray-300"})}),e.jsx("td",{className:"p-4 font-medium text-gray-900 dark:text-white",children:s.name}),e.jsx("td",{className:"p-4 text-gray-700 dark:text-gray-300",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:s.email}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:s.phone})]})}),e.jsx("td",{className:"p-4 capitalize text-gray-900 dark:text-gray-100",children:s.category}),e.jsx("td",{className:"p-4 text-gray-900 dark:text-gray-100",children:s.institution}),e.jsx("td",{className:"p-4 text-gray-900 dark:text-gray-100",children:s.district}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:j("px-2 py-1 rounded-full text-xs font-medium",s.role==="admin"?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"),children:s.role})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:j("px-2 py-1 rounded-full text-xs font-medium",s.disabled?"bg-red-100 text-red-700":"bg-green-100 text-green-700"),children:s.disabled?"Disabled":"Active"})}),e.jsx("td",{className:"p-4 text-gray-700 dark:text-gray-300",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>Z(s),className:"p-1 text-gray-500 hover:text-indigo-600",title:"View Details",children:e.jsx(xe,{className:"w-4 h-4"})}),s.role!=="admin"&&s.role!=="super_admin"||z?e.jsx("button",{onClick:()=>ee(s),className:j("p-1",s.disabled?"text-green-600 hover:text-green-700":"text-red-600 hover:text-red-700"),title:s.disabled?"Enable User":"Disable User",disabled:s.role==="super_admin",children:s.disabled?e.jsx(C,{className:"w-4 h-4"}):e.jsx(ge,{className:"w-4 h-4"})}):null,s.role==="user"&&e.jsx("button",{onClick:()=>F(s,"admin"),className:"p-1 text-purple-600 hover:text-purple-700",title:"Make Admin",children:e.jsx(C,{className:"w-4 h-4"})}),s.role==="admin"&&z&&e.jsx("button",{onClick:()=>F(s,"user"),className:"p-1 text-gray-500 hover:text-gray-700",title:"Remove Admin",children:e.jsx(I,{className:"w-4 h-4"})})]})})]},s.id))})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["Showing ",(o-1)*x+1," to ",Math.min(o*x,b)," of ",b," users"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>L(s=>Math.max(1,s-1)),disabled:o===1,className:"p-2 border rounded hover:bg-gray-50 disabled:opacity-50",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>L(s=>s+1),disabled:o*x>=b,className:"p-2 border rounded hover:bg-gray-50 disabled:opacity-50",children:e.jsx(he,{className:"w-4 h-4"})})]})]})]}),e.jsx(ie,{open:!!l,onClose:()=>_(null),title:"User Details",className:"max-w-4xl",children:l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between pb-6 border-b dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l.name}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:[l.email," â€¢ ",l.phone]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("span",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded text-sm",children:l.institution||"No Institution"}),e.jsx("span",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded text-sm capitalize",children:l.category}),l.district&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded text-sm",children:l.district})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Joined"}),e.jsx("p",{className:"font-medium",children:new Date(l.created_at).toLocaleDateString()})]})]}),W?e.jsx("div",{className:"py-12 text-center",children:e.jsx(M,{className:"w-8 h-8 animate-spin mx-auto text-indigo-600"})}):g?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4"})," Recent Logins"]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 space-y-3",children:g.logins.length===0?e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"No recent logins"}):g.logins.map(s=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:new Date(s.created_at).toLocaleString()}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:s.ip_address||"Unknown IP"})]},s.id))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"})," Recent Quizzes"]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 space-y-3",children:g.attempts.length===0?e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"No quiz attempts"}):g.attempts.map(s=>e.jsxs("div",{className:"flex justify-between text-sm border-b dark:border-gray-600 last:border-0 pb-2 last:pb-0",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Score: ",s.score||0]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:new Date(s.started_at).toLocaleDateString()})]}),e.jsx("span",{className:j("px-2 py-0.5 rounded text-xs h-fit",s.status==="completed"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"),children:s.status})]},s.id))})]})]}):null]})})]})}export{fe as Users};
