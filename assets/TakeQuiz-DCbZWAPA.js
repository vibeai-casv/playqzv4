import{j as e,c as l,g as S}from"./index-CSwfmqfS.js";import{u as P,r as o}from"./vendor-D8AvkUoV.js";import{u as X}from"./quizStore-DYE6Gulg.js";import{I as Y}from"./Image-DFUbhxDM.js";import{T as z,s as G,B as K,z as f,O as U,u as V,k as Z,X as $}from"./ui-CEq2p6SN.js";function w({open:d,onClose:x,children:i}){return d?e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 animate-in fade-in duration-200",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-2xl p-6 max-w-lg w-full relative shadow-2xl shadow-black/50 animate-in zoom-in-95 duration-200",children:[e.jsx("button",{onClick:x,className:"absolute top-4 right-4 text-slate-500 hover:text-white transition-colors","aria-label":"Close modal",children:e.jsx($,{className:"w-5 h-5"})}),i]})}):null}function te(){const d=P(),{questions:x,currentQuestionIndex:i,responses:Q,nextQuestion:u,previousQuestion:E,submitAnswer:m,submitQuiz:I,timeRemaining:r,setTimeRemaining:p,isLoading:j}=X(),[M,h]=o.useState(!1),[L,b]=o.useState(!1),[_,v]=o.useState(!1),[N,R]=o.useState(""),s=x[i],c=x.length;o.useEffect(()=>{if(r<=0)return;const t=setInterval(()=>{p(a=>Math.max(a-1,0))},1e3);return()=>clearInterval(t)},[r,p]),o.useEffect(()=>{const t=a=>{a.preventDefault(),a.returnValue=""};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[]);const g=o.useCallback(t=>{if(!s)return;const a=parseInt(t.key,10);if(a>=1&&a<=4){const n=s.options?.[a-1];if(n){const D=performance.now();m(s.id,n,Math.round(performance.now()-D)/1e3)}}},[s,m]);o.useEffect(()=>(window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)),[g]);const[k,y]=o.useState(!1),q=o.useCallback(t=>{if(k)return;const a=performance.now();m(s.id,t,Math.round(performance.now()-a)/1e3),i<c-1&&(y(!0),setTimeout(()=>{u(),y(!1)},800))},[s,m,i,c,u,k]),T=t=>{R(S(t)),v(!0)},A=async()=>{try{await I(),d("/quiz-results")}catch(t){console.error(t)}},C=o.useRef(null);if(o.useEffect(()=>{C.current?.focus()},[i]),!s)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(z,{className:"w-12 h-12 text-amber-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No quiz loaded. Please start a quiz from the configuration page."}),e.jsx("button",{onClick:()=>d("/quiz-config"),className:"mt-4 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-500 transition-colors",children:"Go to Config"})]})});const O=Q.get(s.id)?.user_answer,B=(i+1)/c*100;return e.jsxs("div",{className:"max-w-5xl mx-auto p-4 md:p-6 space-y-6",children:[e.jsxs("header",{className:"bg-slate-900/50 backdrop-blur-sm border border-white/5 p-4 rounded-2xl flex items-center justify-between sticky top-4 z-30 shadow-lg shadow-black/20",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-slate-400 uppercase tracking-wider font-bold",children:"Question"}),e.jsxs("span",{className:"text-xl font-bold text-white",children:[e.jsx("span",{className:"text-indigo-400",children:i+1}),e.jsx("span",{className:"text-slate-600 mx-1",children:"/"}),c]})]}),e.jsx("div",{className:"hidden md:block h-8 w-px bg-white/10"}),e.jsx("div",{className:"hidden md:block w-32 h-2 bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 rounded-full transition-all duration-500 ease-out",style:{width:`${B}%`}})})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[r>0&&e.jsxs("div",{className:l("flex items-center px-3 py-1.5 rounded-lg border transition-colors",r<60?"bg-red-500/10 border-red-500/30 text-red-400":"bg-slate-800 border-white/5 text-slate-300"),children:[e.jsx(G,{className:l("w-4 h-4 mr-2",r<60&&"animate-pulse")}),e.jsxs("span",{className:"font-mono font-bold",children:[Math.floor(r/60),":",String(r%60).padStart(2,"0")]})]}),e.jsx("button",{onClick:()=>h(!0),className:"p-2 text-slate-400 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",title:"Exit Quiz",children:e.jsx(K,{className:"w-6 h-6"})})]})]}),e.jsxs("section",{className:"bg-slate-900/50 backdrop-blur-sm rounded-3xl border border-white/5 p-6 md:p-10 shadow-xl min-h-[400px] flex flex-col",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-white leading-tight mb-8",children:s.question_text}),s.image_url&&e.jsxs("div",{className:"mb-8 relative group w-full max-w-2xl mx-auto rounded-2xl overflow-hidden border border-white/10 bg-black/20 cursor-zoom-in",onClick:()=>T(s.image_url),children:[e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center",children:e.jsx("span",{className:"opacity-0 group-hover:opacity-100 text-white font-medium px-4 py-2 bg-black/50 rounded-full backdrop-blur-sm transition-opacity",children:"Click to zoom"})}),e.jsx(Y,{src:S(s.image_url),alt:"Question illustration",className:"max-w-[250px] max-h-[250px] object-contain mx-auto"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.options?.map((t,a)=>{const n=O===t;return e.jsxs("button",{ref:a===0?C:void 0,onClick:()=>q(t),className:l("group relative p-5 rounded-xl text-left transition-all duration-200 border-2 outline-none",n?"bg-indigo-600/20 border-indigo-500 shadow-[0_0_15px_-3px_rgba(99,102,241,0.4)]":"bg-white/5 border-transparent hover:bg-white/10 hover:border-white/10"),children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:l("flex-shrink-0 w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold mr-4 transition-colors",n?"bg-indigo-500 text-white":"bg-white/10 text-slate-400 group-hover:bg-white/20 group-hover:text-white"),children:String.fromCharCode(65+a)}),e.jsx("span",{className:l("text-lg font-medium transition-colors",n?"text-white":"text-slate-300 group-hover:text-white"),children:t})]}),n&&e.jsx("div",{className:"absolute top-5 right-5",children:e.jsx(f,{className:"w-5 h-5 text-indigo-400"})})]},t)})})]}),e.jsxs("div",{className:"mt-10 pt-6 border-t border-white/5 flex items-center justify-between",children:[e.jsxs("button",{onClick:E,disabled:i===0,className:l("flex items-center px-6 py-3 rounded-xl font-medium transition-all",i===0?"text-slate-600 cursor-not-allowed":"text-slate-300 hover:text-white hover:bg-white/5"),children:[e.jsx(U,{className:"w-5 h-5 mr-2"})," Previous"]}),i<c-1?e.jsxs("button",{onClick:u,className:"flex items-center px-8 py-3 rounded-xl bg-white text-indigo-950 font-bold hover:bg-indigo-50 transition-all shadow-lg hover:shadow-white/10 transform hover:-translate-y-0.5",children:["Next ",e.jsx(V,{className:"w-5 h-5 ml-2"})]}):e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center px-8 py-3 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-500 transition-all shadow-lg shadow-indigo-500/25 transform hover:-translate-y-0.5",children:["Submit Quiz ",e.jsx(f,{className:"w-5 h-5 ml-2"})]})]})]}),e.jsx(w,{open:M,onClose:()=>h(!1),children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(z,{className:"w-8 h-8 text-red-500"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Leave Quiz?"}),e.jsx("p",{className:"text-slate-400 mb-6",children:"Your progress will be saved, but you will lose the current attempt if you close the tab."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>h(!1),className:"px-6 py-2.5 rounded-xl bg-slate-800 text-white hover:bg-slate-700 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>d("/dashboard"),className:"px-6 py-2.5 rounded-xl bg-red-600 text-white hover:bg-red-500 font-medium transition-colors shadow-lg shadow-red-600/20",children:"Leave Quiz"})]})]})}),e.jsx(w,{open:L,onClose:()=>b(!1),children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-500/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(f,{className:"w-8 h-8 text-indigo-500"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Submit Quiz?"}),e.jsx("p",{className:"text-slate-400 mb-6",children:"Are you sure you want to submit? You will not be able to change answers after submission."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>b(!1),className:"px-6 py-2.5 rounded-xl bg-slate-800 text-white hover:bg-slate-700 font-medium transition-colors",children:"Review"}),e.jsxs("button",{onClick:A,disabled:j,className:"px-6 py-2.5 rounded-xl bg-indigo-600 text-white hover:bg-indigo-500 font-medium transition-colors shadow-lg shadow-indigo-600/20 flex items-center",children:[j?e.jsx(Z,{className:"w-4 h-4 mr-2 animate-spin"}):null,"Confirm Submit"]})]})]})}),e.jsx(w,{open:_,onClose:()=>v(!1),children:N&&e.jsx("img",{src:N,alt:"Zoomed",className:"max-w-full max-h-[80vh] object-contain mx-auto rounded-lg"})})]})}export{te as TakeQuiz};
