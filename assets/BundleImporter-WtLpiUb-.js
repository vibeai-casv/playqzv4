import{j as e,b as p,a as j}from"./index-Boj86S3A.js";import{r as n}from"./vendor-D8AvkUoV.js";import{ai as m,w as u,o as g,B as k,i as l}from"./ui-CEq2p6SN.js";function E({onImportComplete:x,onCancel:h}){const[o,f]=n.useState(null),[d,c]=n.useState(!1),[r,i]=n.useState(null),b=s=>{const t=s.target.files?.[0];if(t){if(!t.name.endsWith(".zip")){l.error("Please select a ZIP file");return}f(t),i(null)}},y=async()=>{if(!o){l.error("Please select a file");return}c(!0),i(null),console.log("=== BUNDLE IMPORT STARTED ==="),console.log("File:",{name:o.name,size:o.size,type:o.type,lastModified:new Date(o.lastModified).toISOString()});try{console.log("Step 1: Creating FormData...");const s=new FormData;s.append("bundle",o),console.log("✅ FormData created");const t=(p.defaults.baseURL||"")+"/bundle/import.php";console.log("Step 2: Sending POST request to:",t),console.log("Request headers will include:",{"Content-Type":"multipart/form-data",Authorization:sessionStorage.getItem("auth_token")?"✓ Present":"✗ Missing"}),l.info("Uploading bundle...",{duration:2e3});const a=await p.post("/bundle/import.php",s,{headers:{"Content-Type":"multipart/form-data"}});console.log("Step 3: Response received"),console.log("Response status:",a.status),console.log("Response data:",a.data),i(a.data.stats),console.log("Import Stats:",{questions_imported:a.data.stats.questions_imported,questions_skipped:a.data.stats.questions_skipped,media_imported:a.data.stats.media_imported,errors_count:a.data.stats.errors.length}),a.data.stats.questions_imported>0?(l.success(`Successfully imported ${a.data.stats.questions_imported} question(s)!`),console.log("✅ Import successful")):(l.warning("No new questions were imported (records may already exist)"),console.log("⚠️ No questions imported (possibly duplicates)")),a.data.stats.errors.length>0&&console.error("Import errors:",a.data.stats.errors),console.log("=== BUNDLE IMPORT COMPLETED ===")}catch(s){console.error("=== BUNDLE IMPORT FAILED ==="),console.error("Error details:",s);let t="Failed to import bundle";j.isAxiosError(s)?(console.error("Axios Error:",{message:s.message,code:s.code,status:s.response?.status,statusText:s.response?.statusText,responseData:s.response?.data,requestURL:s.config?.url,requestMethod:s.config?.method}),s.response?.data?.error?t=s.response.data.error:s.response?.status===404?t="Import endpoint not found - check if /bundle/import.php exists":s.response?.status===413?t="File too large - check server upload limits":s.response?.status===500?t="Server error - check server logs":s.code==="ERR_NETWORK"&&(t="Network error - check connection")):s instanceof Error&&(console.error("Generic Error:",s.message),t=s.message),l.error(t,{duration:5e3}),console.log("Error message shown to user:",t)}finally{c(!1),console.log("=== IMPORT PROCESS ENDED ===")}},N=()=>{r&&r.questions_imported>0?x():h()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center",children:[e.jsx(m,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("span",{className:"text-indigo-600 hover:text-indigo-700 font-medium",children:"Choose Question Bundle (ZIP)"}),e.jsx("input",{type:"file",accept:".zip",onChange:b,className:"hidden"})]}),o&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["Selected: ",o.name]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 text-sm text-blue-900 dark:text-blue-100",children:[e.jsxs("p",{className:"flex items-center gap-2 mb-1",children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("strong",{children:"Importing Bundles"})]}),e.jsx("p",{className:"opacity-90 ml-6",children:"Bundles contain questions and their associated images. Existing questions (by ID) will be skipped to prevent duplicates."})]})]}),r&&e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:[e.jsx(g,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Questions Imported: ",r.questions_imported]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 dark:text-blue-400",children:[e.jsx(g,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Images Imported: ",r.media_imported]})]}),r.questions_skipped>0&&e.jsxs("div",{className:"flex items-center gap-2 text-yellow-600 dark:text-yellow-400",children:[e.jsx(u,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Skipped (Duplicates): ",r.questions_skipped]})]}),r.errors.length>0&&e.jsxs("div",{className:"flex items-start gap-2 text-red-600 dark:text-red-400 pt-2 border-t border-gray-200 dark:border-gray-600 mt-2",children:[e.jsx(k,{className:"w-5 h-5 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-medium block mb-1",children:["Errors: ",r.errors.length]}),e.jsx("div",{className:"text-sm space-y-1 max-h-40 overflow-y-auto",children:r.errors.map((s,t)=>e.jsxs("div",{className:"text-xs",children:["• ",s]},t))})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:N,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:r?"Close":"Cancel"}),e.jsxs("button",{onClick:y,disabled:!o||d,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(m,{className:"w-4 h-4"}),d?"Importing...":"Import Bundle"]})]})]})}export{E as B};
