import{j as e,c as F,a as pe,d as he}from"./index-C57Ivx-l.js";import{r as o}from"./vendor-D8AvkUoV.js";import{u as G}from"./useAdmin-03L9WaYx.js";import{M as P}from"./Modal-DJEYL3g9.js";import{a3 as Z,j as O,a7 as Y,a8 as L,h as d,I as ye,X as be,a9 as K,V as fe,aa as $,ab as je,v as H,n as Ne,x as ee,R as ve,ac as X,w as ke,a6 as Q,ad as we,ae as _e,J as Se,s as Ce}from"./ui-8QwkGQs4.js";import{o as te,s as _,c as Ie,_ as D,n as re,u as ae,a as se,d as Ae}from"./schemas-BznUp_a-.js";import{Z as Qe}from"./compat-DOTGHHbm.js";const Fe=te({question_text:_().min(3,"Question text must be at least 3 characters"),question_type:D(["text_mcq","image_identify_logo","image_identify_person","true_false","short_answer"]),category:_().min(1,"Category is required"),difficulty:D(["easy","medium","hard"]),points:re().min(1,"Points must be at least 1"),status:D(["active","inactive","draft"]),options:Ie(_()).default([]),correct_answer:_().min(1,"Correct answer is required"),explanation:_().optional(),image_url:_().optional().refine(a=>!a||a===""||a.startsWith("/")||a.startsWith("http://")||a.startsWith("https://"),"Image URL must be a valid URL or path starting with /")}).superRefine((a,p)=>{a.status==="active"&&(a.question_type==="image_identify_logo"||a.question_type==="image_identify_person")&&(a.image_url||p.addIssue({code:Qe.custom,message:"Image is required for active image identification questions",path:["image_url"]}))}),qe=te({topic:_().min(3,"Topic is required"),count:re().min(1).max(50),difficulty:D(["easy","medium","hard"]),type:D(["text_mcq","image_identify_logo","image_identify_person","true_false","short_answer"])});function De({onSelect:a,onCancel:p}){const{fetchMedia:u,uploadMedia:f,deleteMedia:n,isLoading:j}=G(),[h,g]=o.useState([]),[r,y]=o.useState(!1),[m,v]=o.useState(""),[b,s]=o.useState("all"),l=async()=>{try{const{media:c}=await u({type:b==="all"?void 0:b});g(c)}catch(c){console.error(c),d.error("Failed to load media")}};o.useEffect(()=>{l()},[b]);const i=async c=>{const N=c.target.files?.[0];if(N){y(!0);try{const I=await f(N,b==="all"?"logo":b);d.success("File uploaded successfully"),a(I.url)}catch(C){console.error(C),d.error("Failed to upload file")}finally{y(!1)}}},R=async(c,N)=>{if(c.stopPropagation(),!!confirm("Are you sure you want to delete this image?"))try{await n(N),d.success("Image deleted successfully"),l()}catch(C){console.error(C),d.error("Failed to delete image")}},S=h.filter(c=>c.filename.toLowerCase().includes(m.toLowerCase()));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search media...",value:m,onChange:c=>v(c.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"})]}),e.jsxs("select",{value:b,onChange:c=>s(c.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"logo",children:"Logos"}),e.jsx("option",{value:"personality",children:"Personalities"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",id:"modal-file-upload",className:"hidden",accept:"image/*",onChange:i,disabled:r}),e.jsxs("label",{htmlFor:"modal-file-upload",className:F("flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 cursor-pointer",r&&"opacity-50 cursor-not-allowed"),children:[r?e.jsx(O,{className:"w-4 h-4 animate-spin"}):e.jsx(Y,{className:"w-4 h-4"}),"Upload"]})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 max-h-[400px] overflow-y-auto p-1",children:j?e.jsx("div",{className:"col-span-full flex justify-center py-8",children:e.jsx(O,{className:"w-8 h-8 animate-spin text-indigo-600"})}):S.length===0?e.jsx("div",{className:"col-span-full text-center py-8 text-gray-500",children:"No media found"}):S.map(c=>e.jsxs("div",{className:"group relative aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden border hover:border-indigo-500 cursor-pointer",onClick:()=>a(c.url),children:[e.jsx("img",{src:c.url,alt:c.filename,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-white font-medium bg-indigo-600 px-3 py-1 rounded-full text-sm",children:"Select"}),e.jsx("button",{onClick:N=>R(N,c.id),className:"p-2 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors",title:"Delete image",children:e.jsx(L,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 p-2 text-xs text-white truncate",children:c.filename})]},c.id))}),e.jsx("div",{className:"flex justify-end pt-4 border-t dark:border-gray-700",children:e.jsx("button",{onClick:p,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300",children:"Cancel"})})]})}function Oe({question:a,onSave:p,onCancel:u}){const{createQuestion:f,updateQuestion:n,isLoading:j}=G(),[h,g]=o.useState(!1),r=ae({resolver:se(Fe),defaultValues:{question_text:"",question_type:"text_mcq",category:"General",difficulty:"medium",points:10,status:"draft",options:["","","",""],correct_answer:"",explanation:"",image_url:""}}),{fields:y,append:m,remove:v}=Ae({control:r.control,name:"options"});o.useEffect(()=>{a&&r.reset({question_text:a.question_text,question_type:a.question_type,category:a.category,difficulty:a.difficulty,points:a.points,status:a.status,options:a.options||[],correct_answer:a.correct_answer,explanation:a.explanation||"",image_url:a.image_url||""})},[a,r]);const b=async l=>{try{a?(await n(a.id,l),d.success("Question updated successfully")):(await f(l),d.success("Question created successfully")),p()}catch(i){console.error(i),d.error("Failed to save question")}},s=r.watch("question_type");return e.jsxs("form",{onSubmit:r.handleSubmit(b),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Question Type"}),e.jsxs("select",{...r.register("question_type"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"text_mcq",children:"Multiple Choice"}),e.jsx("option",{value:"image_identify_logo",children:"Logo Identification"}),e.jsx("option",{value:"image_identify_person",children:"Person Identification"}),e.jsx("option",{value:"true_false",children:"True/False"}),e.jsx("option",{value:"short_answer",children:"Short Answer"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Category"}),e.jsx("input",{...r.register("category"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"e.g. Science, History"}),r.formState.errors.category&&e.jsx("p",{className:"text-xs text-red-500",children:r.formState.errors.category.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Difficulty"}),e.jsxs("select",{...r.register("difficulty"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"hard",children:"Hard"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Points"}),e.jsx("input",{type:"number",...r.register("points",{valueAsNumber:!0}),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Status"}),e.jsxs("select",{...r.register("status"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Question Text"}),e.jsx("textarea",{...r.register("question_text"),rows:3,className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Enter the question here..."}),r.formState.errors.question_text&&e.jsx("p",{className:"text-xs text-red-500",children:r.formState.errors.question_text.message})]}),(s==="image_identify_logo"||s==="image_identify_person")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Image"}),e.jsx("div",{className:"flex gap-4 items-start",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{...r.register("image_url"),className:"flex-1 p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"https://... or select from library"}),e.jsx("button",{type:"button",onClick:()=>g(!0),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300",children:e.jsx(ye,{className:"w-4 h-4"})})]}),r.watch("image_url")&&e.jsxs("div",{className:"mt-2 relative w-fit group",children:[e.jsx("img",{src:r.watch("image_url")||"",alt:"Preview",className:"h-32 object-contain rounded border bg-gray-50 dark:bg-gray-800"}),e.jsx("button",{type:"button",onClick:()=>r.setValue("image_url",""),className:"absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(be,{className:"w-3 h-3"})})]})]})})]}),e.jsx(P,{open:h,onClose:()=>g(!1),title:"Select Media",className:"max-w-3xl",children:e.jsx(De,{onSelect:l=>{r.setValue("image_url",l),g(!1)},onCancel:()=>g(!1)})}),(s==="text_mcq"||s==="image_identify_logo"||s==="image_identify_person")&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Options"}),e.jsxs("button",{type:"button",onClick:()=>m(""),className:"text-sm text-indigo-600 hover:text-indigo-700 flex items-center gap-1",children:[e.jsx(K,{className:"w-4 h-4"})," Add Option"]})]}),e.jsx("div",{className:"space-y-2",children:y.map((l,i)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{...r.register(`options.${i}`),className:"flex-1 p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:`Option ${i+1}`}),e.jsx("button",{type:"button",onClick:()=>v(i),className:"p-2 text-red-500 hover:bg-red-50 rounded",children:e.jsx(L,{className:"w-4 h-4"})})]},l.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Correct Answer"}),s==="true_false"?e.jsxs("select",{...r.register("correct_answer"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"Select Answer"}),e.jsx("option",{value:"True",children:"True"}),e.jsx("option",{value:"False",children:"False"})]}):s==="text_mcq"||s==="image_identify_logo"||s==="image_identify_person"?e.jsxs("select",{...r.register("correct_answer"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"Select Correct Option"}),r.watch("options")?.map((l,i)=>l&&e.jsx("option",{value:l,children:l},i))]}):e.jsx("input",{...r.register("correct_answer"),className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Enter correct answer"}),r.formState.errors.correct_answer&&e.jsx("p",{className:"text-xs text-red-500",children:r.formState.errors.correct_answer.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Explanation (Optional)"}),e.jsx("textarea",{...r.register("explanation"),rows:2,className:"w-full p-2 border rounded-lg text-gray-900 bg-white border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Explain why this is the correct answer..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:u,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:j,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:[j?e.jsx(O,{className:"w-4 h-4 animate-spin"}):e.jsx(fe,{className:"w-4 h-4"}),"Save Question"]})]})]})}function Te({onGenerate:a,onCancel:p}){const{generateQuestions:u,isLoading:f}=G(),n=ae({resolver:se(qe),defaultValues:{topic:"",count:5,difficulty:"medium",type:"text_mcq"}}),j=async h=>{try{await u(h),d.success("Questions generated successfully! Check the Drafts tab."),a()}catch(g){console.error(g),d.error(g.message||"Failed to generate questions. Please try again.")}};return e.jsxs("form",{onSubmit:n.handleSubmit(j),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg text-sm text-purple-800 dark:text-purple-200",children:[e.jsxs("p",{className:"flex items-center gap-2 font-medium",children:[e.jsx($,{className:"w-4 h-4"})," AI Generation"]}),e.jsxs("p",{className:"mt-1 opacity-90",children:["Generated questions will be saved as ",e.jsx("strong",{children:"Drafts"}),". You can review and activate them later."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Topic / Subject"}),e.jsx("input",{...n.register("topic"),className:"w-full p-2 border rounded-lg text-gray-900 dark:text-gray-100 dark:bg-gray-700 dark:border-gray-600",placeholder:"e.g. Solar System, World War II, Python Programming"}),n.formState.errors.topic&&e.jsx("p",{className:"text-xs text-red-500",children:n.formState.errors.topic.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Number of Questions"}),e.jsx("input",{type:"number",...n.register("count",{valueAsNumber:!0}),className:"w-full p-2 border rounded-lg text-gray-900 dark:text-gray-100 dark:bg-gray-700 dark:border-gray-600",min:1,max:50}),n.formState.errors.count&&e.jsx("p",{className:"text-xs text-red-500",children:n.formState.errors.count.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Difficulty"}),e.jsxs("select",{...n.register("difficulty"),className:"w-full p-2 border rounded-lg text-gray-900 dark:text-gray-100 dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"hard",children:"Hard"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Question Type"}),e.jsxs("select",{...n.register("type"),className:"w-full p-2 border rounded-lg text-gray-900 dark:text-gray-100 dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"text_mcq",children:"Multiple Choice"}),e.jsx("option",{value:"image_identify_logo",children:"Logo Identification"}),e.jsx("option",{value:"image_identify_person",children:"Person Identification"}),e.jsx("option",{value:"true_false",children:"True/False"}),e.jsx("option",{value:"short_answer",children:"Short Answer"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:p,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:f,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[f?e.jsx(O,{className:"w-4 h-4 animate-spin"}):e.jsx($,{className:"w-4 h-4"}),"Generate"]})]})]})}function Me({onImportComplete:a,onCancel:p}){const[u,f]=o.useState(null),[n,j]=o.useState(!0),[h,g]=o.useState(!1),[r,y]=o.useState(null),m=s=>{const l=s.target.files?.[0];if(l){if(l.type!=="application/json"){d.error("Please select a JSON file");return}f(l),y(null)}},v=async()=>{if(!u){d.error("Please select a file");return}g(!0),y(null);try{const s=await u.text(),l=JSON.parse(s);if(!Array.isArray(l)){d.error("JSON file must contain an array of questions"),g(!1);return}const i=await pe.post("/questions/import.php",{questions:l,skipDuplicates:n});y(i.data),i.data.imported>0?(d.success(`Successfully imported ${i.data.imported} questions!`),i.data.skipped>0&&d.info(`Skipped ${i.data.skipped} duplicate questions`)):d.warning("No questions were imported"),i.data.errors.length>0&&console.error("Import errors:",i.data.errors)}catch(s){console.error("Import error:",s);let l="Failed to import questions";if(he.isAxiosError(s))if(s.response){const i=s.response.data;i.error&&(l=i.error),(i.imported>0||i.skipped>0)&&(y({imported:i.imported||0,skipped:i.skipped||0,errors:i.errors||[],total_processed:i.total_processed||0}),i.imported>0&&d.success(`Partially imported ${i.imported} questions`)),console.error("Server error:",i)}else s.request?(l="No response from server. Check your connection.",console.error("No response:",s.request)):l=s.message;else s instanceof Error&&(l=s.message);d.error(l)}finally{g(!1)}},b=()=>{r&&r.imported>0?a():p()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center",children:[e.jsx(je,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("span",{className:"text-indigo-600 hover:text-indigo-700 font-medium",children:"Choose a JSON file"}),e.jsx("input",{type:"file",accept:".json",onChange:m,className:"hidden"})]}),u&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["Selected: ",u.name]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"skipDuplicates",checked:n,onChange:s=>j(s.target.checked),className:"rounded border-gray-300"}),e.jsx("label",{htmlFor:"skipDuplicates",className:"text-sm text-gray-700 dark:text-gray-300",children:"Skip duplicate questions (based on question text)"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2 flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),"Expected JSON Format"]}),e.jsx("pre",{className:"text-xs bg-white dark:bg-gray-800 p-3 rounded overflow-x-auto",children:`[
  {
    "type": "text_mcq",
    "category": "Fundamentals",
    "difficulty": "easy",
    "question": "What is AI?",
    "options": ["Option 1", "Option 2", "Option 3", "Option 4"],
    "correct_answer": "Option 1",
    "image_url": "optional",
    "explanation": "optional"
  }
]`})]})]}),r&&e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:[e.jsx(Ne,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Imported: ",r.imported," questions"]})]}),r.skipped>0&&e.jsxs("div",{className:"flex items-center gap-2 text-yellow-600 dark:text-yellow-400",children:[e.jsx(H,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Skipped: ",r.skipped," duplicates"]})]}),r.errors.length>0&&e.jsxs("div",{className:"flex items-start gap-2 text-red-600 dark:text-red-400",children:[e.jsx(ee,{className:"w-5 h-5 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-medium block mb-1",children:["Errors: ",r.errors.length]}),e.jsx("div",{className:"text-sm space-y-1 max-h-40 overflow-y-auto",children:r.errors.map((s,l)=>e.jsxs("div",{className:"text-xs",children:["â€¢ ",s]},l))})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 pt-2 border-t border-gray-200 dark:border-gray-600",children:["Total processed: ",r.total_processed]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:b,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:r&&r.imported>0?"Close":"Cancel"}),e.jsxs("button",{onClick:v,disabled:!u||h,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Y,{className:"w-4 h-4"}),h?"Importing...":"Import Questions"]})]})]})}function Ue(){const{fetchQuestions:a,deleteQuestion:p,updateQuestion:u,isLoading:f}=G(),[n,j]=o.useState([]),[h,g]=o.useState(0),[r,y]=o.useState(1),[m]=o.useState(50),[v,b]=o.useState(""),[s,l]=o.useState(""),[i,R]=o.useState(""),[S,c]=o.useState(""),[N,C]=o.useState(""),[I,ie]=o.useState(void 0),[J,le]=o.useState("created_at"),[z,B]=o.useState("desc"),[w,T]=o.useState(new Set),[oe,q]=o.useState(!1),[de,M]=o.useState(!1),[ne,E]=o.useState(!1),[W,V]=o.useState(void 0),k=o.useCallback(async()=>{try{const t=(r-1)*m,{questions:x,total:me}=await a({search:v,category:s||void 0,difficulty:i||void 0,type:S||void 0,status:N||void 0,ai_generated:I,limit:m,offset:t,sortBy:J,sortOrder:z});j(x),g(me)}catch(t){console.error(t),d.error("Failed to load questions")}},[r,m,v,s,i,S,N,I,J,z,a]);o.useEffect(()=>{const t=setTimeout(()=>{k()},300);return()=>clearTimeout(t)},[k]);const A=t=>{J===t?B(z==="asc"?"desc":"asc"):(le(t),B("asc"))},ce=async t=>{if(confirm("Are you sure you want to delete this question?"))try{await p(t),d.success("Question deleted"),k()}catch(x){console.error(x),d.error("Failed to delete question")}},ge=async t=>{try{await u(t.id,{is_demo:!t.is_demo}),d.success(`Question ${t.is_demo?"removed from":"added to"} Demo`),k()}catch(x){console.error(x),d.error("Failed to update question")}},U=async t=>{if(w.size!==0&&!(t==="delete"&&!confirm(`Delete ${w.size} questions?`)))try{await Promise.all(Array.from(w).map(x=>t==="delete"?p(x):u(x,{status:t==="activate"?"active":"inactive"}))),d.success("Bulk action completed"),T(new Set),k()}catch(x){console.error(x),d.error("Failed to perform bulk action")}},xe=t=>{const x=new Set(w);x.has(t)?x.delete(t):x.add(t),T(x)},ue=()=>{w.size===n.length?T(new Set):T(new Set(n.map(t=>t.id)))};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Question Bank"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>k(),className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",title:"Refresh List",children:e.jsx(ve,{className:`w-4 h-4 ${f?"animate-spin":""}`})}),e.jsxs("button",{onClick:()=>E(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(X,{className:"w-4 h-4"})," Import JSON"]}),e.jsxs("button",{onClick:()=>M(!0),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[e.jsx($,{className:"w-4 h-4"})," AI Generate"]}),e.jsxs("button",{onClick:()=>{V(void 0),q(!0)},className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:[e.jsx(K,{className:"w-4 h-4"})," Add Question"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search questions...",value:v,onChange:t=>b(t.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg text-gray-900 bg-white border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"})]}),e.jsx("input",{type:"text",placeholder:"Filter by Category",value:s,onChange:t=>l(t.target.value),className:"w-full px-4 py-2 border rounded-lg text-gray-900 bg-white border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"}),e.jsxs("select",{value:S,onChange:t=>c(t.target.value),className:"w-full px-4 py-2 border rounded-lg text-gray-900 bg-white border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"text_mcq",children:"Multiple Choice"}),e.jsx("option",{value:"image_identify_logo",children:"Logo ID"}),e.jsx("option",{value:"image_identify_person",children:"Person ID"}),e.jsx("option",{value:"true_false",children:"True/False"})]}),e.jsxs("select",{value:i,onChange:t=>R(t.target.value),className:"w-full px-4 py-2 border rounded-lg text-gray-900 bg-white border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"All Difficulties"}),e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"hard",children:"Hard"})]}),e.jsxs("select",{value:N,onChange:t=>C(t.target.value),className:"w-full px-4 py-2 border rounded-lg text-gray-900 bg-white border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"draft",children:"Draft"})]}),e.jsxs("select",{value:I===void 0?"":I.toString(),onChange:t=>ie(t.target.value===""?void 0:t.target.value==="true"),className:"w-full px-4 py-2 border rounded-lg text-gray-900 bg-white border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"All Sources"}),e.jsx("option",{value:"true",children:"AI Generated"}),e.jsx("option",{value:"false",children:"Manual"})]})]})}),w.size>0&&e.jsxs("div",{className:"flex gap-2 pt-2 border-t dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>U("activate"),className:"flex items-center gap-2 px-3 py-1.5 bg-green-100 text-green-700 rounded hover:bg-green-200 text-sm",children:[e.jsx(ke,{className:"w-4 h-4"})," Activate Selected"]}),e.jsxs("button",{onClick:()=>U("deactivate"),className:"flex items-center gap-2 px-3 py-1.5 bg-yellow-100 text-yellow-700 rounded hover:bg-yellow-200 text-sm",children:[e.jsx(ee,{className:"w-4 h-4"})," Deactivate Selected"]}),e.jsxs("button",{onClick:()=>U("delete"),className:"flex items-center gap-2 px-3 py-1.5 bg-red-100 text-red-700 rounded hover:bg-red-200 text-sm",children:[e.jsx(L,{className:"w-4 h-4"})," Delete Selected"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 w-4",children:e.jsx("input",{type:"checkbox",checked:w.size===n.length&&n.length>0,onChange:ue,className:"rounded border-gray-300"})}),e.jsx("th",{className:"p-4 w-10"})," ",e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>A("question_text"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Question ",e.jsx(Q,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 w-10 text-center",children:"Demo"}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>A("question_type"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Type ",e.jsx(Q,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>A("category"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Category ",e.jsx(Q,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>A("difficulty"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Difficulty ",e.jsx(Q,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>A("points"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Pts ",e.jsx(Q,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>A("status"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Status ",e.jsx(Q,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:f?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"p-8 text-center",children:e.jsx(O,{className:"w-8 h-8 animate-spin mx-auto text-indigo-600"})})}):n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"p-8 text-center text-gray-500 dark:text-gray-400",children:"No questions found"})}):n.map(t=>e.jsxs("tr",{className:F("hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",t.status==="inactive"&&"opacity-60 bg-gray-50/50 dark:bg-gray-800/50 grayscale-[0.5]"),children:[e.jsx("td",{className:"p-4",children:e.jsx("input",{type:"checkbox",checked:w.has(t.id),onChange:()=>xe(t.id),className:"rounded border-gray-300"})}),e.jsx("td",{className:"p-4",children:t.image_url?e.jsx("img",{src:t.image_url,alt:"Q",className:"w-16 h-16 object-cover rounded border border-gray-200 dark:border-gray-700 bg-white"}):t.media_id&&e.jsx("div",{className:"w-10 h-10 rounded bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-500 dark:text-gray-400",children:e.jsx(X,{className:"w-5 h-5"})})}),e.jsxs("td",{className:"p-4 max-w-md group",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"truncate font-medium text-gray-900 dark:text-gray-100",title:t.question_text,children:t.question_text}),e.jsx("button",{onClick:()=>{V(t),q(!0)},className:"p-1 text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 opacity-0 group-hover:opacity-100 transition-opacity",title:"Edit Question",children:e.jsx(we,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5 truncate",title:t.correct_answer,children:["Ans: ",t.correct_answer]})]}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("button",{onClick:()=>ge(t),className:F("p-1 rounded-full transition-colors",t.is_demo?"text-yellow-400 hover:text-yellow-500 bg-yellow-400/10":"text-gray-300 hover:text-yellow-400 dark:text-gray-600 dark:hover:text-yellow-400"),title:t.is_demo?"Remove from Demo":"Add to Demo",children:e.jsx(_e,{className:F("w-4 h-4",t.is_demo&&"fill-current")})})}),e.jsx("td",{className:"p-4 capitalize text-sm text-gray-700 dark:text-gray-300",children:t.question_type.replace(/_/g," ")}),e.jsx("td",{className:"p-4 text-sm text-gray-700 dark:text-gray-300",children:t.category}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:F("px-2 py-1 rounded-full text-xs font-medium capitalize",t.difficulty==="easy"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":t.difficulty==="medium"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"),children:t.difficulty})}),e.jsx("td",{className:"p-4 text-sm font-medium text-gray-700 dark:text-gray-300",children:t.points}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:F("px-2 py-1 rounded-full text-xs font-medium capitalize",t.status==="active"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":t.status==="inactive"?"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"),children:t.status})}),e.jsx("td",{className:"p-4 text-right",children:e.jsx("button",{onClick:()=>ce(t.id),className:"p-1 text-gray-500 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors",title:"Delete",children:e.jsx(L,{className:"w-4 h-4"})})})]},t.id))})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Showing ",(r-1)*m+1," to ",Math.min(r*m,h)," of ",h," questions"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y(t=>Math.max(1,t-1)),disabled:r===1,className:"p-2 border rounded hover:bg-gray-50 disabled:opacity-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",children:e.jsx(Se,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>y(t=>t+1),disabled:r*m>=h,className:"p-2 border rounded hover:bg-gray-50 disabled:opacity-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",children:e.jsx(Ce,{className:"w-4 h-4"})})]})]})]}),e.jsx(P,{open:oe,onClose:()=>q(!1),title:W?"Edit Question":"Create Question",className:"max-w-4xl",children:e.jsx(Oe,{question:W,onSave:async()=>{q(!1),k()},onCancel:()=>q(!1)})}),e.jsx(P,{open:de,onClose:()=>M(!1),title:"AI Question Generator",className:"max-w-2xl",children:e.jsx(Te,{onGenerate:async()=>{M(!1),k()},onCancel:()=>M(!1)})}),e.jsx(P,{open:ne,onClose:()=>E(!1),title:"Import Questions from JSON",className:"max-w-3xl",children:e.jsx(Me,{onImportComplete:()=>{E(!1),k()},onCancel:()=>E(!1)})})]})}export{Ue as Questions};
