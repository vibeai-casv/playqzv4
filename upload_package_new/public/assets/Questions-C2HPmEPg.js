import{j as e,c as U,d as W}from"./index-CtFufLgh.js";import{r as t}from"./vendor-D8AvkUoV.js";import{u as L}from"./useAdmin-C3pbjvpL.js";import{M as E}from"./Modal-B8ICJ_zh.js";import{V as Y,e as F,a0 as K,a1 as P,g as n,I as me,X as ge,a2 as Z,G as he,a3 as G,a4 as ye,p as X,j as fe,r as ee,a5 as be,q as je,$ as A,a6 as Ne,x as ve,n as we}from"./ui-CX4g-7i5.js";import{o as se,s as S,c as ke,_ as Q,n as ae,l as Se,u as te,a as re,d as _e}from"./schemas-BznUp_a-.js";const Ce=se({question_text:S().min(3,"Question text must be at least 3 characters"),question_type:Q(["text_mcq","image_identify_logo","image_identify_person","true_false","short_answer"]),category:S().min(1,"Category is required"),difficulty:Q(["easy","medium","hard"]),points:ae().min(1,"Points must be at least 1"),status:Q(["active","inactive","draft"]),options:ke(S()).default([]),correct_answer:S().min(1,"Correct answer is required"),explanation:S().optional(),image_url:S().url().optional().or(Se(""))}),Ie=se({topic:S().min(3,"Topic is required"),count:ae().min(1).max(50),difficulty:Q(["easy","medium","hard"]),type:Q(["text_mcq","image_identify_logo","image_identify_person","true_false","short_answer"])});function Ae({onSelect:i,onCancel:f}){const{fetchMedia:x,uploadMedia:b,deleteMedia:o,isLoading:j}=L(),[g,u]=t.useState([]),[a,y]=t.useState(!1),[p,v]=t.useState(""),[h,r]=t.useState("all"),l=async()=>{try{const{media:d}=await x({type:h==="all"?void 0:h});u(d)}catch(d){console.error(d),n.error("Failed to load media")}};t.useEffect(()=>{l()},[h]);const c=async d=>{const N=d.target.files?.[0];if(N){y(!0);try{await b(N,h==="all"?"logo":h),n.success("File uploaded successfully"),l()}catch(C){console.error(C),n.error("Failed to upload file")}finally{y(!1)}}},z=async(d,N)=>{if(d.stopPropagation(),!!confirm("Are you sure you want to delete this image?"))try{await o(N),n.success("Image deleted successfully"),l()}catch(C){console.error(C),n.error("Failed to delete image")}},_=g.filter(d=>d.filename.toLowerCase().includes(p.toLowerCase()));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search media...",value:p,onChange:d=>v(d.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"})]}),e.jsxs("select",{value:h,onChange:d=>r(d.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"logo",children:"Logos"}),e.jsx("option",{value:"personality",children:"Personalities"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",id:"modal-file-upload",className:"hidden",accept:"image/*",onChange:c,disabled:a}),e.jsxs("label",{htmlFor:"modal-file-upload",className:U("flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 cursor-pointer",a&&"opacity-50 cursor-not-allowed"),children:[a?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(K,{className:"w-4 h-4"}),"Upload"]})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 max-h-[400px] overflow-y-auto p-1",children:j?e.jsx("div",{className:"col-span-full flex justify-center py-8",children:e.jsx(F,{className:"w-8 h-8 animate-spin text-indigo-600"})}):_.length===0?e.jsx("div",{className:"col-span-full text-center py-8 text-gray-500",children:"No media found"}):_.map(d=>e.jsxs("div",{className:"group relative aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden border hover:border-indigo-500 cursor-pointer",onClick:()=>i(d.url),children:[e.jsx("img",{src:d.url,alt:d.filename,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-white font-medium bg-indigo-600 px-3 py-1 rounded-full text-sm",children:"Select"}),e.jsx("button",{onClick:N=>z(N,d.id),className:"p-2 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors",title:"Delete image",children:e.jsx(P,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 p-2 text-xs text-white truncate",children:d.filename})]},d.id))}),e.jsx("div",{className:"flex justify-end pt-4 border-t dark:border-gray-700",children:e.jsx("button",{onClick:f,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300",children:"Cancel"})})]})}function qe({question:i,onSave:f,onCancel:x}){const{createQuestion:b,updateQuestion:o,isLoading:j}=L(),[g,u]=t.useState(!1),a=te({resolver:re(Ce),defaultValues:{question_text:"",question_type:"text_mcq",category:"General",difficulty:"medium",points:10,status:"draft",options:["","","",""],correct_answer:"",explanation:"",image_url:""}}),{fields:y,append:p,remove:v}=_e({control:a.control,name:"options"});t.useEffect(()=>{i&&a.reset({question_text:i.question_text,question_type:i.question_type,category:i.category,difficulty:i.difficulty,points:i.points,status:i.status,options:i.options||[],correct_answer:i.correct_answer,explanation:i.explanation||"",image_url:i.image_url||""})},[i,a]);const h=async l=>{try{i?(await o(i.id,l),n.success("Question updated successfully")):(await b(l),n.success("Question created successfully")),f()}catch(c){console.error(c),n.error("Failed to save question")}},r=a.watch("question_type");return e.jsxs("form",{onSubmit:a.handleSubmit(h),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Question Type"}),e.jsxs("select",{...a.register("question_type"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"text_mcq",children:"Multiple Choice"}),e.jsx("option",{value:"image_identify_logo",children:"Logo Identification"}),e.jsx("option",{value:"image_identify_person",children:"Person Identification"}),e.jsx("option",{value:"true_false",children:"True/False"}),e.jsx("option",{value:"short_answer",children:"Short Answer"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Category"}),e.jsx("input",{...a.register("category"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:"e.g. Science, History"}),a.formState.errors.category&&e.jsx("p",{className:"text-xs text-red-500",children:a.formState.errors.category.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Difficulty"}),e.jsxs("select",{...a.register("difficulty"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"hard",children:"Hard"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Points"}),e.jsx("input",{type:"number",...a.register("points",{valueAsNumber:!0}),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs("select",{...a.register("status"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Question Text"}),e.jsx("textarea",{...a.register("question_text"),rows:3,className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:"Enter the question here..."}),a.formState.errors.question_text&&e.jsx("p",{className:"text-xs text-red-500",children:a.formState.errors.question_text.message})]}),(r==="image_identify_logo"||r==="image_identify_person")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Image"}),e.jsx("div",{className:"flex gap-4 items-start",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{...a.register("image_url"),className:"flex-1 p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:"https://... or select from library"}),e.jsx("button",{type:"button",onClick:()=>u(!0),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300",children:e.jsx(me,{className:"w-4 h-4"})})]}),a.watch("image_url")&&e.jsxs("div",{className:"mt-2 relative w-fit group",children:[e.jsx("img",{src:a.watch("image_url")||"",alt:"Preview",className:"h-32 object-contain rounded border bg-gray-50 dark:bg-gray-800"}),e.jsx("button",{type:"button",onClick:()=>a.setValue("image_url",""),className:"absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ge,{className:"w-3 h-3"})})]})]})})]}),e.jsx(E,{open:g,onClose:()=>u(!1),title:"Select Media",className:"max-w-3xl",children:e.jsx(Ae,{onSelect:l=>{a.setValue("image_url",l),u(!1)},onCancel:()=>u(!1)})}),(r==="text_mcq"||r==="image_identify_logo"||r==="image_identify_person")&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm font-medium",children:"Options"}),e.jsxs("button",{type:"button",onClick:()=>p(""),className:"text-sm text-indigo-600 hover:text-indigo-700 flex items-center gap-1",children:[e.jsx(Z,{className:"w-4 h-4"})," Add Option"]})]}),e.jsx("div",{className:"space-y-2",children:y.map((l,c)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{...a.register(`options.${c}`),className:"flex-1 p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:`Option ${c+1}`}),e.jsx("button",{type:"button",onClick:()=>v(c),className:"p-2 text-red-500 hover:bg-red-50 rounded",children:e.jsx(P,{className:"w-4 h-4"})})]},l.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Correct Answer"}),r==="true_false"?e.jsxs("select",{...a.register("correct_answer"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"",children:"Select Answer"}),e.jsx("option",{value:"True",children:"True"}),e.jsx("option",{value:"False",children:"False"})]}):r==="text_mcq"||r==="image_identify_logo"||r==="image_identify_person"?e.jsxs("select",{...a.register("correct_answer"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"",children:"Select Correct Option"}),a.watch("options")?.map((l,c)=>l&&e.jsx("option",{value:l,children:l},c))]}):e.jsx("input",{...a.register("correct_answer"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:"Enter correct answer"}),a.formState.errors.correct_answer&&e.jsx("p",{className:"text-xs text-red-500",children:a.formState.errors.correct_answer.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Explanation (Optional)"}),e.jsx("textarea",{...a.register("explanation"),rows:2,className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:"Explain why this is the correct answer..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:j,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:[j?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(he,{className:"w-4 h-4"}),"Save Question"]})]})]})}function Qe({onGenerate:i,onCancel:f}){const{generateQuestions:x,isLoading:b}=L(),o=te({resolver:re(Ie),defaultValues:{topic:"",count:5,difficulty:"medium",type:"text_mcq"}}),j=async g=>{try{await x(g),n.success("Questions generated successfully! Check the Drafts tab."),i()}catch(u){console.error(u),n.error("Failed to generate questions. Please try again.")}};return e.jsxs("form",{onSubmit:o.handleSubmit(j),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg text-sm text-purple-800 dark:text-purple-200",children:[e.jsxs("p",{className:"flex items-center gap-2 font-medium",children:[e.jsx(G,{className:"w-4 h-4"})," AI Generation"]}),e.jsxs("p",{className:"mt-1 opacity-90",children:["Generated questions will be saved as ",e.jsx("strong",{children:"Drafts"}),". You can review and activate them later."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Topic / Subject"}),e.jsx("input",{...o.register("topic"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:"e.g. Solar System, World War II, Python Programming"}),o.formState.errors.topic&&e.jsx("p",{className:"text-xs text-red-500",children:o.formState.errors.topic.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Number of Questions"}),e.jsx("input",{type:"number",...o.register("count",{valueAsNumber:!0}),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",min:1,max:50}),o.formState.errors.count&&e.jsx("p",{className:"text-xs text-red-500",children:o.formState.errors.count.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Difficulty"}),e.jsxs("select",{...o.register("difficulty"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"hard",children:"Hard"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Question Type"}),e.jsxs("select",{...o.register("type"),className:"w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"text_mcq",children:"Multiple Choice"}),e.jsx("option",{value:"image_identify_logo",children:"Logo Identification"}),e.jsx("option",{value:"image_identify_person",children:"Person Identification"}),e.jsx("option",{value:"true_false",children:"True/False"}),e.jsx("option",{value:"short_answer",children:"Short Answer"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:b,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[b?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(G,{className:"w-4 h-4"}),"Generate"]})]})]})}function Fe({onImportComplete:i,onCancel:f}){const[x,b]=t.useState(null),[o,j]=t.useState(!0),[g,u]=t.useState(!1),[a,y]=t.useState(null),p=r=>{const l=r.target.files?.[0];if(l){if(l.type!=="application/json"){n.error("Please select a JSON file");return}b(l),y(null)}},v=async()=>{if(!x){n.error("Please select a file");return}u(!0),y(null);try{const r=await x.text(),l=JSON.parse(r);if(!Array.isArray(l)){n.error("JSON file must contain an array of questions"),u(!1);return}const c=await W.post("https://aiquiz.vibeai.cv/api/questions/import.php",{questions:l,skipDuplicates:o},{withCredentials:!0});y(c.data),c.data.imported>0?(n.success(`Successfully imported ${c.data.imported} questions!`),c.data.skipped>0&&n.info(`Skipped ${c.data.skipped} duplicate questions`)):n.warning("No questions were imported"),c.data.errors.length>0&&console.error("Import errors:",c.data.errors)}catch(r){console.error("Import error:",r),W.isAxiosError(r)&&r.response?n.error(r.response.data.error||"Failed to import questions"):n.error("Failed to import questions")}finally{u(!1)}},h=()=>{a&&a.imported>0?i():f()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center",children:[e.jsx(ye,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("span",{className:"text-indigo-600 hover:text-indigo-700 font-medium",children:"Choose a JSON file"}),e.jsx("input",{type:"file",accept:".json",onChange:p,className:"hidden"})]}),x&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["Selected: ",x.name]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"skipDuplicates",checked:o,onChange:r=>j(r.target.checked),className:"rounded border-gray-300"}),e.jsx("label",{htmlFor:"skipDuplicates",className:"text-sm text-gray-700 dark:text-gray-300",children:"Skip duplicate questions (based on question text)"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2 flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Expected JSON Format"]}),e.jsx("pre",{className:"text-xs bg-white dark:bg-gray-800 p-3 rounded overflow-x-auto",children:`[
  {
    "type": "text_mcq",
    "category": "Fundamentals",
    "difficulty": "easy",
    "question": "What is AI?",
    "options": ["Option 1", "Option 2", "Option 3", "Option 4"],
    "correct_answer": "Option 1",
    "image_url": "optional",
    "explanation": "optional"
  }
]`})]})]}),a&&e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:[e.jsx(fe,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Imported: ",a.imported," questions"]})]}),a.skipped>0&&e.jsxs("div",{className:"flex items-center gap-2 text-yellow-600 dark:text-yellow-400",children:[e.jsx(X,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Skipped: ",a.skipped," duplicates"]})]}),a.errors.length>0&&e.jsxs("div",{className:"flex items-start gap-2 text-red-600 dark:text-red-400",children:[e.jsx(ee,{className:"w-5 h-5 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-medium block mb-1",children:["Errors: ",a.errors.length]}),e.jsx("div",{className:"text-sm space-y-1 max-h-40 overflow-y-auto",children:a.errors.map((r,l)=>e.jsxs("div",{className:"text-xs",children:["â€¢ ",r]},l))})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 pt-2 border-t border-gray-200 dark:border-gray-600",children:["Total processed: ",a.total_processed]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:h,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:a&&a.imported>0?"Close":"Cancel"}),e.jsxs("button",{onClick:v,disabled:!x||g,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(K,{className:"w-4 h-4"}),g?"Importing...":"Import Questions"]})]})]})}function Ge(){const{fetchQuestions:i,deleteQuestion:f,updateQuestion:x,isLoading:b}=L(),[o,j]=t.useState([]),[g,u]=t.useState(0),[a,y]=t.useState(1),[p]=t.useState(20),[v,h]=t.useState(""),[r,l]=t.useState(""),[c,z]=t.useState(""),[_,d]=t.useState(""),[N,C]=t.useState(""),[O,le]=t.useState(void 0),[J,ie]=t.useState("created_at"),[B,V]=t.useState("desc"),[w,T]=t.useState(new Set),[oe,q]=t.useState(!1),[ne,D]=t.useState(!1),[de,M]=t.useState(!1),[H,R]=t.useState(void 0),k=t.useCallback(async()=>{try{const s=(a-1)*p,{questions:m,total:pe}=await i({search:v,category:r||void 0,difficulty:c||void 0,type:_||void 0,status:N||void 0,ai_generated:O,limit:p,offset:s,sortBy:J,sortOrder:B});j(m),u(pe)}catch(s){console.error(s),n.error("Failed to load questions")}},[a,p,v,r,c,_,N,O,J,B,i]);t.useEffect(()=>{const s=setTimeout(()=>{k()},300);return()=>clearTimeout(s)},[k]);const I=s=>{J===s?V(B==="asc"?"desc":"asc"):(ie(s),V("asc"))},ce=async s=>{if(confirm("Are you sure you want to delete this question?"))try{await f(s),n.success("Question deleted"),k()}catch(m){console.error(m),n.error("Failed to delete question")}},$=async s=>{if(w.size!==0&&!(s==="delete"&&!confirm(`Delete ${w.size} questions?`)))try{await Promise.all(Array.from(w).map(m=>s==="delete"?f(m):x(m,{status:s==="activate"?"active":"inactive"}))),n.success("Bulk action completed"),T(new Set),k()}catch(m){console.error(m),n.error("Failed to perform bulk action")}},ue=s=>{const m=new Set(w);m.has(s)?m.delete(s):m.add(s),T(m)},xe=()=>{w.size===o.length?T(new Set):T(new Set(o.map(s=>s.id)))};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Question Bank"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>M(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(be,{className:"w-4 h-4"})," Import JSON"]}),e.jsxs("button",{onClick:()=>D(!0),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[e.jsx(G,{className:"w-4 h-4"})," AI Generate"]}),e.jsxs("button",{onClick:()=>{R(void 0),q(!0)},className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:[e.jsx(Z,{className:"w-4 h-4"})," Add Question"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-[200px] relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search questions...",value:v,onChange:s=>h(s.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"})]}),e.jsx("input",{type:"text",placeholder:"Filter by Category",value:r,onChange:s=>l(s.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"}),e.jsxs("select",{value:_,onChange:s=>d(s.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"text_mcq",children:"Multiple Choice"}),e.jsx("option",{value:"image_identify_logo",children:"Logo ID"}),e.jsx("option",{value:"image_identify_person",children:"Person ID"}),e.jsx("option",{value:"true_false",children:"True/False"})]}),e.jsxs("select",{value:c,onChange:s=>z(s.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"",children:"All Difficulties"}),e.jsx("option",{value:"easy",children:"Easy"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"hard",children:"Hard"})]}),e.jsxs("select",{value:N,onChange:s=>C(s.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"draft",children:"Draft"})]}),e.jsxs("select",{value:O===void 0?"":O.toString(),onChange:s=>le(s.target.value===""?void 0:s.target.value==="true"),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"",children:"All Sources"}),e.jsx("option",{value:"true",children:"AI Generated"}),e.jsx("option",{value:"false",children:"Manual"})]})]}),w.size>0&&e.jsxs("div",{className:"flex gap-2 pt-2 border-t dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>$("activate"),className:"flex items-center gap-2 px-3 py-1.5 bg-green-100 text-green-700 rounded hover:bg-green-200 text-sm",children:[e.jsx(je,{className:"w-4 h-4"})," Activate Selected"]}),e.jsxs("button",{onClick:()=>$("deactivate"),className:"flex items-center gap-2 px-3 py-1.5 bg-yellow-100 text-yellow-700 rounded hover:bg-yellow-200 text-sm",children:[e.jsx(ee,{className:"w-4 h-4"})," Deactivate Selected"]}),e.jsxs("button",{onClick:()=>$("delete"),className:"flex items-center gap-2 px-3 py-1.5 bg-red-100 text-red-700 rounded hover:bg-red-200 text-sm",children:[e.jsx(P,{className:"w-4 h-4"})," Delete Selected"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 w-4",children:e.jsx("input",{type:"checkbox",checked:w.size===o.length&&o.length>0,onChange:xe,className:"rounded border-gray-300"})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>I("question_text"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Question ",e.jsx(A,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>I("question_type"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Type ",e.jsx(A,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>I("category"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Category ",e.jsx(A,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>I("difficulty"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Difficulty ",e.jsx(A,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>I("status"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Status ",e.jsx(A,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>I("ai_generated"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Source ",e.jsx(A,{className:"w-4 h-4"})]})}),e.jsx("th",{className:"p-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:b?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"p-8 text-center",children:e.jsx(F,{className:"w-8 h-8 animate-spin mx-auto text-indigo-600"})})}):o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"p-8 text-center text-gray-500",children:"No questions found"})}):o.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"p-4",children:e.jsx("input",{type:"checkbox",checked:w.has(s.id),onChange:()=>ue(s.id),className:"rounded border-gray-300"})}),e.jsx("td",{className:"p-4 max-w-md truncate",title:s.question_text,children:s.question_text}),e.jsx("td",{className:"p-4 capitalize",children:s.question_type.replace(/_/g," ")}),e.jsx("td",{className:"p-4",children:s.category}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:U("px-2 py-1 rounded-full text-xs font-medium capitalize",s.difficulty==="easy"?"bg-green-100 text-green-700":s.difficulty==="medium"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"),children:s.difficulty})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:U("px-2 py-1 rounded-full text-xs font-medium capitalize",s.status==="active"?"bg-green-100 text-green-700":s.status==="inactive"?"bg-gray-100 text-gray-700":"bg-yellow-100 text-yellow-700"),children:s.status})}),e.jsx("td",{className:"p-4",children:s.ai_generated&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-purple-600 bg-purple-50 px-2 py-1 rounded-full w-fit",children:[e.jsx(G,{className:"w-3 h-3"})," AI"]})}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>{R(s),q(!0)},className:"p-1 text-gray-500 hover:text-indigo-600",children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ce(s.id),className:"p-1 text-gray-500 hover:text-red-600",children:e.jsx(P,{className:"w-4 h-4"})})]})})]},s.id))})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["Showing ",(a-1)*p+1," to ",Math.min(a*p,g)," of ",g," questions"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y(s=>Math.max(1,s-1)),disabled:a===1,className:"p-2 border rounded hover:bg-gray-50 disabled:opacity-50",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>y(s=>s+1),disabled:a*p>=g,className:"p-2 border rounded hover:bg-gray-50 disabled:opacity-50",children:e.jsx(we,{className:"w-4 h-4"})})]})]})]}),e.jsx(E,{open:oe,onClose:()=>q(!1),title:H?"Edit Question":"Create Question",className:"max-w-4xl",children:e.jsx(qe,{question:H,onSave:async()=>{q(!1),k()},onCancel:()=>q(!1)})}),e.jsx(E,{open:ne,onClose:()=>D(!1),title:"AI Question Generator",className:"max-w-2xl",children:e.jsx(Qe,{onGenerate:async()=>{D(!1),k()},onCancel:()=>D(!1)})}),e.jsx(E,{open:de,onClose:()=>M(!1),title:"Import Questions from JSON",className:"max-w-3xl",children:e.jsx(Fe,{onImportComplete:()=>{M(!1),k()},onCancel:()=>M(!1)})})]})}export{Ge as Questions};
