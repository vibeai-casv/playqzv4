import{j as e,c as n}from"./index-CtFufLgh.js";import{r as o,u as D}from"./vendor-D8AvkUoV.js";import{u as O}from"./quizStore-DfslfZDa.js";import{I as P,T as z,m as X,r as Y,q as v,x as $,n as B,e as G,X as H}from"./ui-CX4g-7i5.js";function K({className:l,src:x,alt:r,fallbackSrc:y,...b}){const[m,d]=o.useState(!0),[f,i]=o.useState(!1),u=()=>{d(!1)},h=()=>{d(!1),i(!0)};return f?e.jsx("div",{className:n("flex items-center justify-center bg-gray-100 text-gray-400",l),children:e.jsx(P,{className:"w-8 h-8"})}):e.jsxs("div",{className:n("relative overflow-hidden",l),children:[m&&e.jsx("div",{className:"absolute inset-0 bg-gray-200 animate-pulse"}),e.jsx("img",{src:x,alt:r,loading:"lazy",onLoad:u,onError:h,className:n("w-full h-full object-cover transition-opacity duration-300",m?"opacity-0":"opacity-100"),...b})]})}function N({open:l,onClose:x,children:r}){return l?e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 animate-in fade-in duration-200",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-2xl p-6 max-w-lg w-full relative shadow-2xl shadow-black/50 animate-in zoom-in-95 duration-200",children:[e.jsx("button",{onClick:x,className:"absolute top-4 right-4 text-slate-500 hover:text-white transition-colors","aria-label":"Close modal",children:e.jsx(H,{className:"w-5 h-5"})}),r]})}):null}function U(){const l=D(),{questions:x,currentQuestionIndex:r,responses:y,nextQuestion:b,previousQuestion:m,submitAnswer:d,submitQuiz:f,timeRemaining:i,setTimeRemaining:u,isLoading:h}=O(),[E,g]=o.useState(!1),[Q,w]=o.useState(!1),[L,k]=o.useState(!1),[C,I]=o.useState(""),s=x[r],p=x.length;o.useEffect(()=>{if(i<=0)return;const t=setInterval(()=>{u(a=>Math.max(a-1,0))},1e3);return()=>clearInterval(t)},[i,u]),o.useEffect(()=>{const t=a=>{a.preventDefault(),a.returnValue=""};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[]);const j=o.useCallback(t=>{if(!s)return;const a=parseInt(t.key,10);if(a>=1&&a<=4){const c=s.options?.[a-1];if(c){const T=performance.now();d(s.id,c,Math.round(performance.now()-T)/1e3)}}},[s,d]);o.useEffect(()=>(window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)),[j]);const M=o.useCallback(t=>{const a=performance.now();d(s.id,t,Math.round(performance.now()-a)/1e3)},[s,d]),_=t=>{I(t),k(!0)},R=async()=>{try{await f(),l("/dashboard")}catch(t){console.error(t)}},S=o.useRef(null);if(o.useEffect(()=>{S.current?.focus()},[r]),!s)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(z,{className:"w-12 h-12 text-amber-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No quiz loaded. Please start a quiz from the configuration page."}),e.jsx("button",{onClick:()=>l("/quiz-config"),className:"mt-4 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-500 transition-colors",children:"Go to Config"})]})});const q=y.get(s.id)?.user_answer,A=(r+1)/p*100;return e.jsxs("div",{className:"max-w-5xl mx-auto p-4 md:p-6 space-y-6",children:[e.jsxs("header",{className:"bg-slate-900/50 backdrop-blur-sm border border-white/5 p-4 rounded-2xl flex items-center justify-between sticky top-4 z-30 shadow-lg shadow-black/20",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-slate-400 uppercase tracking-wider font-bold",children:"Question"}),e.jsxs("span",{className:"text-xl font-bold text-white",children:[e.jsx("span",{className:"text-indigo-400",children:r+1}),e.jsx("span",{className:"text-slate-600 mx-1",children:"/"}),p]})]}),e.jsx("div",{className:"hidden md:block h-8 w-px bg-white/10"}),e.jsx("div",{className:"hidden md:block w-32 h-2 bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 rounded-full transition-all duration-500 ease-out",style:{width:`${A}%`}})})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[i>0&&e.jsxs("div",{className:n("flex items-center px-3 py-1.5 rounded-lg border transition-colors",i<60?"bg-red-500/10 border-red-500/30 text-red-400":"bg-slate-800 border-white/5 text-slate-300"),children:[e.jsx(X,{className:n("w-4 h-4 mr-2",i<60&&"animate-pulse")}),e.jsxs("span",{className:"font-mono font-bold",children:[Math.floor(i/60),":",String(i%60).padStart(2,"0")]})]}),e.jsx("button",{onClick:()=>g(!0),className:"p-2 text-slate-400 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",title:"Exit Quiz",children:e.jsx(Y,{className:"w-6 h-6"})})]})]}),e.jsxs("section",{className:"bg-slate-900/50 backdrop-blur-sm rounded-3xl border border-white/5 p-6 md:p-10 shadow-xl min-h-[400px] flex flex-col",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-white leading-tight mb-8",children:s.question_text}),s.image_url&&e.jsxs("div",{className:"mb-8 relative group w-full max-w-2xl mx-auto rounded-2xl overflow-hidden border border-white/10 bg-black/20 cursor-zoom-in",onClick:()=>_(s.image_url),children:[e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center",children:e.jsx("span",{className:"opacity-0 group-hover:opacity-100 text-white font-medium px-4 py-2 bg-black/50 rounded-full backdrop-blur-sm transition-opacity",children:"Click to zoom"})}),e.jsx(K,{src:s.image_url,alt:"Question illustration",className:"w-full h-auto max-h-96 object-contain"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.options?.map((t,a)=>{const c=q===t;return e.jsxs("button",{ref:a===0?S:void 0,onClick:()=>M(t),className:n("group relative p-5 rounded-xl text-left transition-all duration-200 border-2 outline-none",c?"bg-indigo-600/20 border-indigo-500 shadow-[0_0_15px_-3px_rgba(99,102,241,0.4)]":"bg-white/5 border-transparent hover:bg-white/10 hover:border-white/10"),children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:n("flex-shrink-0 w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold mr-4 transition-colors",c?"bg-indigo-500 text-white":"bg-white/10 text-slate-400 group-hover:bg-white/20 group-hover:text-white"),children:String.fromCharCode(65+a)}),e.jsx("span",{className:n("text-lg font-medium transition-colors",c?"text-white":"text-slate-300 group-hover:text-white"),children:t})]}),c&&e.jsx("div",{className:"absolute top-5 right-5",children:e.jsx(v,{className:"w-5 h-5 text-indigo-400"})})]},t)})})]}),e.jsxs("div",{className:"mt-10 pt-6 border-t border-white/5 flex items-center justify-between",children:[e.jsxs("button",{onClick:m,disabled:r===0,className:n("flex items-center px-6 py-3 rounded-xl font-medium transition-all",r===0?"text-slate-600 cursor-not-allowed":"text-slate-300 hover:text-white hover:bg-white/5"),children:[e.jsx($,{className:"w-5 h-5 mr-2"})," Previous"]}),r<p-1?e.jsxs("button",{onClick:b,className:"flex items-center px-8 py-3 rounded-xl bg-white text-indigo-950 font-bold hover:bg-indigo-50 transition-all shadow-lg hover:shadow-white/10 transform hover:-translate-y-0.5",children:["Next ",e.jsx(B,{className:"w-5 h-5 ml-2"})]}):e.jsxs("button",{onClick:()=>w(!0),className:"flex items-center px-8 py-3 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-500 transition-all shadow-lg shadow-indigo-500/25 transform hover:-translate-y-0.5",children:["Submit Quiz ",e.jsx(v,{className:"w-5 h-5 ml-2"})]})]})]}),e.jsx(N,{open:E,onClose:()=>g(!1),children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(z,{className:"w-8 h-8 text-red-500"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Leave Quiz?"}),e.jsx("p",{className:"text-slate-400 mb-6",children:"Your progress will be saved, but you will lose the current attempt if you close the tab."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>g(!1),className:"px-6 py-2.5 rounded-xl bg-slate-800 text-white hover:bg-slate-700 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>l("/dashboard"),className:"px-6 py-2.5 rounded-xl bg-red-600 text-white hover:bg-red-500 font-medium transition-colors shadow-lg shadow-red-600/20",children:"Leave Quiz"})]})]})}),e.jsx(N,{open:Q,onClose:()=>w(!1),children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-500/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(v,{className:"w-8 h-8 text-indigo-500"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Submit Quiz?"}),e.jsx("p",{className:"text-slate-400 mb-6",children:"Are you sure you want to submit? You will not be able to change answers after submission."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>w(!1),className:"px-6 py-2.5 rounded-xl bg-slate-800 text-white hover:bg-slate-700 font-medium transition-colors",children:"Review"}),e.jsxs("button",{onClick:R,disabled:h,className:"px-6 py-2.5 rounded-xl bg-indigo-600 text-white hover:bg-indigo-500 font-medium transition-colors shadow-lg shadow-indigo-600/20 flex items-center",children:[h?e.jsx(G,{className:"w-4 h-4 mr-2 animate-spin"}):null,"Confirm Submit"]})]})]})}),e.jsx(N,{open:L,onClose:()=>k(!1),children:C&&e.jsx("img",{src:C,alt:"Zoomed",className:"max-w-full max-h-[80vh] object-contain mx-auto rounded-lg"})})]})}export{U as TakeQuiz};
