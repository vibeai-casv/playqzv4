import{j as e,c as j}from"./index-CtFufLgh.js";import{r as a}from"./vendor-D8AvkUoV.js";import{u as Z}from"./useAdmin-C3pbjvpL.js";import{M as ee}from"./Modal-B8ICJ_zh.js";import{N as se,O as te,Q as ae,V as re,e as z,Y as le,h as de,_ as ie,x as C,n as ce,m as ne,o as oe,g as o,$ as xe}from"./ui-CX4g-7i5.js";function ye(){const{fetchUsers:R,fetchUserActivity:I,toggleUserStatus:D,isLoading:$}=Z(),[c,F]=a.useState([]),[y,O]=a.useState(0),[n,U]=a.useState(1),[x]=a.useState(20),[u,T]=a.useState(""),[b,M]=a.useState(""),[N,P]=a.useState(""),[v,B]=a.useState(""),[f,V]=a.useState(""),[h,J]=a.useState("created_at"),[m,A]=a.useState("desc"),[r,L]=a.useState(null),[g,Q]=a.useState(null),[q,E]=a.useState(!1),[d,p]=a.useState(new Set),w=async()=>{try{const s=(n-1)*x,{users:t,total:S}=await R({search:u,category:b||void 0,district:N||void 0,role:v||void 0,status:f||void 0,limit:x,offset:s,sortBy:h,sortOrder:m});F(t),O(S)}catch{o.error("Failed to load users")}};a.useEffect(()=>{const s=setTimeout(()=>{w()},300);return()=>clearTimeout(s)},[n,u,b,N,v,f,h,m]);const H=s=>{h===s?A(m==="asc"?"desc":"asc"):(J(s),A("asc"))},X=async s=>{L(s),E(!0);try{const t=await I(s.id);Q(t)}catch{o.error("Failed to load user activity")}finally{E(!1)}},Y=async s=>{try{await D(s.id,!s.disabled),o.success(`User ${s.disabled?"enabled":"disabled"} successfully`),w()}catch{o.error("Failed to update user status")}},_=async s=>{if(d.size!==0)try{await Promise.all(Array.from(d).map(t=>D(t,s))),o.success(`${d.size} users ${s?"disabled":"enabled"}`),p(new Set),w()}catch{o.error("Failed to update users")}},G=()=>{const t=[["Name","Email","Phone","Category","Institution","District","Role","Status","Joined"].join(","),...c.map(l=>[`"${l.name}"`,l.email||"",l.phone||"",l.category||"",`"${l.institution||""}"`,l.district||"",l.role,l.disabled?"Disabled":"Active",new Date(l.created_at).toLocaleDateString()].join(","))].join(`
`),S=new Blob([t],{type:"text/csv;charset=utf-8;"}),k=document.createElement("a");k.href=URL.createObjectURL(S),k.download=`users_export_${new Date().toISOString().split("T")[0]}.csv`,k.click()},K=s=>{const t=new Set(d);t.has(s)?t.delete(s):t.add(s),p(t)},W=()=>{d.size===c.length?p(new Set):p(new Set(c.map(s=>s.id)))},i=({field:s,label:t})=>e.jsx("th",{className:"p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>H(s),children:e.jsxs("div",{className:"flex items-center gap-1",children:[t,h===s?m==="asc"?e.jsx(C,{className:"w-4 h-4 rotate-90"}):e.jsx(C,{className:"w-4 h-4 -rotate-90"}):e.jsx(xe,{className:"w-3 h-3 text-gray-400"})]})});return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"User Management"}),e.jsxs("div",{className:"flex gap-2",children:[d.size>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>_(!0),className:"flex items-center gap-2 px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200",children:[e.jsx(se,{className:"w-4 h-4"})," Disable Selected"]}),e.jsxs("button",{onClick:()=>_(!1),className:"flex items-center gap-2 px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200",children:[e.jsx(te,{className:"w-4 h-4"})," Enable Selected"]})]}),e.jsxs("button",{onClick:G,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:[e.jsx(ae,{className:"w-4 h-4"})," Export CSV"]})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow space-y-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-[200px] relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search users...",value:u,onChange:s=>T(s.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"})]}),e.jsx("input",{type:"text",placeholder:"Filter by District",value:N,onChange:s=>P(s.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"}),e.jsxs("select",{value:b,onChange:s=>M(s.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"",children:"All Categories"}),e.jsx("option",{value:"student",children:"Student"}),e.jsx("option",{value:"professional",children:"Professional"}),e.jsx("option",{value:"educator",children:"Educator"})]}),e.jsxs("select",{value:v,onChange:s=>B(s.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"",children:"All Roles"}),e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]}),e.jsxs("select",{value:f,onChange:s=>V(s.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"disabled",children:"Disabled"})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 w-4",children:e.jsx("input",{type:"checkbox",checked:d.size===c.length&&c.length>0,onChange:W,className:"rounded border-gray-300"})}),e.jsx(i,{field:"name",label:"Name"}),e.jsx(i,{field:"email",label:"Contact"}),e.jsx(i,{field:"category",label:"Category"}),e.jsx(i,{field:"institution",label:"Institution"}),e.jsx(i,{field:"district",label:"District"}),e.jsx(i,{field:"role",label:"Role"}),e.jsx(i,{field:"disabled",label:"Status"}),e.jsx(i,{field:"created_at",label:"Joined"}),e.jsx("th",{className:"p-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:$?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"p-8 text-center",children:e.jsx(z,{className:"w-8 h-8 animate-spin mx-auto text-indigo-600"})})}):c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"p-8 text-center text-gray-500",children:"No users found"})}):c.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"p-4",children:e.jsx("input",{type:"checkbox",checked:d.has(s.id),onChange:()=>K(s.id),className:"rounded border-gray-300"})}),e.jsx("td",{className:"p-4 font-medium text-gray-900 dark:text-white",children:s.name}),e.jsx("td",{className:"p-4 text-gray-500",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:s.email}),e.jsx("span",{className:"text-xs",children:s.phone})]})}),e.jsx("td",{className:"p-4 capitalize",children:s.category}),e.jsx("td",{className:"p-4",children:s.institution}),e.jsx("td",{className:"p-4",children:s.district}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:j("px-2 py-1 rounded-full text-xs font-medium",s.role==="admin"?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"),children:s.role})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:j("px-2 py-1 rounded-full text-xs font-medium",s.disabled?"bg-red-100 text-red-700":"bg-green-100 text-green-700"),children:s.disabled?"Disabled":"Active"})}),e.jsx("td",{className:"p-4 text-gray-500",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>X(s),className:"p-1 text-gray-500 hover:text-indigo-600",title:"View Details",children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Y(s),className:j("p-1",s.disabled?"text-green-600 hover:text-green-700":"text-red-600 hover:text-red-700"),title:s.disabled?"Enable User":"Disable User",children:s.disabled?e.jsx(de,{className:"w-4 h-4"}):e.jsx(ie,{className:"w-4 h-4"})})]})})]},s.id))})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["Showing ",(n-1)*x+1," to ",Math.min(n*x,y)," of ",y," users"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>U(s=>Math.max(1,s-1)),disabled:n===1,className:"p-2 border rounded hover:bg-gray-50 disabled:opacity-50",children:e.jsx(C,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>U(s=>s+1),disabled:n*x>=y,className:"p-2 border rounded hover:bg-gray-50 disabled:opacity-50",children:e.jsx(ce,{className:"w-4 h-4"})})]})]})]}),e.jsx(ee,{open:!!r,onClose:()=>L(null),title:"User Details",className:"max-w-4xl",children:r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between pb-6 border-b dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.name}),e.jsxs("p",{className:"text-gray-500",children:[r.email," â€¢ ",r.phone]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("span",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-sm",children:r.institution||"No Institution"}),e.jsx("span",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-sm capitalize",children:r.category}),r.district&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-sm",children:r.district})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Joined"}),e.jsx("p",{className:"font-medium",children:new Date(r.created_at).toLocaleDateString()})]})]}),q?e.jsx("div",{className:"py-12 text-center",children:e.jsx(z,{className:"w-8 h-8 animate-spin mx-auto text-indigo-600"})}):g?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"})," Recent Logins"]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 space-y-3",children:g.logins.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No recent logins"}):g.logins.map(s=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:new Date(s.created_at).toLocaleString()}),e.jsx("span",{className:"text-gray-500",children:s.ip_address||"Unknown IP"})]},s.id))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"})," Recent Quizzes"]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 space-y-3",children:g.attempts.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No quiz attempts"}):g.attempts.map(s=>e.jsxs("div",{className:"flex justify-between text-sm border-b dark:border-gray-600 last:border-0 pb-2 last:pb-0",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Score: ",s.score||0]}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(s.started_at).toLocaleDateString()})]}),e.jsx("span",{className:j("px-2 py-0.5 rounded text-xs h-fit",s.status==="completed"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"),children:s.status})]},s.id))})]})]}):null]})})]})}export{ye as Users};
