import{j as e,c as P}from"./index-CtFufLgh.js";import{r as t}from"./vendor-D8AvkUoV.js";import{u as X}from"./useAdmin-C3pbjvpL.js";import{g as l,I as Q,a0 as Y,V as F,e as D,a7 as ee,a1 as ae,i as se}from"./ui-CX4g-7i5.js";import{M as te}from"./Modal-B8ICJ_zh.js";function de(){const{fetchMedia:f,uploadMedia:T,deleteMedia:L,fetchQuestions:_,updateQuestion:U,isLoading:O}=X(),[B,G]=t.useState([]),[p,h]=t.useState(!1),[j,c]=t.useState({}),[b,V]=t.useState(""),[i,$]=t.useState("all"),[v,z]=t.useState("date"),[E,g]=t.useState(!1),[n,q]=t.useState(null),[N,w]=t.useState(""),[k,S]=t.useState([]),[x,C]=t.useState(null),[J,M]=t.useState(!1),m=t.useCallback(async()=>{try{const{media:a}=await f({type:i==="all"?void 0:i});G(a)}catch(a){console.error(a),l.error("Failed to load media")}},[f,i]);t.useEffect(()=>{m()},[m]);const A=async a=>{if(!a||a.length===0)return;h(!0);const d=Array.from(a).filter(r=>{const u=["image/jpeg","image/png","image/webp"].includes(r.type),y=r.size<=5*1024*1024;return u||l.error(`${r.name}: Invalid file type. Use JPG, PNG, or WebP.`),y||l.error(`${r.name}: File too large. Max 5MB.`),u&&y});if(d.length===0){h(!1);return}try{await Promise.all(d.map(async r=>{c(o=>({...o,[r.name]:0}));const u=setInterval(()=>{c(o=>({...o,[r.name]:Math.min((o[r.name]||0)+10,90)}))},200);await T(r,i==="all"?"logo":i),clearInterval(u),c(o=>({...o,[r.name]:100}))})),l.success(`${d.length} file(s) uploaded successfully`),m()}catch(r){console.error(r),l.error("Failed to upload some files")}finally{h(!1),c({})}},W=a=>{a.preventDefault(),A(a.dataTransfer.files)},H=async(a,s)=>{if(a.stopPropagation(),!!confirm("Are you sure you want to delete this image?"))try{await L(s),l.success("Image deleted successfully"),m()}catch(d){console.error(d),l.error("Failed to delete image")}},R=a=>{q(a),g(!0),w(""),S([]),C(null)},Z=async a=>{if(w(a),!(a.length<2)){M(!0);try{const{questions:s}=await _({search:a,limit:10});S(s)}catch(s){console.error(s)}finally{M(!1)}}},K=async()=>{if(!(!n||!x))try{await U(x.id,{image_url:n.url}),l.success("Image assigned to question successfully"),g(!1)}catch(a){console.error(a),l.error("Failed to assign image")}},I=B.filter(a=>a.filename.toLowerCase().includes(b.toLowerCase())).sort((a,s)=>v==="date"?new Date(s.created_at).getTime()-new Date(a.created_at).getTime():a.filename.localeCompare(s.filename));return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Q,{className:"w-8 h-8"})," Media Library"]})}),e.jsxs("div",{className:P("border-2 border-dashed rounded-xl p-8 text-center transition-colors",p?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20":"border-gray-300 dark:border-gray-700 hover:border-indigo-400"),onDragOver:a=>a.preventDefault(),onDrop:W,children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"p-4 bg-indigo-100 dark:bg-indigo-900/50 rounded-full",children:e.jsx(Y,{className:"w-8 h-8 text-indigo-600 dark:text-indigo-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Drag & drop files here, or click to select"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"JPG, PNG, WebP up to 5MB"})]}),e.jsx("input",{type:"file",id:"media-upload",className:"hidden",multiple:!0,accept:"image/jpeg,image/png,image/webp",onChange:a=>A(a.target.files),disabled:p}),e.jsx("label",{htmlFor:"media-upload",className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 cursor-pointer transition-colors",children:"Select Files"})]}),Object.entries(j).length>0&&e.jsx("div",{className:"mt-6 space-y-2 max-w-md mx-auto",children:Object.entries(j).map(([a,s])=>e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"truncate max-w-[200px]",children:a}),e.jsxs("span",{children:[s,"%"]})]}),e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-600 transition-all duration-300",style:{width:`${s}%`}})})]},a))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex-1 min-w-[200px] relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search media...",value:b,onChange:a=>V(a.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:i,onChange:a=>$(a.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"logo",children:"Logos"}),e.jsx("option",{value:"personality",children:"Personalities"})]}),e.jsxs("select",{value:v,onChange:a=>z(a.target.value),className:"px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"date",children:"Newest First"}),e.jsx("option",{value:"name",children:"Name A-Z"})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:O&&!p?e.jsx("div",{className:"col-span-full flex justify-center py-12",children:e.jsx(D,{className:"w-8 h-8 animate-spin text-indigo-600"})}):I.length===0?e.jsx("div",{className:"col-span-full text-center py-12 text-gray-500",children:"No media found"}):I.map(a=>e.jsxs("div",{className:"group relative aspect-square bg-gray-100 dark:bg-gray-900 rounded-lg overflow-hidden border hover:border-indigo-500 transition-colors",children:[e.jsx("img",{src:a.url,alt:a.filename,loading:"lazy",className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-2 p-2",children:[e.jsxs("button",{onClick:()=>R(a),className:"w-full py-1.5 bg-indigo-600 text-white rounded text-sm hover:bg-indigo-700 flex items-center justify-center gap-1",children:[e.jsx(ee,{className:"w-3 h-3"})," Assign"]}),e.jsxs("button",{onClick:()=>window.open(a.url,"_blank"),className:"w-full py-1.5 bg-gray-600 text-white rounded text-sm hover:bg-gray-700 flex items-center justify-center gap-1",children:[e.jsx(Q,{className:"w-3 h-3"})," View"]}),e.jsxs("button",{onClick:s=>H(s,a.id),className:"w-full py-1.5 bg-red-600 text-white rounded text-sm hover:bg-red-700 flex items-center justify-center gap-1",children:[e.jsx(ae,{className:"w-3 h-3"})," Delete"]})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-2",children:[e.jsx("p",{className:"text-xs text-white truncate",children:a.filename.split("/").pop()}),e.jsx("p",{className:"text-[10px] text-gray-300 uppercase",children:a.type})]})]},a.id))})]}),e.jsx(te,{open:E,onClose:()=>g(!1),title:"Assign Image to Question",className:"max-w-2xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-200 rounded-lg overflow-hidden shrink-0",children:n&&e.jsx("img",{src:n.url,alt:"Selected",className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Selected Image"}),e.jsx("p",{className:"text-sm text-gray-500 break-all",children:n?.filename}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 uppercase",children:n?.type})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Search Question"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by question text...",value:N,onChange:a=>Z(a.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600"})]})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto border rounded-lg dark:border-gray-700 divide-y dark:divide-gray-700",children:J?e.jsx("div",{className:"p-8 text-center",children:e.jsx(D,{className:"w-6 h-6 animate-spin mx-auto text-indigo-600"})}):k.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:N?"No questions found":"Start typing to search questions"}):k.map(a=>e.jsxs("div",{onClick:()=>C(a),className:P("p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",x?.id===a.id&&"bg-indigo-50 dark:bg-indigo-900/20 border-l-4 border-indigo-600"),children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white line-clamp-2",children:a.question_text}),e.jsxs("div",{className:"flex gap-2 mt-1 text-xs text-gray-500",children:[e.jsx("span",{className:"uppercase",children:a.question_type}),e.jsx("span",{children:"•"}),e.jsx("span",{children:a.category}),a.image_url&&e.jsx("span",{className:"text-amber-600 flex items-center gap-1",children:"• Has Image"})]})]},a.id))}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{onClick:()=>g(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300",children:"Cancel"}),e.jsxs("button",{onClick:K,disabled:!x,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),"Confirm Assignment"]})]})]})})]})}export{de as Media};
